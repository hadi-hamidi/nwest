<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="لوحة تحكم الإدمن - نورث وست باص">
    <title>لوحة تحكم الإدمن - نورث وست باص</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="images/colored-logo-arabic-1.svg">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200;300;400;600;700;900&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" media="print" onload="this.media='all'">
    
    <!-- Styles -->
    <link rel="stylesheet" href="style.css">
    
    <style>
        .admin-dashboard {
            display: flex;
            min-height: 100vh;
            background: #ffffff;
        }
        
        .sidebar {
            width: 250px;
            background: white;
            box-shadow: var(--shadow);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
        }
        
        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            text-align: center;
        }
        
        .sidebar-header .logo {
            margin-bottom: 1rem;
        }
        
        .sidebar-header h3 {
            color: var(--primary-color);
            margin: 0;
        }
        
        .sidebar-menu {
            padding: 1rem 0;
        }
        
        .menu-item {
            display: block;
            padding: 0.75rem 1.5rem;
            color: var(--text-color);
            text-decoration: none;
            transition: var(--transition);
            border-right: 3px solid transparent;
        }
        
        .menu-item:hover,
        .menu-item.active {
            background: rgba(37, 99, 235, 0.1);
            color: var(--primary-color);
            border-right-color: var(--primary-color);
        }
        
        .logout-item:hover {
            background: rgba(220, 38, 38, 0.1) !important;
            color: #dc2626 !important;
            border-right-color: #dc2626 !important;
        }
        
        .menu-item i {
            width: 20px;
            margin-left: 0.5rem;
        }
        
        .main-content {
            flex: 1;
            margin-right: 250px;
            padding: 2rem;
        }
        
        .dashboard-header {
            background: white;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .dashboard-title h1 {
            color: var(--primary-color);
            margin: 0;
        }
        
        .dashboard-title p {
            color: var(--text-light);
            margin: 0.5rem 0 0 0;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            background: var(--primary-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }
        
        .user-details h4 {
            margin: 0;
            color: var(--text-color);
        }
        
        .user-details p {
            margin: 0;
            color: var(--text-light);
            font-size: 0.9rem;
        }
        
        .logout-btn {
            background: var(--danger-color);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .logout-btn:hover {
            background: #dc2626;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            text-align: center;
            transition: var(--transition);
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-size: 1.5rem;
            color: white;
        }
        
        .stat-icon.primary {
            background: var(--primary-color);
        }
        
        .stat-icon.success {
            background: var(--success-color);
        }
        
        .stat-icon.warning {
            background: var(--warning-color);
        }
        
        .stat-icon.danger {
            background: var(--danger-color);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-color);
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            color: var(--text-light);
            font-size: 0.9rem;
        }
        
        .content-section {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }
        
        .section-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .section-header h3 {
            margin: 0;
            color: var(--primary-color);
        }
        
        .section-content {
            padding: 1.5rem;
        }
        
        .table-container {
            overflow-x: auto;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .data-table th,
        .data-table td {
            padding: 0.75rem;
            text-align: right;
            border-bottom: 1px solid var(--border-color);
        }
        
        .data-table th {
            background: #ffffff;
            font-weight: 600;
            color: var(--text-color);
        }
        
        .data-table tr:hover {
            background: rgba(37, 99, 235, 0.05);
        }
        
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .status-confirmed {
            background: #dcfce7;
            color: #166534;
        }
        
        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }
        
        .status-cancelled {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .status-completed {
            background: #e0e7ff;
            color: #3730a3;
        }
        
        .status-vip {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: #92400e;
        }
        
        .customer-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .customer-avatar {
            width: 40px;
            height: 40px;
            background: var(--primary-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }
        
        .customer-avatar.vip {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
        }
        
        .customer-details strong {
            display: block;
            color: var(--text-color);
            font-size: 0.9rem;
        }
        
        .customer-details small {
            color: var(--text-light);
            font-size: 0.8rem;
        }
        
        .contact-info div,
        .address-info div {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.25rem;
            font-size: 0.85rem;
        }
        
        .contact-info i,
        .address-info i {
            width: 12px;
            color: var(--text-light);
        }
        
        .badge {
            background: var(--primary-color);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .amount {
            color: var(--success-color);
            font-weight: 600;
        }
        
        .btn-action {
            padding: 0.25rem 0.5rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: var(--transition);
            margin: 0 0.125rem;
        }
        
        .btn-view {
            background: #e0f2fe;
            color: #0277bd;
        }
        
        .btn-edit {
            background: #f3e8ff;
            color: #7c3aed;
        }
        
        .btn-message {
            background: #ecfdf5;
            color: #059669;
        }
        
        .btn-delete {
            background: #fef2f2;
            color: #dc2626;
        }
        
        .btn-action:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            padding: 1rem;
        }
        
        .modal-content {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            margin: 0;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition);
        }
        
        .close-btn:hover {
            background: var(--light-color);
            color: var(--text-color);
        }
        
        .modal-body {
            padding: 1.5rem;
        }
        
        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-color);
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        /* Customer Details View */
        .customer-details-view {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .detail-section {
            background: var(--light-color);
            padding: 1rem;
            border-radius: var(--border-radius);
        }
        
        .detail-section h4 {
            margin: 0 0 1rem 0;
            color: var(--primary-color);
            font-size: 1.1rem;
        }
        
        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }
        
        .detail-row:last-child {
            border-bottom: none;
        }
        
        .detail-row .label {
            font-weight: 600;
            color: var(--text-color);
        }
        
        .detail-row .value {
            color: var(--text-light);
        }
        
        @media (max-width: 768px) {
            .modal-overlay {
                padding: 0.5rem;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .modal-footer {
                flex-direction: column;
            }
        }
        
        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }
        
        .btn-action {
            padding: 0.25rem 0.5rem;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 0.8rem;
            transition: var(--transition);
        }
        
        .btn-edit {
            background: var(--primary-color);
            color: white;
        }
        
        .btn-delete {
            background: var(--danger-color);
            color: white;
        }
        
        .btn-view {
            background: var(--success-color);
            color: white;
        }
        
        .btn-action:hover {
            opacity: 0.8;
        }
        
        .chart-container {
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #ffffff;
            border-radius: var(--border-radius);
            color: var(--text-light);
        }
        
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        .quick-action {
            background: #ffffff;
            padding: 1rem;
            border-radius: var(--border-radius);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
        }
        
        .quick-action:hover {
            border-color: var(--primary-color);
            background: rgba(37, 99, 235, 0.05);
        }
        
        .quick-action i {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }
        
        .quick-action h4 {
            margin: 0 0 0.5rem 0;
            color: var(--text-color);
        }
        
        .quick-action p {
            margin: 0;
            color: var(--text-light);
            font-size: 0.9rem;
        }
        
        /* Trip Management Styles */
        .filters-section {
            background: #ffffff;
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
        }
        
        .filter-row {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .filter-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .filter-group label {
            font-weight: 600;
            color: var(--text-color);
            white-space: nowrap;
        }
        
        .filter-group input,
        .filter-group select {
            padding: 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 0.9rem;
        }
        
        .modal-content.large {
            max-width: 800px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-color);
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .trip-details-view {
            padding: 1rem;
        }
        
        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .detail-row:last-child {
            border-bottom: none;
        }
        
        .status-scheduled {
            background: #e0e7ff;
            color: #3730a3;
        }
        
        .status-active {
            background: #dcfce7;
            color: #166534;
        }
        
        .status-completed {
            background: #f0f9ff;
            color: #0369a1;
        }
        
        .status-cancelled {
            background: #fee2e2;
            color: #991b1b;
        }

        /* Dashboard Enhancements */
        .stat-card {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .stat-change {
            font-size: 0.8rem;
            margin-top: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .stat-change.positive {
            color: var(--success-color);
        }

        .stat-change.negative {
            color: var(--danger-color);
        }

        .stat-change.neutral {
            color: var(--text-light);
        }

        .live-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--success-color);
            font-weight: 600;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background: var(--success-color);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .live-updates {
            max-height: 300px;
            overflow-y: auto;
        }

        .update-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            transition: var(--transition);
        }

        .update-item:hover {
            background: #ffffff;
        }

        .update-item:last-child {
            border-bottom: none;
        }

        .update-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1rem;
        }

        .update-icon.success {
            background: var(--success-color);
        }

        .update-icon.warning {
            background: var(--warning-color);
        }

        .update-icon.info {
            background: var(--primary-color);
        }

        .update-content {
            flex: 1;
        }

        .update-content strong {
            color: var(--text-color);
        }

        .update-content small {
            color: var(--text-light);
            display: block;
            margin-top: 0.25rem;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        /* Advanced Search Styles */
        .search-container {
            position: relative;
            flex: 1;
            max-width: 500px;
            margin: 0 2rem;
        }

        .search-input-group {
            display: flex;
            background: white;
            border-radius: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow: hidden;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .search-input-group:focus-within {
            border-color: var(--primary-color);
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);
        }

        .search-input {
            flex: 1;
            border: none;
            padding: 12px 20px;
            font-size: 14px;
            outline: none;
            background: transparent;
        }

        .search-input::placeholder {
            color: #999;
        }

        .search-type-select {
            border: none;
            padding: 12px 15px;
            background: #f8f9fa;
            border-left: 1px solid #e9ecef;
            outline: none;
            font-size: 14px;
            cursor: pointer;
        }

        .search-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .search-btn:hover {
            background: var(--accent-color);
            transform: scale(1.05);
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 1000;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 5px;
            display: none;
        }

        .search-results.show {
            display: block;
        }

        .search-loading {
            padding: 20px;
            text-align: center;
            color: #666;
        }

        .search-results-list {
            padding: 10px 0;
        }

        .search-result-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 1px solid #f0f0f0;
        }

        .search-result-item:hover {
            background: #f8f9fa;
            transform: translateX(5px);
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .result-icon {
            width: 40px;
            height: 40px;
            background: var(--primary-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 15px;
            font-size: 16px;
        }

        .result-content h4 {
            margin: 0 0 5px 0;
            color: #333;
            font-size: 16px;
        }

        .result-content p {
            margin: 0;
            color: #666;
            font-size: 14px;
        }

        .no-results {
            padding: 20px;
            text-align: center;
            color: #666;
        }

        /* Notifications */
        .notifications {
            position: relative;
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff4757;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* Dark Mode Styles */
        .dark-mode {
            background: #1a1a1a;
            color: #e0e0e0;
        }

        .dark-mode .dashboard-header {
            background: #2d2d2d;
            border-bottom: 1px solid #404040;
        }

        .dark-mode .search-input-group {
            background: #3d3d3d;
            border-color: #555;
        }

        .dark-mode .search-input {
            color: #e0e0e0;
        }

        .dark-mode .search-input::placeholder {
            color: #999;
        }

        .dark-mode .search-results {
            background: #3d3d3d;
            border: 1px solid #555;
        }

        .dark-mode .search-result-item:hover {
            background: #4d4d4d;
        }

        .dark-mode .result-content h4 {
            color: #e0e0e0;
        }

        .dark-mode .result-content p {
            color: #999;
        }

        /* Notification System Styles */
        .notification-container {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 10000;
            display: none;
        }

        .notification-container.show {
            display: block;
        }

        .notifications-dropdown {
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            width: 350px;
            max-height: 500px;
            overflow: hidden;
            border: 1px solid #e9ecef;
        }

        .notifications-header {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notifications-header h4 {
            margin: 0;
            font-size: 18px;
        }

        .notifications-header button {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .notifications-header button:hover {
            background: rgba(255,255,255,0.3);
        }

        .notification-item {
            display: flex;
            align-items: flex-start;
            padding: 15px 20px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .notification-item:hover {
            background: #f8f9fa;
        }

        .notification-item.unread {
            background: #f0f8ff;
            border-left: 4px solid var(--primary-color);
        }

        .notification-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 15px;
            font-size: 16px;
            color: white;
        }

        .notification-icon.success {
            background: #22c55e;
        }

        .notification-icon.warning {
            background: #f59e0b;
        }

        .notification-icon.info {
            background: #3b82f6;
        }

        .notification-icon.error {
            background: #ef4444;
        }

        .notification-content {
            flex: 1;
        }

        .notification-content h5 {
            margin: 0 0 5px 0;
            color: #333;
            font-size: 14px;
            font-weight: 600;
        }

        .notification-content p {
            margin: 0 0 5px 0;
            color: #666;
            font-size: 13px;
            line-height: 1.4;
        }

        .notification-time {
            color: #999;
            font-size: 12px;
        }

        .unread-dot {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 8px;
            height: 8px;
            background: var(--primary-color);
            border-radius: 50%;
        }

        /* Dark mode for notifications */
        .dark-mode .notifications-dropdown {
            background: #2d2d2d;
            border-color: #404040;
        }

        .dark-mode .notification-item {
            border-bottom-color: #404040;
        }

        .dark-mode .notification-item:hover {
            background: #3d3d3d;
        }

        .dark-mode .notification-item.unread {
            background: #1a2332;
        }

        .dark-mode .notification-content h5 {
            color: #e0e0e0;
        }

        .dark-mode .notification-content p {
            color: #999;
        }

        .dark-mode .notification-time {
            color: #666;
        }

        /* White Background Override */
        body {
            background: #ffffff !important;
        }

        /* Performance Optimizations */
        * {
            box-sizing: border-box;
        }

        .stat-card, .modal, .btn, .form-control {
            will-change: transform;
        }

        .stat-card:hover, .btn:hover {
            transform: translateY(-2px);
            transition: transform 0.3s ease;
        }

        /* Lazy Loading for Images - handled via HTML loading attribute */

        /* Optimize Animations */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Enhanced Charts Section */
        .charts-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .chart-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border: 1px solid #f0f0f0;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .chart-container:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem 1.5rem 1rem 1.5rem;
            border-bottom: 1px solid #f0f0f0;
            background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
        }

        .chart-header h4 {
            margin: 0;
            color: var(--primary-color);
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .chart-header h4 i {
            font-size: 1rem;
            color: var(--primary-color);
        }

        .chart-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-icon {
            width: 32px;
            height: 32px;
            border: none;
            background: #f8f9fa;
            color: var(--text-light);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
        }

        .btn-icon:hover {
            background: var(--primary-color);
            color: white;
            transform: scale(1.05);
        }

        .chart-content {
            padding: 1.5rem;
            position: relative;
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chart-content canvas {
            max-width: 100%;
            max-height: 300px;
            width: 100% !important;
            height: 300px !important;
        }

        /* Chart Loading State */
        .chart-content::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            border: 3px solid #f0f0f0;
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            display: none;
        }

        .chart-content.loading::before {
            display: block;
        }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        /* Responsive Charts */
        @media (max-width: 768px) {
            .charts-section {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .chart-header {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }

            .chart-actions {
                align-self: flex-end;
            }

            .chart-content {
                padding: 1rem;
                min-height: 250px;
            }
        }

        .main-content {
            background: #ffffff !important;
        }

        .content-section {
            background: #ffffff !important;
        }

        .dashboard-header {
            background: #ffffff !important;
        }
        
        /* Mobile Menu Button */
        .mobile-menu-btn {
            display: none;
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.75rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
            margin-left: 1rem;
            z-index: 1001;
            position: relative;
        }
        
        /* Show mobile menu button on smaller screens */
        @media (max-width: 1200px) {
            .mobile-menu-btn {
                display: block !important;
                background: var(--primary-color) !important;
                color: white !important;
                border: none !important;
                padding: 0.75rem !important;
                border-radius: 8px !important;
                cursor: pointer !important;
                font-size: 1.2rem !important;
                transition: all 0.3s ease !important;
                margin-left: 1rem !important;
                z-index: 1001 !important;
                position: relative !important;
            }
        }
        
        .mobile-menu-btn:hover {
            background: var(--primary-dark);
            transform: scale(1.05);
        }
        
        .mobile-menu-btn:active {
            transform: scale(0.95);
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        /* Force mobile menu button to show on mobile */
        @media (max-width: 1024px) {
            .mobile-menu-btn {
                display: block !important;
                background: var(--primary-color) !important;
                color: white !important;
                border: none !important;
                padding: 0.75rem !important;
                border-radius: 8px !important;
                cursor: pointer !important;
                font-size: 1.2rem !important;
                transition: all 0.3s ease !important;
                margin-left: 1rem !important;
                z-index: 1001 !important;
                position: relative !important;
            }
        }
        
        /* Ensure mobile menu button is always visible on mobile */
        @media (max-width: 768px) {
            .mobile-menu-btn {
                display: block !important;
                background: var(--primary-color) !important;
                color: white !important;
                border: none !important;
                padding: 0.75rem !important;
                border-radius: 8px !important;
                cursor: pointer !important;
                font-size: 1.2rem !important;
                transition: all 0.3s ease !important;
                margin-left: 1rem !important;
                z-index: 1001 !important;
                position: relative !important;
            }
        }

        /* Updated Statistics Design */
        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: all 0.3s ease;
            border: 1px solid #f0f0f0;
            cursor: pointer;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
            border-color: var(--primary-color);
        }
        
        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            color: white;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            flex-shrink: 0;
        }
        
        .stat-content {
            flex: 1;
        }
        
        .stat-content h3 {
            font-size: 0.9rem;
            color: var(--text-light);
            margin: 0 0 0.5rem 0;
            font-weight: 500;
        }
        
        .stat-number {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-color);
            margin-bottom: 0.25rem;
            line-height: 1.2;
        }
        
        .stat-change {
            font-size: 0.8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .stat-change.positive {
            color: var(--success-color);
        }

        .stat-change.negative {
            color: var(--danger-color);
        }

        .stat-change.neutral {
            color: var(--text-light);
        }

        /* Advanced Statistics Styles */
        .stat-change {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 5px;
        }

        .stat-change.positive {
            color: #22c55e;
        }

        .stat-change.negative {
            color: #ef4444;
        }

        .stat-change.neutral {
            color: #6b7280;
        }

        .stat-change i {
            font-size: 10px;
        }

        /* Real-time Updates Animation */
        .stat-card.updating {
            animation: pulse 1s ease-in-out;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Performance Indicators */
        .performance-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .performance-bar {
            flex: 1;
            height: 4px;
            background: #e5e7eb;
            border-radius: 2px;
            overflow: hidden;
        }

        .performance-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            transition: width 0.3s ease;
        }

        .performance-text {
            font-size: 12px;
            color: #6b7280;
            font-weight: 500;
        }

        .customer-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .customer-avatar {
            width: 35px;
            height: 35px;
            background: var(--primary-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .btn-confirm {
            background: var(--success-color);
            color: white;
        }

        .btn-confirm:hover {
            background: #059669;
        }

        .btn-cancel {
            background: var(--danger-color);
            color: white;
        }

        .btn-cancel:hover {
            background: #dc2626;
        }

        .btn-download {
            background: var(--accent-color);
            color: white;
        }

        .btn-download:hover {
            background: var(--accent-dark);
        }

        /* Enhanced Booking Details Modal */
        .booking-details-modal {
            max-width: 1000px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }

        .booking-details-container {
            padding: 0;
        }

        .booking-header-section {
            background: linear-gradient(135deg, #264673 0%, #264673 100%);
            color: white;
            padding: 2.5rem;
            border-radius: 20px 20px 0 0;
            margin: -1.5rem -1.5rem 2rem -1.5rem;
            position: relative;
            overflow: hidden;
        }

        .booking-header-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(255, 255, 255, 0.1) 0%, transparent 50%, rgba(255, 255, 255, 0.1) 100%);
            pointer-events: none;
        }

        .booking-id-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .booking-id-badge {
            background: rgba(255, 255, 255, 0.25);
            padding: 1rem 2rem;
            border-radius: 30px;
            font-size: 1.2rem;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            backdrop-filter: blur(15px);
            border: 2px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            position: relative;
            z-index: 1;
        }

        .booking-status-badge .status-badge {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.5);
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            box-shadow: 0 4px 16px rgba(16, 185, 129, 0.4);
            position: relative;
            z-index: 1;
        }

        .booking-date-time {
            display: flex;
            gap: 2rem;
        }

        .date-info, .time-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            background: rgba(255, 255, 255, 0.15);
            padding: 1rem 1.5rem;
            border-radius: 20px;
            font-weight: 700;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 1;
        }

        .route-section, .customer-section, .booking-info-section, .payment-summary {
            margin-bottom: 2rem;
            padding: 2rem;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(226, 232, 240, 0.8);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .route-section::before, .customer-section::before, .booking-info-section::before, .payment-summary::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            border-radius: 16px 16px 0 0;
        }

        .route-section:hover, .customer-section:hover, .booking-info-section:hover, .payment-summary:hover {
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.12);
            transform: translateY(-4px);
            border-color: rgba(37, 99, 235, 0.2);
        }

        .route-section h4, .customer-section h4, .booking-info-section h4, .payment-summary h4 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.3rem;
            font-weight: 700;
            position: relative;
            padding-bottom: 0.75rem;
        }

        .route-section h4::after, .customer-section h4::after, .booking-info-section h4::after, .payment-summary h4::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            border-radius: 2px;
        }

        .route-card {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            border-radius: 16px;
            padding: 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 1px solid rgba(226, 232, 240, 0.8);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .route-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
        }

        .route-from, .route-to {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .city-name {
            font-size: 1.4rem;
            font-weight: 800;
            color: var(--text-color);
            margin-bottom: 0.5rem;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .city-details {
            color: var(--text-light);
            font-size: 1rem;
            font-weight: 500;
            background: rgba(255, 255, 255, 0.7);
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            border: 1px solid rgba(226, 232, 240, 0.8);
        }

        .route-icon {
            color: var(--accent-color);
            font-size: 2rem;
            margin: 0 2rem;
            background: linear-gradient(135deg, var(--accent-color), #f97316);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(0 2px 4px rgba(249, 115, 22, 0.3));
        }

        .customer-card {
            display: flex;
            align-items: center;
            gap: 2rem;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            padding: 2rem;
            border-radius: 16px;
            border: 1px solid rgba(226, 232, 240, 0.8);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .customer-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
        }

        .customer-avatar-large {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            box-shadow: 0 8px 24px rgba(37, 99, 235, 0.3);
            border: 3px solid rgba(255, 255, 255, 0.8);
            transition: all 0.3s ease;
        }

        .customer-avatar-large:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 32px rgba(37, 99, 235, 0.4);
        }

        .customer-name {
            font-size: 1.4rem;
            font-weight: 800;
            color: var(--text-color);
            margin-bottom: 0.75rem;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .customer-contact {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: var(--text-light);
            background: rgba(255, 255, 255, 0.8);
            padding: 0.5rem 1rem;
            border-radius: 12px;
            border: 1px solid rgba(226, 232, 240, 0.8);
            transition: all 0.3s ease;
        }

        .contact-item:hover {
            background: rgba(255, 255, 255, 1);
            transform: translateX(4px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .info-item {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            padding: 1.5rem;
            border-radius: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(226, 232, 240, 0.8);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .info-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, var(--primary-color), var(--accent-color));
            border-radius: 0 2px 2px 0;
        }

        .info-item:hover {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
            border-color: rgba(37, 99, 235, 0.2);
        }

        .info-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-color);
            font-weight: 600;
        }

        .info-value {
            font-weight: 700;
            color: var(--text-color);
        }

        .info-value.price {
            color: var(--accent-color);
            font-size: 1.1rem;
        }

        .payment-breakdown {
            background: linear-gradient(135deg, var(--light-color), #f8fafc);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            border: 1px solid var(--border-color);
        }

        .payment-item {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-color);
            transition: all 0.3s ease;
        }

        .payment-item:hover {
            background: rgba(37, 99, 235, 0.05);
            padding-right: 0.5rem;
            padding-left: 0.5rem;
            border-radius: 8px;
        }

        .payment-item:last-child {
            border-bottom: none;
        }

        .payment-total {
            display: flex;
            justify-content: space-between;
            padding: 1.25rem 1rem;
            border-top: 2px solid var(--primary-color);
            margin-top: 1rem;
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--primary-color);
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.1), rgba(249, 115, 22, 0.1));
            border-radius: var(--border-radius);
            box-shadow: 0 2px 8px rgba(37, 99, 235, 0.2);
        }

        .modal-footer {
            display: flex;
            gap: 1.5rem;
            justify-content: flex-end;
            flex-wrap: wrap;
            padding: 2rem;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-top: 1px solid rgba(226, 232, 240, 0.8);
            border-radius: 0 0 20px 20px;
            position: relative;
        }

        .modal-footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--primary-color), transparent);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 12px;
            font-weight: 700;
            font-size: 1rem;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 16px rgba(245, 158, 11, 0.3);
            position: relative;
            overflow: hidden;
        }

        .btn-warning::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn-warning:hover::before {
            left: 100%;
        }

        .btn-warning:hover {
            background: linear-gradient(135deg, #d97706, #b45309);
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(245, 158, 11, 0.4);
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 12px;
            font-weight: 700;
            font-size: 1rem;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 16px rgba(59, 130, 246, 0.3);
            position: relative;
            overflow: hidden;
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn-primary:hover::before {
            left: 100%;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #1d4ed8, #1e40af);
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(59, 130, 246, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6b7280, #4b5563);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 12px;
            font-weight: 700;
            font-size: 1rem;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 16px rgba(107, 114, 128, 0.3);
            position: relative;
            overflow: hidden;
        }

        .btn-secondary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn-secondary:hover::before {
            left: 100%;
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #4b5563, #374151);
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(107, 114, 128, 0.4);
        }

        /* Customer Management Styles */
        .customer-info-cell {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .customer-avatar {
            width: 40px;
            height: 40px;
            background: var(--primary-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1rem;
        }

        .customer-details strong {
            display: block;
            color: var(--text-color);
            font-size: 1rem;
        }

        .customer-details small {
            color: var(--text-light);
            font-size: 0.8rem;
        }

        .contact-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .contact-info div {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-color);
            font-size: 0.9rem;
        }

        .contact-info i {
            color: var(--primary-color);
            width: 16px;
        }

        .status-vip {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #8b4513;
            font-weight: 700;
        }

        .status-active {
            background: var(--success-color);
            color: white;
        }

        .status-inactive {
            background: var(--danger-color);
            color: white;
        }

        .status-scheduled {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            font-weight: 700;
        }

        .badge {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .badge-info {
            background: var(--info-color);
            color: white;
        }

        .btn-message {
            background: var(--info-color);
            color: white;
        }

        .btn-message:hover {
            background: #0369a1;
        }

        /* Driver Management Styles */
        .driver-info-cell {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .driver-avatar {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.1rem;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .driver-details strong {
            display: block;
            color: var(--text-color);
            font-size: 1rem;
            margin-bottom: 0.25rem;
        }

        .driver-details small {
            color: var(--text-light);
            font-size: 0.8rem;
        }

        .license-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .license-number {
            font-weight: 700;
            color: var(--text-color);
            font-size: 0.9rem;
        }

        .license-type {
            color: var(--primary-color);
            font-size: 0.8rem;
            font-weight: 600;
            background: rgba(37, 99, 235, 0.1);
            padding: 0.25rem 0.5rem;
            border-radius: 8px;
            display: inline-block;
        }

        .license-expiry {
            color: var(--text-light);
            font-size: 0.75rem;
        }

        .rating {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
        }

        .stars {
            color: #fbbf24;
            font-size: 1rem;
        }

        .rating-text {
            color: var(--text-color);
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-vacation {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            font-weight: 700;
        }

        .btn-schedule {
            background: var(--success-color);
            color: white;
        }

        .btn-schedule:hover {
            background: #059669;
        }

        /* Fleet Management Styles */
        .fleet-info-cell {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .fleet-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #264673 0%, #264673 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .fleet-details strong {
            display: block;
            color: var(--text-color);
            font-size: 1rem;
            margin-bottom: 0.25rem;
        }

        .fleet-details small {
            color: var(--text-light);
            font-size: 0.8rem;
        }

        .technical-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .fleet-type {
            font-weight: 700;
            color: var(--primary-color);
            font-size: 0.9rem;
        }

        .fleet-capacity {
            color: var(--text-color);
            font-size: 0.8rem;
        }

        .fleet-year {
            color: var(--text-light);
            font-size: 0.8rem;
        }

        .location-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .location-name {
            font-weight: 700;
            color: var(--text-color);
            font-size: 0.9rem;
        }

        .location-time {
            color: var(--text-light);
            font-size: 0.8rem;
        }

        .status-maintenance {
            background: var(--warning-color);
            color: white;
        }

        .status-reserved {
            background: var(--info-color);
            color: white;
        }

        .btn-maintenance {
            background: var(--warning-color);
            color: white;
        }

        .btn-maintenance:hover {
            background: #d97706;
        }

        .btn-location {
            background: var(--info-color);
            color: white;
        }

        .btn-location:hover {
            background: #0284c7;
        }

        /* Add Driver Modal Styles */
        .add-driver-modal {
            max-width: 1200px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }

        .add-driver-form {
            padding: 0;
        }

        /* Edit Driver Modal Styles */
        .edit-driver-modal {
            max-width: 1200px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }

        .edit-driver-form {
            padding: 0;
        }

        /* Add Fleet Modal Styles */
        .add-fleet-modal {
            max-width: 1200px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }

        .add-fleet-form {
            padding: 0;
        }

        /* Fleet Details Modal Styles */
        .fleet-details-modal {
            max-width: 1000px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }

        .fleet-details-container {
            padding: 0;
        }

        .fleet-header-section {
            background: linear-gradient(135deg, #264673 0%, #264673 100%);
            color: white;
            padding: 2.5rem;
            border-radius: 20px 20px 0 0;
            margin: -1.5rem -1.5rem 2rem -1.5rem;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .fleet-header-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(255, 255, 255, 0.1) 0%, transparent 50%, rgba(255, 255, 255, 0.1) 100%);
            pointer-events: none;
        }

        .fleet-avatar-large {
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: 700;
            backdrop-filter: blur(10px);
            border: 3px solid rgba(255, 255, 255, 0.3);
            position: relative;
            z-index: 1;
        }

        .fleet-info {
            flex: 1;
            position: relative;
            z-index: 1;
        }

        .fleet-info h2 {
            margin: 0 0 0.5rem 0;
            font-size: 1.8rem;
            font-weight: 800;
        }

        .fleet-id {
            margin: 0 0 1rem 0;
            opacity: 0.9;
            font-size: 1rem;
        }

        .fleet-stats {
            display: flex;
            gap: 2rem;
            position: relative;
            z-index: 1;
        }

        .fleet-stats .stat-item {
            text-align: center;
            background: rgba(255, 255, 255, 0.15);
            padding: 1rem;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .fleet-stats .stat-number {
            font-size: 1.5rem;
            font-weight: 800;
            margin-bottom: 0.25rem;
        }

        .fleet-stats .stat-label {
            font-size: 0.8rem;
            opacity: 0.9;
        }

        /* Edit Fleet Modal Styles */
        .edit-fleet-modal {
            max-width: 1200px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }

        .edit-fleet-form {
            padding: 0;
        }

        /* Reports and Analytics Styles */
        .reports-dashboard {
            margin-top: 2rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(226, 232, 240, 0.8);
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            border-radius: 16px 16px 0 0;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .stat-content {
            flex: 1;
        }

        .stat-content h3 {
            margin: 0 0 0.5rem 0;
            color: var(--text-color);
            font-size: 0.9rem;
            font-weight: 600;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary-color);
            margin-bottom: 0.25rem;
        }

        .stat-change {
            font-size: 0.8rem;
            font-weight: 600;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
        }

        .stat-change.positive {
            background: var(--success-color);
            color: white;
        }

        .stat-change.negative {
            background: var(--error-color);
            color: white;
        }

        .charts-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .chart-container {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(226, 232, 240, 0.8);
        }

        .chart-container h4 {
            margin: 0 0 1rem 0;
            color: var(--primary-color);
            font-size: 1.1rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .chart-placeholder {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            border: 2px dashed rgba(102, 126, 234, 0.3);
            color: var(--text-light);
        }

        .top-routes-section {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(226, 232, 240, 0.8);
        }

        .top-routes-section h4 {
            margin: 0 0 1.5rem 0;
            color: var(--primary-color);
            font-size: 1.1rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .routes-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .route-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 12px;
            border: 1px solid rgba(226, 232, 240, 0.8);
            transition: all 0.3s ease;
        }

        .route-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .route-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .route-name {
            font-weight: 700;
            color: var(--text-color);
            font-size: 1rem;
        }

        .route-distance {
            color: var(--text-light);
            font-size: 0.8rem;
        }

        .route-stats {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            text-align: left;
        }

        .route-bookings {
            font-weight: 600;
            color: var(--primary-color);
            font-size: 0.9rem;
        }

        .route-revenue {
            color: var(--success-color);
            font-weight: 600;
            font-size: 0.9rem;
        }

        .report-section {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(226, 232, 240, 0.8);
            margin-bottom: 2rem;
        }

        .report-section h4 {
            margin: 0 0 1.5rem 0;
            color: var(--primary-color);
            font-size: 1.1rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .report-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .report-stat {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
            border: 1px solid rgba(226, 232, 240, 0.8);
        }

        .report-stat .stat-label {
            color: var(--text-light);
            font-size: 0.8rem;
            margin-bottom: 0.5rem;
        }

        .report-stat .stat-value {
            color: var(--primary-color);
            font-size: 1.5rem;
            font-weight: 800;
        }

        .revenue-breakdown {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .revenue-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 12px;
            border: 1px solid rgba(226, 232, 240, 0.8);
        }

        .revenue-label {
            font-weight: 600;
            color: var(--text-color);
        }

        .revenue-amount {
            font-weight: 700;
            color: var(--success-color);
            font-size: 1.1rem;
        }

        .revenue-percentage {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .fleet-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .fleet-stat {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
            border: 1px solid rgba(226, 232, 240, 0.8);
        }

        .fleet-stat .stat-label {
            color: var(--text-light);
            font-size: 0.8rem;
            margin-bottom: 0.5rem;
        }

        .fleet-stat .stat-value {
            color: var(--primary-color);
            font-size: 1.5rem;
            font-weight: 800;
        }

        /* Responsive design for reports */
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .charts-section {
                grid-template-columns: 1fr;
            }

            .route-item {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .route-stats {
                text-align: center;
            }
        }

        /* Settings Styles */
        .settings-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 1rem;
        }

        .tab-btn {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border: 1px solid rgba(226, 232, 240, 0.8);
            border-radius: 12px;
            padding: 0.75rem 1.5rem;
            color: var(--text-color);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .tab-btn:hover {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .settings-tab-content {
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .settings-section {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(226, 232, 240, 0.8);
            margin-bottom: 2rem;
        }

        .settings-section h4 {
            margin: 0 0 2rem 0;
            color: var(--primary-color);
            font-size: 1.2rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            position: relative;
            padding-bottom: 0.75rem;
        }

        .settings-section h4::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 40px;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            border-radius: 2px;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .setting-item {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .setting-item label {
            color: var(--text-color);
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }

        .setting-item input,
        .setting-item select,
        .setting-item textarea {
            padding: 0.75rem;
            border: 2px solid rgba(226, 232, 240, 0.8);
            border-radius: 12px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        }

        .setting-item input:focus,
        .setting-item select:focus,
        .setting-item textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-1px);
        }

        .setting-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: var(--primary-color);
            cursor: pointer;
        }

        .setting-item input[type="file"] {
            padding: 0.5rem;
            border: 2px dashed rgba(102, 126, 234, 0.3);
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            cursor: pointer;
        }

        .setting-item input[type="file"]:hover {
            border-color: var(--primary-color);
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(102, 126, 234, 0.1) 100%);
        }

        .setting-item textarea {
            resize: vertical;
            min-height: 80px;
        }

        /* Responsive design for settings */
        @media (max-width: 768px) {
            .settings-tabs {
                flex-direction: column;
            }

            .tab-btn {
                justify-content: center;
                text-align: center;
            }

            .settings-grid {
                grid-template-columns: 1fr;
            }

            .settings-section {
                padding: 1.5rem;
            }
        }

        /* Driver Details Modal Styles */
        .driver-details-modal {
            max-width: 1000px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }

        .driver-details-container {
            padding: 0;
        }

        .driver-header-section {
            background: linear-gradient(135deg, #264673 0%, #264673 100%);
            color: white;
            padding: 2.5rem;
            border-radius: 20px 20px 0 0;
            margin: -1.5rem -1.5rem 2rem -1.5rem;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .driver-header-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(255, 255, 255, 0.1) 0%, transparent 50%, rgba(255, 255, 255, 0.1) 100%);
            pointer-events: none;
        }

        .driver-avatar-large {
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: 700;
            backdrop-filter: blur(10px);
            border: 3px solid rgba(255, 255, 255, 0.3);
            position: relative;
            z-index: 1;
        }

        .driver-info {
            flex: 1;
            position: relative;
            z-index: 1;
        }

        .driver-info h2 {
            margin: 0 0 0.5rem 0;
            font-size: 1.8rem;
            font-weight: 800;
        }

        .driver-id {
            margin: 0 0 1rem 0;
            opacity: 0.9;
            font-size: 1rem;
        }

        .driver-stats {
            display: flex;
            gap: 2rem;
            position: relative;
            z-index: 1;
        }

        .stat-item {
            text-align: center;
            background: rgba(255, 255, 255, 0.15);
            padding: 1rem;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: 800;
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.8rem;
            opacity: 0.9;
        }

        .info-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 16px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(226, 232, 240, 0.8);
            position: relative;
            overflow: hidden;
        }

        .info-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            border-radius: 16px 16px 0 0;
        }

        .info-section h4 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.2rem;
            font-weight: 700;
            position: relative;
            padding-bottom: 0.75rem;
        }

        .info-section h4::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 40px;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            border-radius: 2px;
        }

        .trips-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .trip-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 12px;
            border: 1px solid rgba(226, 232, 240, 0.8);
            transition: all 0.3s ease;
        }

        .trip-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .trip-route {
            font-weight: 700;
            color: var(--text-color);
        }

        .trip-date {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .trip-status {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .trip-status.completed {
            background: var(--success-color);
            color: white;
        }

        /* Responsive design for driver modals */
        @media (max-width: 768px) {
            .driver-header-section {
                flex-direction: column;
                text-align: center;
                gap: 1rem;
            }

            .driver-stats {
                flex-direction: column;
                gap: 1rem;
            }

            .stat-item {
                padding: 0.75rem;
            }

            .trip-item {
                flex-direction: column;
                gap: 0.5rem;
                text-align: center;
            }
        }

        /* Edit Booking Modal Styles */
        .edit-booking-modal {
            max-width: 1200px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }

        /* Add Trip Modal Styles */
        .add-trip-modal {
            max-width: 1400px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }

        .add-trip-form {
            padding: 0;
        }

        .edit-booking-form {
            padding: 0;
        }

        .form-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 16px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(226, 232, 240, 0.8);
            position: relative;
            overflow: hidden;
        }

        .form-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            border-radius: 16px 16px 0 0;
        }

        .form-section h4 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.2rem;
            font-weight: 700;
            position: relative;
            padding-bottom: 0.75rem;
        }

        .form-section h4::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 40px;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            border-radius: 2px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-group label {
            font-weight: 600;
            color: var(--text-color);
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 0.75rem 1rem;
            border: 2px solid rgba(226, 232, 240, 0.8);
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
            transform: translateY(-1px);
        }

        .form-group input[readonly] {
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            color: var(--text-light);
            cursor: not-allowed;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-group select {
            cursor: pointer;
        }

        .form-group input[type="number"] {
            text-align: center;
        }

        .form-group input[type="date"],
        .form-group input[type="time"] {
            cursor: pointer;
        }

        /* Form validation styles */
        .form-group input:invalid {
            border-color: #ef4444;
        }

        .form-group input:valid {
            border-color: #10b981;
        }

        /* Loading state for save button */
        .btn-primary:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .fa-spinner {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Responsive design for edit form */
        @media (max-width: 768px) {
            .edit-booking-modal {
                width: 98%;
                margin: 1%;
                max-height: 95vh;
            }

            .form-row {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .form-section {
                padding: 1rem;
            }

            .form-group input,
            .form-group select,
            .form-group textarea {
                padding: 0.75rem;
                font-size: 0.95rem;
            }
        }

        @media (max-width: 768px) {
            .booking-details-modal {
                width: 98%;
                margin: 1%;
                max-height: 95vh;
            }

            .booking-header-section {
                padding: 1.5rem;
                margin: -1rem -1rem 1.5rem -1rem;
            }

            .booking-id-section {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }

            .booking-date-time {
                flex-direction: column;
                gap: 1rem;
            }

            .route-card {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .route-icon {
                transform: rotate(90deg);
                margin: 0.5rem 0;
            }

            .customer-card {
                flex-direction: column;
                text-align: center;
                gap: 1rem;
            }

            .info-grid {
                grid-template-columns: 1fr;
            }

            .info-item {
                flex-direction: column;
                text-align: center;
                gap: 0.5rem;
            }

            .modal-footer {
                flex-direction: column;
                gap: 0.75rem;
            }

            .modal-footer .btn {
                width: 100%;
                justify-content: center;
            }

            .payment-item {
                flex-direction: column;
                text-align: center;
                gap: 0.25rem;
            }

            .payment-total {
                flex-direction: column;
                text-align: center;
                gap: 0.5rem;
            }
        }
        
        @media (max-width: 768px) {
            .mobile-menu-btn {
                display: block !important;
                background: var(--primary-color) !important;
                color: white !important;
                border: none !important;
                padding: 0.75rem !important;
                border-radius: 8px !important;
                cursor: pointer !important;
                font-size: 1.2rem !important;
                transition: all 0.3s ease !important;
                margin-left: 1rem !important;
                z-index: 1001 !important;
                position: relative !important;
            }
            
            .mobile-menu-btn:active {
                transform: scale(0.95) !important;
            }
            
            .sidebar {
                transform: translateX(-100%) !important;
                transition: transform 0.3s ease !important;
                width: 280px !important;
                z-index: 1000 !important;
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                height: 100vh !important;
                background: white !important;
                box-shadow: 2px 0 10px rgba(0,0,0,0.1) !important;
                display: block !important;
            }
            
            .sidebar.open {
                transform: translateX(0) !important;
                display: block !important;
            }
            
            .main-content {
                margin-right: 0;
                padding: 0.5rem;
                width: 100%;
                overflow-x: hidden;
            }
            
            .dashboard-header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
                padding: 1rem;
                margin-bottom: 1rem;
            }
            
            .header-left {
                flex-direction: column;
                gap: 0.5rem;
                align-items: center;
            }
            
            .mobile-menu-btn {
                order: -1;
                margin: 0;
                display: block !important;
                background: var(--primary-color) !important;
                color: white !important;
                border: none !important;
                padding: 0.75rem !important;
                border-radius: 8px !important;
                cursor: pointer !important;
                font-size: 1.2rem !important;
                transition: all 0.3s ease !important;
                z-index: 1001 !important;
                position: relative !important;
            }
            
            .search-container {
                display: none;
            }
            
            .dashboard-header h1 {
                font-size: 1.5rem;
                margin: 0;
            }
            
            .dashboard-header p {
                font-size: 0.9rem;
                margin: 0;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
                margin-bottom: 1.5rem;
            }
            
            .stat-card {
                padding: 1rem;
                flex-direction: column;
                text-align: center;
                gap: 0.75rem;
                border: 1px solid #e2e8f0;
                box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            }
            
            .stat-icon {
                width: 40px;
                height: 40px;
                font-size: 1rem;
            }
            
            .stat-content h3 {
                font-size: 0.8rem;
                margin: 0;
            }
            
            .stat-number {
                font-size: 1.5rem;
                font-weight: bold;
            }
            
            .stat-change {
                font-size: 0.7rem;
            }
            
            .filter-row {
                flex-direction: column;
                align-items: stretch;
                gap: 1rem;
            }
            
            .filter-group {
                flex-direction: column;
                align-items: stretch;
                gap: 0.5rem;
            }
            
            .filter-group label {
                font-size: 0.9rem;
                margin-bottom: 0.25rem;
            }
            
            .filter-group input,
            .filter-group select {
                padding: 0.75rem;
                font-size: 0.9rem;
            }
            
            .form-row {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .section-header {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }
            
            .section-header h3 {
                font-size: 1.2rem;
                margin: 0;
            }
            
            .section-header .btn {
                width: 100%;
                padding: 0.75rem;
                font-size: 0.9rem;
            }
            
            .table-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                border-radius: 8px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            }
            
            table {
                min-width: 600px;
                font-size: 0.8rem;
                border-collapse: collapse;
            }
            
            table th,
            table td {
                padding: 0.5rem;
                text-align: center;
                border-bottom: 1px solid #e2e8f0;
            }
            
            table th {
                background: #f8fafc;
                font-weight: 600;
                color: #264673;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 0.25rem;
            }
            
            .btn-action {
                width: 100%;
                padding: 0.5rem;
                font-size: 0.8rem;
            }
            
            .modal-content {
                width: 95% !important;
                margin: 2.5% !important;
                max-height: 95vh !important;
                padding: 1rem !important;
                border-radius: 12px !important;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3) !important;
            }
            
            .modal-header h3 {
                font-size: 1.2rem !important;
            }
            
            .form-section {
                padding: 1rem !important;
                margin-bottom: 1rem !important;
            }
            
            .form-section h5 {
                font-size: 1rem !important;
                margin-bottom: 0.75rem !important;
            }
        }
        
        @media (max-width: 480px) {
            .mobile-menu-btn {
                display: block !important;
                background: var(--primary-color) !important;
                color: white !important;
                border: none !important;
                padding: 0.75rem !important;
                border-radius: 8px !important;
                cursor: pointer !important;
                font-size: 1.2rem !important;
                transition: all 0.3s ease !important;
                margin-left: 1rem !important;
                z-index: 1001 !important;
                position: relative !important;
            }
            
            .mobile-menu-btn:active {
                transform: scale(0.95) !important;
            }
            
            .main-content {
                padding: 0.25rem;
            }
            
            .dashboard-header {
                padding: 0.75rem;
            }
            
            .dashboard-header h1 {
                font-size: 1.3rem;
            }
            
            .stat-card {
                padding: 0.75rem;
            }
            
            .stat-number {
                font-size: 1.3rem;
            }
            
            .section-header h3 {
                font-size: 1.1rem;
            }
            
            table {
                font-size: 0.75rem;
                min-width: 500px;
            }
            
            .btn {
                padding: 0.5rem 0.75rem;
                font-size: 0.8rem;
            }
            
            .header-actions {
                flex-direction: column;
                gap: 0.5rem;
                align-items: center;
            }
            
            .user-info {
                flex-direction: column;
                gap: 0.25rem;
                text-align: center;
            }
        }

        /* User Management Styles */
        .user-type-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .user-type-badge.regional_manager {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .user-type-badge.station_manager {
            background: #dcfce7;
            color: #166534;
        }
        
        .user-type-badge.customer_service {
            background: #fef3c7;
            color: #92400e;
        }
        
        .user-type-badge.driver_manager {
            background: #f3e8ff;
            color: #7c3aed;
        }

        /* Enhanced Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal-content {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-header {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            color: white;
            padding: 1.5rem 2rem;
            border-radius: 1rem 1rem 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 1.25rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .modal-header .close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 1.5rem;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .modal-header .close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .modal-body {
            padding: 2rem;
        }

        .modal-footer {
            padding: 1.5rem 2rem;
            border-top: 1px solid #e2e8f0;
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            background: #f8fafc;
            border-radius: 0 0 1rem 1rem;
        }

        .form-section {
            margin-bottom: 2rem;
            border: 1px solid #e2e8f0;
            border-radius: 0.75rem;
            overflow: hidden;
        }

        .form-section-header {
            background: #f8fafc;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            position: relative;
        }

        .form-section-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #1e40af 0%, #f59e0b 100%);
        }

        .form-section-header h4 {
            margin: 0;
            color: #1e40af;
            font-size: 1rem;
            font-weight: 600;
        }

        .form-section-header i {
            color: #1e40af;
            font-size: 1.1rem;
        }

        .form-section-content {
            padding: 1.5rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .form-row:last-child {
            margin-bottom: 0;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-group label {
            font-weight: 600;
            color: #374151;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select {
            padding: 0.75rem 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 0.5rem;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            background: white;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-group input.error {
            border-color: #ef4444;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
        }

        .form-group input.success {
            border-color: #10b981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .required {
            color: #ef4444;
        }

        .permissions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .permission-group {
            background: #f8fafc;
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid #e2e8f0;
        }

        .permission-group h5 {
            margin: 0 0 0.75rem 0;
            color: var(--text-color);
            font-size: 0.9rem;
            font-weight: 600;
        }

        .permission-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
        }

        .permission-item input[type="checkbox"] {
            margin: 0;
        }

        .permission-item span {
            font-size: 0.85rem;
            color: var(--text-color);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #e2e8f0;
        }

        .user-avatar-large {
            width: 60px;
            height: 60px;
            background: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }

        .user-info-large h2 {
            margin: 0 0 0.25rem 0;
            color: var(--text-color);
        }

        .user-info-large p {
            margin: 0;
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .user-details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .detail-item label {
            font-size: 0.8rem;
            color: var(--text-light);
            font-weight: 500;
        }

        .detail-item span {
            color: var(--text-color);
            font-weight: 500;
        }

        .permissions-section {
            margin-top: 1.5rem;
        }

        .permissions-section h4 {
            margin: 0 0 1rem 0;
            color: var(--text-color);
        }

        .permissions-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .permission-tag {
            background: #e0f2fe;
            color: #0369a1;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .status-badge.suspended {
            background: #fee2e2;
            color: #dc2626;
        }
    </style>
</head>
<body>
    <div class="admin-dashboard">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <img src="images/colored-logo-arabic-1.svg" alt="نورث وست باص" style="height: 40px;">
                </div>
                <h3>لوحة التحكم</h3>
            </div>
            
            <nav class="sidebar-menu">
                <a href="#dashboard" class="menu-item active" onclick="showSection('dashboard')">
                    <i class="fas fa-tachometer-alt"></i>
                    الرئيسية
                </a>
                <a href="#bookings" class="menu-item" onclick="showSection('bookings')">
                    <i class="fas fa-calendar-check"></i>
                    الحجوزات
                </a>
                <a href="#trips" class="menu-item" onclick="showSection('trips')">
                    <i class="fas fa-bus"></i>
                    الرحلات
                </a>
                <a href="#customers" class="menu-item" onclick="showSection('customers')">
                    <i class="fas fa-users"></i>
                    إدارة العملاء
                </a>
                <a href="#drivers" class="menu-item" onclick="showSection('drivers')">
                    <i class="fas fa-user-tie"></i>
                    السائقين
                </a>
                <a href="#user-management" class="menu-item" onclick="showSection('user-management')">
                    <i class="fas fa-user-cog"></i>
                    إدارة المستخدمين
                </a>
                <a href="#fleet" class="menu-item" onclick="showSection('fleet')">
                    <i class="fas fa-car"></i>
                    الأسطول
                </a>
                <a href="#reports" class="menu-item" onclick="showSection('reports')">
                    <i class="fas fa-chart-bar"></i>
                    التقارير
                </a>
                <a href="#settings" class="menu-item" onclick="showSection('settings')">
                    <i class="fas fa-cog"></i>
                    الإعدادات
                </a>
                <a href="#" class="menu-item logout-item" onclick="logoutAdmin()" style="color: #dc2626; border-top: 1px solid #e5e7eb; margin-top: 1rem; padding-top: 1rem;">
                    <i class="fas fa-sign-out-alt"></i>
                    تسجيل الخروج
                </a>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Dashboard Header -->
            <div class="dashboard-header">
                <div class="header-left">
                    <button class="mobile-menu-btn" onclick="toggleSidebar()">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="dashboard-title">
                        <h1>لوحة تحكم الإدمن</h1>
                        <p>مرحباً بك في نظام إدارة نورث وست باص</p>
                    </div>
                </div>
                <!-- Advanced Search Bar -->
                <div class="search-container">
                    <div class="search-input-group">
                        <input type="text" id="globalSearch" placeholder="بحث شامل في جميع البيانات..." 
                               onkeyup="performAdvancedSearch()" class="search-input">
                        <select id="searchType" class="search-type-select">
                            <option value="all">الكل</option>
                            <option value="bookings">الحجوزات</option>
                            <option value="customers">العملاء</option>
                            <option value="trips">الرحلات</option>
                            <option value="drivers">السائقين</option>
                            <option value="fleet">الأسطول</option>
                        </select>
                        <button class="search-btn" onclick="performAdvancedSearch()">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                    <div id="searchResults" class="search-results"></div>
                </div>
                
                <div class="header-actions">
                    <!-- Dark Mode Toggle -->
                    
                    <!-- Notifications -->
                    <div class="notifications">
                        <button class="btn btn-secondary" title="الإشعارات" onclick="toggleNotifications()">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge">3</span>
                        </button>
                    </div>
                    
                    <div class="user-info">
                        <div class="user-avatar">أ</div>
                        <div class="user-details">
                            <h4>المدير</h4>
                            <p>admin@nwbus.sa</p>
                        </div>
                        <button class="logout-btn" onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i>
                            تسجيل خروج
                        </button>
                    </div>
                </div>
            </div>

            <!-- Dashboard Section -->
            <div id="dashboard" class="content-section">
                <!-- Statistics -->
                <div class="stats-grid">
                    <div class="stat-card" onclick="showSection('bookings')">
                        <div class="stat-icon">
                            <i class="fas fa-ticket-alt"></i>
                        </div>
                        <div class="stat-content">
                            <h3>إجمالي الحجوزات</h3>
                            <div class="stat-number" id="totalBookings">0</div>
                            <div class="stat-change neutral">لا توجد بيانات</div>
                        </div>
                    </div>
                    <div class="stat-card" onclick="showSection('customers')">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-content">
                            <h3>إجمالي العملاء</h3>
                            <div class="stat-number" id="totalCustomers">3</div>
                            <div class="stat-change positive">+2 هذا الشهر</div>
                        </div>
                    </div>
                    <div class="stat-card" onclick="showSection('customers')">
                        <div class="stat-icon">
                            <i class="fas fa-crown"></i>
                        </div>
                        <div class="stat-content">
                            <h3>عملاء VIP</h3>
                            <div class="stat-number" id="vipCustomers">1</div>
                            <div class="stat-change positive">33% من العملاء</div>
                        </div>
                    </div>
                    <div class="stat-card" onclick="showSection('reports')">
                        <div class="stat-icon">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="stat-content">
                            <h3>إجمالي الإيرادات</h3>
                            <div class="stat-number" id="totalRevenue">0 ريال</div>
                            <div class="stat-change neutral">لا توجد بيانات</div>
                        </div>
                    </div>
                </div>

                <!-- Real-time Updates -->
                <div class="content-section">
                    <div class="section-header">
                        <h3>التحديثات المباشرة</h3>
                        <div class="live-indicator">
                            <span class="live-dot"></span>
                            <span>مباشر</span>
                        </div>
                    </div>
                    <div class="section-content">
                        <div class="live-updates">
                            <div class="update-item">
                                <div class="update-content">
                                    <strong>لا توجد تحديثات حالياً</strong>
                                    <small>سيتم عرض التحديثات عند توفرها</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="content-section">
                    <div class="section-header">
                        <h3>الإجراءات السريعة</h3>
                    </div>
                    <div class="section-content">
                        <div class="quick-actions">
                            <div class="quick-action" onclick="showSection('trips')">
                                <i class="fas fa-plus"></i>
                                <h4>إضافة رحلة</h4>
                                <p>إضافة رحلة جديدة</p>
                            </div>
                            <div class="quick-action" onclick="showSection('drivers')">
                                <i class="fas fa-user-plus"></i>
                                <h4>إضافة سائق</h4>
                                <p>إضافة سائق جديد</p>
                            </div>
                            <div class="quick-action" onclick="showSection('fleet')">
                                <i class="fas fa-car"></i>
                                <h4>إدارة الأسطول</h4>
                                <p>إضافة أو تعديل باص</p>
                            </div>
                            <div class="quick-action" onclick="showSection('reports')">
                                <i class="fas fa-chart-line"></i>
                                <h4>التقارير</h4>
                                <p>عرض التقارير والإحصائيات</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Bookings -->
                <div class="content-section">
                    <div class="section-header">
                        <h3>آخر الحجوزات</h3>
                    </div>
                    <div class="section-content">
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>رقم الحجز</th>
                                        <th>العميل</th>
                                        <th>الرحلة</th>
                                        <th>التاريخ</th>
                                        <th>الحالة</th>
                                        <th>الإجراءات</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td colspan="6" style="text-align: center; padding: 2rem; color: #64748b;">
                                            <i class="fas fa-inbox" style="font-size: 2rem; margin-bottom: 1rem; display: block;"></i>
                                            <strong>لا توجد حجوزات حالياً</strong>
                                            <br><small>سيتم عرض الحجوزات عند توفرها</small>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Other sections will be added here -->
            <div id="bookings" class="content-section" style="display: none;">
                <div class="section-header">
                    <h3>إدارة الحجوزات</h3>
                    <div class="header-actions">
                        <button class="btn btn-success" onclick="exportBookings()">
                            <i class="fas fa-download"></i> تصدير
                        </button>
                        <button class="btn btn-primary" onclick="refreshBookings()">
                            <i class="fas fa-refresh"></i> تحديث
                        </button>
                    </div>
                </div>
                <div class="section-content">
                    <!-- Booking Filters -->
                    <div class="filters-section">
                        <div class="filter-row">
                            <div class="filter-group">
                                <label>البحث:</label>
                                <input type="text" id="bookingSearch" placeholder="رقم الحجز أو اسم العميل..." onkeyup="filterBookings()">
                            </div>
                            <div class="filter-group">
                                <label>الحالة:</label>
                                <select id="bookingStatus" onchange="filterBookings()">
                                    <option value="">الكل</option>
                                    <option value="confirmed">مؤكد</option>
                                    <option value="pending">في الانتظار</option>
                                    <option value="cancelled">ملغي</option>
                                    <option value="completed">مكتمل</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>التاريخ:</label>
                                <input type="date" id="bookingDate" onchange="filterBookings()">
                            </div>
                            <div class="filter-group">
                                <label>نوع الرحلة:</label>
                                <select id="tripTypeFilter" onchange="filterBookings()">
                                    <option value="">الكل</option>
                                    <option value="regular">عادي</option>
                                    <option value="vip">VIP</option>
                                    <option value="premium">فاخر</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <button class="btn btn-secondary" onclick="resetBookingFilters()">
                                    <i class="fas fa-refresh"></i> إعادة تعيين
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Bookings Table -->
                    <div class="table-container">
                        <table class="data-table" id="bookingsTable">
                            <thead>
                                <tr>
                                    <th>رقم الحجز</th>
                                    <th>العميل</th>
                                    <th>الرحلة</th>
                                    <th>التاريخ</th>
                                    <th>المقاعد</th>
                                    <th>المبلغ</th>
                                    <th>طريقة الدفع</th>
                                    <th>الحالة</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="9" style="text-align: center; padding: 2rem; color: #64748b;">
                                        <i class="fas fa-inbox" style="font-size: 2rem; margin-bottom: 1rem; display: block;"></i>
                                        <strong>لا توجد حجوزات حالياً</strong>
                                        <br><small>سيتم عرض الحجوزات عند توفرها</small>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="trips" class="content-section" style="display: none;">
                <div class="section-header">
                    <h3>إدارة الرحلات</h3>
                    <button class="btn btn-primary" onclick="showAddTripModal()">
                        <i class="fas fa-plus"></i> إضافة رحلة جديدة
                    </button>
                </div>
                <div class="section-content">
                    <!-- Trip Filters -->
                    <div class="filters-section">
                        <div class="filter-row">
                            <div class="filter-group">
                                <label>البحث:</label>
                                <input type="text" id="tripSearch" placeholder="رقم الرحلة أو المسار..." onkeyup="filterTrips()">
                            </div>
                            <div class="filter-group">
                                <label>الحالة:</label>
                                <select id="tripStatus" onchange="filterTrips()">
                                    <option value="">الكل</option>
                                    <option value="scheduled">مجدولة</option>
                                    <option value="active">جارية</option>
                                    <option value="completed">مكتملة</option>
                                    <option value="cancelled">ملغية</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>التاريخ:</label>
                                <input type="date" id="tripDate" onchange="filterTrips()">
                            </div>
                            <div class="filter-group">
                                <button class="btn btn-secondary" onclick="resetFilters()">
                                    <i class="fas fa-refresh"></i> إعادة تعيين
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Trips Table -->
                    <div class="table-container">
                        <table class="data-table" id="tripsTable">
                            <thead>
                                <tr>
                                    <th>رقم الرحلة</th>
                                    <th>المسار</th>
                                    <th>التاريخ</th>
                                    <th>الوقت</th>
                                    <th>السائق</th>
                                    <th>الباص</th>
                                    <th>المقاعد</th>
                                    <th>الحالة</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="9" style="text-align: center; padding: 2rem; color: #64748b;">
                                        <i class="fas fa-bus" style="font-size: 2rem; margin-bottom: 1rem; display: block;"></i>
                                        <strong>لا توجد رحلات مجدولة حالياً</strong>
                                        <br><small>سيتم عرض الرحلات عند جدولتها</small>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="customers" class="content-section" style="display: none;">
                <div class="section-header">
                    <h2><i class="fas fa-users"></i> إدارة العملاء</h2>
                    <button class="btn btn-primary" onclick="showAddCustomerModal()">
                        <i class="fas fa-plus"></i> إضافة عميل جديد
                    </button>
                </div>

                <!-- Customer Filters -->
                <div class="filters-section">
                    <div class="filter-row">
                        <div class="filter-group">
                            <label>البحث:</label>
                            <input type="text" id="customerSearch" placeholder="البحث بالاسم أو البريد الإلكتروني أو رقم الهاتف" onkeyup="filterCustomers()">
                        </div>
                        <div class="filter-group">
                            <label>الحالة:</label>
                            <select id="customerStatusFilter" onchange="filterCustomers()">
                                <option value="">جميع العملاء</option>
                                <option value="active">نشط</option>
                                <option value="inactive">غير نشط</option>
                                <option value="vip">VIP</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>تاريخ التسجيل:</label>
                            <input type="date" id="customerDateFilter" onchange="filterCustomers()">
                        </div>
                        <button class="btn btn-secondary" onclick="resetCustomerFilters()">
                            <i class="fas fa-refresh"></i> إعادة تعيين
                        </button>
                        <button class="btn btn-danger" onclick="clearAllDummyCustomers()" style="margin-right: 10px;">
                            <i class="fas fa-trash"></i> حذف العملاء الوهميين
                        </button>
                    </div>
                </div>

                <!-- Customers Table -->
                <div class="table-container">
                    <table class="data-table" id="customersTable">
                        <thead>
                            <tr>
                                <th>العميل</th>
                                <th>معلومات الاتصال</th>
                                <th>العنوان</th>
                                <th>تاريخ التسجيل</th>
                                <th>عدد الحجوزات</th>
                                <th>إجمالي المدفوعات</th>
                                <th>الحالة</th>
                                <th>الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Customer Data -->
                            <tr>
                                <td>
                                    <div class="customer-info">
                                        <div class="customer-avatar">
                                            <i class="fas fa-user"></i>
                                        </div>
                                        <div class="customer-details">
                                            <strong>أحمد محمد العلي</strong>
                                            <small>NW20241220001</small>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="contact-info">
                                        <div><i class="fas fa-envelope"></i> ahmed@email.com</div>
                                        <div><i class="fas fa-phone"></i> +966501234567</div>
                                        <div><i class="fab fa-whatsapp"></i> +966501234567</div>
                                    </div>
                                </td>
                                <td>
                                    <div class="address-info">
                                        <div><i class="fas fa-map-marker-alt"></i> الرياض، حي النرجس</div>
                                        <div><i class="fas fa-home"></i> شارع الملك فهد، رقم 123</div>
                                    </div>
                                </td>
                                <td>2024-12-20</td>
                                <td><span class="badge">15</span></td>
                                <td><span class="amount">2,500 ريال</span></td>
                                <td><span class="status-badge status-confirmed">نشط</span></td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn-action btn-view" onclick="viewCustomer('NW20241220001')" title="عرض التفاصيل">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn-action btn-edit" onclick="editCustomer('NW20241220001')" title="تعديل">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn-action btn-message" onclick="messageCustomer('NW20241220001')" title="إرسال رسالة">
                                            <i class="fas fa-envelope"></i>
                                        </button>
                                        <button class="btn-action btn-delete" onclick="deleteCustomer('NW20241220001')" title="حذف">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            
                            <tr>
                                <td>
                                    <div class="customer-info">
                                        <div class="customer-avatar">
                                            <i class="fas fa-user"></i>
                                        </div>
                                        <div class="customer-details">
                                            <strong>فاطمة أحمد السعد</strong>
                                            <small>NW20241220002</small>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="contact-info">
                                        <div><i class="fas fa-envelope"></i> fatima@email.com</div>
                                        <div><i class="fas fa-phone"></i> +966502345678</div>
                                        <div><i class="fab fa-whatsapp"></i> +966502345678</div>
                                    </div>
                                </td>
                                <td>
                                    <div class="address-info">
                                        <div><i class="fas fa-map-marker-alt"></i> جدة، حي الروضة</div>
                                        <div><i class="fas fa-home"></i> شارع التحلية، رقم 456</div>
                                    </div>
                                </td>
                                <td>2024-12-19</td>
                                <td><span class="badge">8</span></td>
                                <td><span class="amount">1,200 ريال</span></td>
                                <td><span class="status-badge status-confirmed">نشط</span></td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn-action btn-view" onclick="viewCustomer('NW20241220002')" title="عرض التفاصيل">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn-action btn-edit" onclick="editCustomer('NW20241220002')" title="تعديل">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn-action btn-message" onclick="messageCustomer('NW20241220002')" title="إرسال رسالة">
                                            <i class="fas fa-envelope"></i>
                                        </button>
                                        <button class="btn-action btn-delete" onclick="deleteCustomer('NW20241220002')" title="حذف">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            
                            <tr>
                                <td>
                                    <div class="customer-info">
                                        <div class="customer-avatar vip">
                                            <i class="fas fa-crown"></i>
                                        </div>
                                        <div class="customer-details">
                                            <strong>محمد عبدالله القحطاني</strong>
                                            <small>NW20241220003</small>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="contact-info">
                                        <div><i class="fas fa-envelope"></i> mohammed@email.com</div>
                                        <div><i class="fas fa-phone"></i> +966503456789</div>
                                        <div><i class="fab fa-whatsapp"></i> +966503456789</div>
                                    </div>
                                </td>
                                <td>
                                    <div class="address-info">
                                        <div><i class="fas fa-map-marker-alt"></i> مكة المكرمة، حي العزيزية</div>
                                        <div><i class="fas fa-home"></i> شارع الملك عبدالعزيز، رقم 789</div>
                                    </div>
                                </td>
                                <td>2024-12-18</td>
                                <td><span class="badge">25</span></td>
                                <td><span class="amount">5,000 ريال</span></td>
                                <td><span class="status-badge status-vip">VIP</span></td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn-action btn-view" onclick="viewCustomer('NW20241220003')" title="عرض التفاصيل">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn-action btn-edit" onclick="editCustomer('NW20241220003')" title="تعديل">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn-action btn-message" onclick="messageCustomer('NW20241220003')" title="إرسال رسالة">
                                            <i class="fas fa-envelope"></i>
                                        </button>
                                        <button class="btn-action btn-delete" onclick="deleteCustomer('NW20241220003')" title="حذف">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="drivers" class="content-section" style="display: none;">
                <div class="section-header">
                    <h2><i class="fas fa-user-tie"></i> إدارة السائقين</h2>
                    <button class="btn btn-primary" onclick="showAddDriverModal()">
                        <i class="fas fa-plus"></i> إضافة سائق جديد
                    </button>
                </div>

                <!-- Driver Filters -->
                <div class="filters-section">
                    <div class="filter-row">
                        <div class="filter-group">
                            <label>البحث:</label>
                            <input type="text" id="driverSearch" placeholder="البحث بالاسم أو رقم الهاتف أو رخصة القيادة" onkeyup="filterDrivers()">
                        </div>
                        <div class="filter-group">
                            <label>الحالة:</label>
                            <select id="driverStatusFilter" onchange="filterDrivers()">
                                <option value="">جميع السائقين</option>
                                <option value="نشط">نشط</option>
                                <option value="غير نشط">غير نشط</option>
                                <option value="في إجازة">في إجازة</option>
                                <option value="معلق">معلق</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>نوع الرخصة:</label>
                            <select id="licenseTypeFilter" onchange="filterDrivers()">
                                <option value="">جميع الأنواع</option>
                                <option value="خاص">خاص</option>
                                <option value="نقل عام">نقل عام</option>
                                <option value="نقل ثقيل">نقل ثقيل</option>
                            </select>
                        </div>
                        <button class="btn btn-secondary" onclick="resetDriverFilters()">
                            <i class="fas fa-refresh"></i> إعادة تعيين
                        </button>
                    </div>
                </div>

                <!-- Drivers Table -->
                <div class="table-container">
                    <table class="data-table" id="driversTable">
                        <thead>
                            <tr>
                                <th>السائق</th>
                                <th>معلومات الاتصال</th>
                                <th>رخصة القيادة</th>
                                <th>تاريخ التوظيف</th>
                                <th>الرحلات المكتملة</th>
                                <th>التقييم</th>
                                <th>الحالة</th>
                                <th>الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="8" style="text-align: center; padding: 2rem; color: #64748b;">
                                    <i class="fas fa-user-tie" style="font-size: 2rem; margin-bottom: 1rem; display: block;"></i>
                                    <strong>لا توجد سائقين مسجلين حالياً</strong>
                                    <br><small>سيتم عرض السائقين عند تسجيلهم</small>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- User Management Section -->
            <div id="user-management" class="content-section" style="display: none;">
                <div class="section-header">
                    <h2><i class="fas fa-user-cog"></i> إدارة المستخدمين</h2>
                    <button class="btn btn-primary" onclick="showAddUserModal()">
                        <i class="fas fa-plus"></i> إضافة مستخدم جديد
                    </button>
                </div>

                <!-- User Filters -->
                <div class="filters-section">
                    <div class="filter-row">
                        <div class="filter-group">
                            <label>البحث:</label>
                            <input type="text" id="userSearch" placeholder="البحث بالاسم أو البريد الإلكتروني" onkeyup="filterUsers()">
                        </div>
                        <div class="filter-group">
                            <label>المنطقة:</label>
                            <select id="userRegionFilter" onchange="filterUsers()">
                                <option value="">جميع المناطق</option>
                                <option value="riyadh">الرياض</option>
                                <option value="jeddah">جدة</option>
                                <option value="dammam">الدمام</option>
                                <option value="makkah">مكة المكرمة</option>
                                <option value="medina">المدينة المنورة</option>
                                <option value="taif">الطائف</option>
                                <option value="abha">أبها</option>
                                <option value="tabuk">تبوك</option>
                                <option value="hail">حائل</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>نوع المستخدم:</label>
                            <select id="userTypeFilter" onchange="filterUsers()">
                                <option value="">جميع الأنواع</option>
                                <option value="regional_manager">مدير إقليمي</option>
                                <option value="station_manager">مدير محطة</option>
                                <option value="customer_service">خدمة العملاء</option>
                                <option value="driver_manager">مدير السائقين</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>الحالة:</label>
                            <select id="userStatusFilter" onchange="filterUsers()">
                                <option value="">جميع الحالات</option>
                                <option value="active">نشط</option>
                                <option value="inactive">غير نشط</option>
                                <option value="suspended">معلق</option>
                            </select>
                        </div>
                        <button class="btn btn-secondary" onclick="resetUserFilters()">
                            <i class="fas fa-refresh"></i> إعادة تعيين
                        </button>
                    </div>
                </div>

                <!-- Users Table -->
                <div class="table-container">
                    <table class="data-table" id="usersTable">
                        <thead>
                            <tr>
                                <th>المستخدم</th>
                                <th>نوع المستخدم</th>
                                <th>المنطقة</th>
                                <th>البريد الإلكتروني</th>
                                <th>رقم الهاتف</th>
                                <th>الحالة</th>
                                <th>تاريخ الإنشاء</th>
                                <th>آخر دخول</th>
                                <th>الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <!-- Users will be loaded here -->
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <div class="pagination" id="usersPagination">
                    <!-- Pagination will be generated here -->
                </div>
            </div>

            <div id="fleet" class="content-section" style="display: none;">
                <div class="section-header">
                    <h3><i class="fas fa-bus"></i> إدارة الأسطول</h3>
                    <div class="section-actions">
                        <button class="btn btn-primary" onclick="showAddFleetModal()">
                            <i class="fas fa-plus"></i> إضافة مركبة
                        </button>
                    </div>
                </div>
                <div class="section-content">
                    <!-- Fleet Filters -->
                    <div class="filters-section">
                        <div class="filter-row">
                            <div class="filter-group">
                                <input type="text" id="fleetSearch" placeholder="البحث عن المركبة..." onkeyup="filterFleet()">
                                <i class="fas fa-search"></i>
                            </div>
                            <div class="filter-group">
                                <select id="fleetStatusFilter" onchange="filterFleet()">
                                    <option value="">جميع الحالات</option>
                                    <option value="نشط">نشط</option>
                                    <option value="في الصيانة">في الصيانة</option>
                                    <option value="خارج الخدمة">خارج الخدمة</option>
                                    <option value="محجوز">محجوز</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <select id="fleetTypeFilter" onchange="filterFleet()">
                                    <option value="">جميع الأنواع</option>
                                    <option value="حافلة صغيرة">حافلة صغيرة</option>
                                    <option value="حافلة متوسطة">حافلة متوسطة</option>
                                    <option value="حافلة كبيرة">حافلة كبيرة</option>
                                    <option value="حافلة فاخرة">حافلة فاخرة</option>
                                </select>
                            </div>
                            <button class="btn btn-secondary" onclick="resetFleetFilters()">
                                <i class="fas fa-refresh"></i> إعادة تعيين
                            </button>
                        </div>
                    </div>

                    <!-- Fleet Table -->
                    <div class="table-container">
                        <table class="data-table" id="fleetTable">
                            <thead>
                                <tr>
                                    <th>المركبة</th>
                                    <th>المعلومات التقنية</th>
                                    <th>الحالة</th>
                                    <th>الموقع الحالي</th>
                                    <th>آخر صيانة</th>
                                    <th>المسافة المقطوعة</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="7" style="text-align: center; padding: 2rem; color: #64748b;">
                                        <i class="fas fa-car" style="font-size: 2rem; margin-bottom: 1rem; display: block;"></i>
                                        <strong>لا توجد مركبات مسجلة حالياً</strong>
                                        <br><small>سيتم عرض المركبات عند تسجيلها</small>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="reports" class="content-section" style="display: none;">
                <div class="section-header">
                    <h3><i class="fas fa-chart-bar"></i> التقارير والإحصائيات</h3>
                    <div class="section-actions">
                        <button class="btn btn-primary" onclick="generateReport()">
                            <i class="fas fa-download"></i> تصدير تقرير
                        </button>
                    </div>
                </div>
                <div class="section-content">
                    <!-- Report Filters -->
                    <div class="filters-section">
                        <div class="filter-row">
                            <div class="filter-group">
                                <label for="reportType">نوع التقرير</label>
                                <select id="reportType" onchange="updateReportFilters()">
                                    <option value="overview">نظرة عامة</option>
                                    <option value="bookings">تقارير الحجوزات</option>
                                    <option value="trips">تقارير الرحلات</option>
                                    <option value="revenue">تقارير الإيرادات</option>
                                    <option value="fleet">تقارير الأسطول</option>
                                    <option value="drivers">تقارير السائقين</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label for="dateRange">الفترة الزمنية</label>
                                <select id="dateRange" onchange="updateReportData()">
                                    <option value="today">اليوم</option>
                                    <option value="week">هذا الأسبوع</option>
                                    <option value="month" selected>هذا الشهر</option>
                                    <option value="quarter">هذا الربع</option>
                                    <option value="year">هذا العام</option>
                                    <option value="custom">فترة مخصصة</option>
                                </select>
                            </div>
                            <div class="filter-group" id="customDateRange" style="display: none;">
                                <label for="startDate">من تاريخ</label>
                                <input type="date" id="startDate" onchange="updateReportData()">
                            </div>
                            <div class="filter-group" id="customDateRange2" style="display: none;">
                                <label for="endDate">إلى تاريخ</label>
                                <input type="date" id="endDate" onchange="updateReportData()">
                            </div>
                            <button class="btn btn-secondary" onclick="refreshReportData()">
                                <i class="fas fa-refresh"></i> تحديث
                            </button>
                        </div>
                    </div>

                    <!-- Overview Dashboard -->
                    <div class="reports-dashboard" id="overviewReport">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-ticket-alt"></i>
                                </div>
                                <div class="stat-content">
                                    <h3>إجمالي الحجوزات</h3>
                                    <div class="stat-number">0</div>
                                    <div class="stat-change neutral">لا توجد بيانات</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-route"></i>
                                </div>
                                <div class="stat-content">
                                    <h3>الرحلات المكتملة</h3>
                                    <div class="stat-number">0</div>
                                    <div class="stat-change neutral">لا توجد بيانات</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-dollar-sign"></i>
                                </div>
                                <div class="stat-content">
                                    <h3>إجمالي الإيرادات</h3>
                                    <div class="stat-number">0 ريال</div>
                                    <div class="stat-change neutral">لا توجد بيانات</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="stat-content">
                                    <h3>العملاء الجدد</h3>
                                    <div class="stat-number">0</div>
                                    <div class="stat-change neutral">لا توجد بيانات</div>
                                </div>
                            </div>
                        </div>

                        <!-- Charts Section -->
                        <div class="charts-section">
                            <div class="chart-container" style="background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%); border-radius: 16px; padding: 2rem; box-shadow: 0 4px 20px rgba(38, 70, 115, 0.1); border: 1px solid rgba(38, 70, 115, 0.1);">
                                <div style="text-align: center; position: relative;">
                                    <div style="font-size: 4rem; font-weight: bold; color: #22c55e; margin-bottom: 0.5rem; text-shadow: 0 2px 4px rgba(34, 197, 94, 0.2);">245,000</div>
                                    <div style="color: #64748b; font-size: 1.1rem; margin-bottom: 1.5rem;">ريال سعودي</div>
                                    <div style="padding: 0.8rem 1.5rem; background: linear-gradient(135deg, #22c55e, #16a34a); color: white; border-radius: 25px; display: inline-block; font-size: 1rem; font-weight: 600; box-shadow: 0 4px 15px rgba(34, 197, 94, 0.3);">
                                        <i class="fas fa-arrow-up" style="margin-left: 0.5rem;"></i>
                                        +15% من الشهر الماضي
                                    </div>
                                </div>
                            </div>
                            
                            <div class="chart-container" style="background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%); border-radius: 16px; padding: 2rem; box-shadow: 0 4px 20px rgba(38, 70, 115, 0.1); border: 1px solid rgba(38, 70, 115, 0.1);">
                                <div style="text-align: center; position: relative;">
                                    <div style="display: flex; gap: 2rem; justify-content: center; margin-bottom: 1rem;">
                                        <div style="text-align: center;">
                                            <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #22c55e, #16a34a); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; margin: 0 auto 0.8rem; box-shadow: 0 4px 15px rgba(34, 197, 94, 0.3); font-size: 1.2rem;">1156</div>
                                            <div style="font-size: 1rem; color: #64748b; font-weight: 600;">مؤكد</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #f59e0b, #d97706); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; margin: 0 auto 0.8rem; box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3); font-size: 1.2rem;">91</div>
                                            <div style="font-size: 1rem; color: #64748b; font-weight: 600;">معلق</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #ef4444, #dc2626); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; margin: 0 auto 0.8rem; box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3); font-size: 1.2rem;">45</div>
                                            <div style="font-size: 1rem; color: #64748b; font-weight: 600;">ملغي</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="chart-container" style="background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%); border-radius: 16px; padding: 2rem; box-shadow: 0 4px 20px rgba(38, 70, 115, 0.1); border: 1px solid rgba(38, 70, 115, 0.1);">
                                <div style="text-align: center; position: relative;">
                                    <div style="display: flex; justify-content: space-around; align-items: end; height: 180px; margin: 0 1rem; padding: 1rem 0;">
                                        <div style="text-align: center;">
                                            <div style="width: 50px; height: 140px; background: linear-gradient(to top, #264673, #3a5a7a); border-radius: 8px; margin: 0 auto 0.8rem; box-shadow: 0 4px 15px rgba(38, 70, 115, 0.3); position: relative;">
                                                <div style="position: absolute; top: -25px; left: 50%; transform: translateX(-50%); background: #264673; color: white; padding: 0.3rem 0.6rem; border-radius: 12px; font-size: 0.8rem; font-weight: bold;">45</div>
                                            </div>
                                            <div style="font-size: 1rem; color: #64748b; font-weight: 600;">الرياض</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="width: 50px; height: 120px; background: linear-gradient(to top, #264673, #3a5a7a); border-radius: 8px; margin: 0 auto 0.8rem; box-shadow: 0 4px 15px rgba(38, 70, 115, 0.3); position: relative;">
                                                <div style="position: absolute; top: -25px; left: 50%; transform: translateX(-50%); background: #264673; color: white; padding: 0.3rem 0.6rem; border-radius: 12px; font-size: 0.8rem; font-weight: bold;">38</div>
                                            </div>
                                            <div style="font-size: 1rem; color: #64748b; font-weight: 600;">جدة</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="width: 50px; height: 100px; background: linear-gradient(to top, #264673, #3a5a7a); border-radius: 8px; margin: 0 auto 0.8rem; box-shadow: 0 4px 15px rgba(38, 70, 115, 0.3); position: relative;">
                                                <div style="position: absolute; top: -25px; left: 50%; transform: translateX(-50%); background: #264673; color: white; padding: 0.3rem 0.6rem; border-radius: 12px; font-size: 0.8rem; font-weight: bold;">32</div>
                                            </div>
                                            <div style="font-size: 1rem; color: #64748b; font-weight: 600;">الدمام</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="width: 50px; height: 80px; background: linear-gradient(to top, #264673, #3a5a7a); border-radius: 8px; margin: 0 auto 0.8rem; box-shadow: 0 4px 15px rgba(38, 70, 115, 0.3); position: relative;">
                                                <div style="position: absolute; top: -25px; left: 50%; transform: translateX(-50%); background: #264673; color: white; padding: 0.3rem 0.6rem; border-radius: 12px; font-size: 0.8rem; font-weight: bold;">28</div>
                                            </div>
                                            <div style="font-size: 1rem; color: #64748b; font-weight: 600;">مكة</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="width: 50px; height: 60px; background: linear-gradient(to top, #264673, #3a5a7a); border-radius: 8px; margin: 0 auto 0.8rem; box-shadow: 0 4px 15px rgba(38, 70, 115, 0.3); position: relative;">
                                                <div style="position: absolute; top: -25px; left: 50%; transform: translateX(-50%); background: #264673; color: white; padding: 0.3rem 0.6rem; border-radius: 12px; font-size: 0.8rem; font-weight: bold;">25</div>
                                            </div>
                                            <div style="font-size: 1rem; color: #64748b; font-weight: 600;">المدينة</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Top Routes -->
                        <div class="top-routes-section">
                            <h4><i class="fas fa-map-marked-alt"></i> أكثر المسارات طلباً</h4>
                            <div class="routes-list">
                                <div class="route-item">
                                    <div class="route-info">
                                        <div class="route-name">الرياض - جدة</div>
                                        <div class="route-distance">879 كم</div>
                                    </div>
                                    <div class="route-stats">
                                        <div class="route-bookings">245 حجز</div>
                                        <div class="route-revenue">49,000 ريال</div>
                                    </div>
                                </div>
                                <div class="route-item">
                                    <div class="route-info">
                                        <div class="route-name">جدة - الدمام</div>
                                        <div class="route-distance">1,234 كم</div>
                                    </div>
                                    <div class="route-stats">
                                        <div class="route-bookings">189 حجز</div>
                                        <div class="route-revenue">37,800 ريال</div>
                                    </div>
                                </div>
                                <div class="route-item">
                                    <div class="route-info">
                                        <div class="route-name">الرياض - الدمام</div>
                                        <div class="route-distance">395 كم</div>
                                    </div>
                                    <div class="route-stats">
                                        <div class="route-bookings">156 حجز</div>
                                        <div class="route-revenue">31,200 ريال</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Bookings Report -->
                    <div class="reports-dashboard" id="bookingsReport" style="display: none;">
                        <div class="report-section">
                            <h4><i class="fas fa-ticket-alt"></i> تقرير الحجوزات</h4>
                            <div class="report-stats">
                                <div class="report-stat">
                                    <div class="stat-label">إجمالي الحجوزات</div>
                                    <div class="stat-value">1,247</div>
                                </div>
                                <div class="report-stat">
                                    <div class="stat-label">الحجوزات المؤكدة</div>
                                    <div class="stat-value">1,156</div>
                                </div>
                                <div class="report-stat">
                                    <div class="stat-label">الحجوزات المعلقة</div>
                                    <div class="stat-value">91</div>
                                </div>
                                <div class="report-stat">
                                    <div class="stat-label">معدل الإلغاء</div>
                                    <div class="stat-value">7.3%</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Revenue Report -->
                    <div class="reports-dashboard" id="revenueReport" style="display: none;">
                        <div class="report-section">
                            <h4><i class="fas fa-dollar-sign"></i> تقرير الإيرادات</h4>
                            <div class="revenue-breakdown">
                                <div class="revenue-item">
                                    <div class="revenue-label">إيرادات التذاكر</div>
                                    <div class="revenue-amount">198,450 ريال</div>
                                    <div class="revenue-percentage">80.8%</div>
                                </div>
                                <div class="revenue-item">
                                    <div class="revenue-label">رسوم إضافية</div>
                                    <div class="revenue-amount">32,180 ريال</div>
                                    <div class="revenue-percentage">13.1%</div>
                                </div>
                                <div class="revenue-item">
                                    <div class="revenue-label">خدمات أخرى</div>
                                    <div class="revenue-amount">15,050 ريال</div>
                                    <div class="revenue-percentage">6.1%</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Fleet Report -->
                    <div class="reports-dashboard" id="fleetReport" style="display: none;">
                        <div class="report-section">
                            <h4><i class="fas fa-bus"></i> تقرير الأسطول</h4>
                            <div class="fleet-stats">
                                <div class="fleet-stat">
                                    <div class="stat-label">إجمالي المركبات</div>
                                    <div class="stat-value">24</div>
                                </div>
                                <div class="fleet-stat">
                                    <div class="stat-label">المركبات النشطة</div>
                                    <div class="stat-value">18</div>
                                </div>
                                <div class="fleet-stat">
                                    <div class="stat-label">في الصيانة</div>
                                    <div class="stat-value">4</div>
                                </div>
                                <div class="fleet-stat">
                                    <div class="stat-label">خارج الخدمة</div>
                                    <div class="stat-value">2</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="settings" class="content-section" style="display: none;">
                <div class="section-header">
                    <h3><i class="fas fa-cog"></i> الإعدادات والنظام</h3>
                    <div class="section-actions">
                        <button class="btn btn-primary" onclick="saveAllSettings()">
                            <i class="fas fa-save"></i> حفظ جميع الإعدادات
                        </button>
                    </div>
                </div>
                <div class="section-content">
                    <!-- Settings Tabs -->
                    <div class="settings-tabs">
                        <button class="tab-btn active" onclick="showSettingsTab('general')">
                            <i class="fas fa-cog"></i> الإعدادات العامة
                        </button>
                        <button class="tab-btn" onclick="showSettingsTab('company')">
                            <i class="fas fa-building"></i> معلومات الشركة
                        </button>
                        <button class="tab-btn" onclick="showSettingsTab('pricing')">
                            <i class="fas fa-dollar-sign"></i> التسعير
                        </button>
                        <button class="tab-btn" onclick="showSettingsTab('notifications')">
                            <i class="fas fa-bell"></i> الإشعارات
                        </button>
                        <button class="tab-btn" onclick="showSettingsTab('security')">
                            <i class="fas fa-shield-alt"></i> الأمان
                        </button>
                        <button class="tab-btn" onclick="showSettingsTab('backup')">
                            <i class="fas fa-database"></i> النسخ الاحتياطي
                        </button>
                    </div>

                    <!-- General Settings -->
                    <div class="settings-tab-content" id="generalSettings">
                        <div class="settings-section">
                            <h4><i class="fas fa-cog"></i> الإعدادات العامة</h4>
                            <div class="settings-grid">
                                <div class="setting-item">
                                    <label for="siteName">اسم الموقع</label>
                                    <input type="text" id="siteName" value="نورث وست باص" placeholder="اسم الموقع">
                                </div>
                                <div class="setting-item">
                                    <label for="siteLanguage">لغة الموقع</label>
                                    <select id="siteLanguage">
                                        <option value="ar" selected>العربية</option>
                                        <option value="en">English</option>
                                        <option value="ur">اردو</option>
                                    </select>
                                </div>
                                <div class="setting-item">
                                    <label for="timezone">المنطقة الزمنية</label>
                                    <select id="timezone">
                                        <option value="Asia/Riyadh" selected>الرياض (GMT+3)</option>
                                        <option value="Asia/Dubai">دبي (GMT+4)</option>
                                        <option value="Asia/Kuwait">الكويت (GMT+3)</option>
                                    </select>
                                </div>
                                <div class="setting-item">
                                    <label for="currency">العملة</label>
                                    <select id="currency">
                                        <option value="SAR" selected>ريال سعودي (SAR)</option>
                                        <option value="AED">درهم إماراتي (AED)</option>
                                        <option value="KWD">دينار كويتي (KWD)</option>
                                    </select>
                                </div>
                                <div class="setting-item">
                                    <label for="dateFormat">تنسيق التاريخ</label>
                                    <select id="dateFormat">
                                        <option value="dd/mm/yyyy" selected>يوم/شهر/سنة</option>
                                        <option value="mm/dd/yyyy">شهر/يوم/سنة</option>
                                        <option value="yyyy-mm-dd">سنة-شهر-يوم</option>
                                    </select>
                                </div>
                                <div class="setting-item">
                                    <label for="timeFormat">تنسيق الوقت</label>
                                    <select id="timeFormat">
                                        <option value="12" selected>12 ساعة</option>
                                        <option value="24">24 ساعة</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Company Settings -->
                    <div class="settings-tab-content" id="companySettings" style="display: none;">
                        <div class="settings-section">
                            <h4><i class="fas fa-building"></i> معلومات الشركة</h4>
                            <div class="settings-grid">
                                <div class="setting-item">
                                    <label for="companyName">اسم الشركة</label>
                                    <input type="text" id="companyName" value="نورث وست باص" placeholder="اسم الشركة">
                                </div>
                                <div class="setting-item">
                                    <label for="companyEmail">البريد الإلكتروني</label>
                                    <input type="email" id="companyEmail" value="info@northwestbus.com" placeholder="البريد الإلكتروني">
                                </div>
                                <div class="setting-item">
                                    <label for="companyPhone">رقم الهاتف</label>
                                    <input type="tel" id="companyPhone" value="+966501234567" placeholder="رقم الهاتف">
                                </div>
                                <div class="setting-item">
                                    <label for="companyAddress">العنوان</label>
                                    <textarea id="companyAddress" rows="3" placeholder="عنوان الشركة">الرياض، المملكة العربية السعودية</textarea>
                                </div>
                                <div class="setting-item">
                                    <label for="companyWebsite">الموقع الإلكتروني</label>
                                    <input type="url" id="companyWebsite" value="https://northwestbus.com" placeholder="الموقع الإلكتروني">
                                </div>
                                <div class="setting-item">
                                    <label for="companyLogo">شعار الشركة</label>
                                    <input type="file" id="companyLogo" accept="image/*">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Pricing Settings -->
                    <div class="settings-tab-content" id="pricingSettings" style="display: none;">
                        <div class="settings-section">
                            <h4><i class="fas fa-dollar-sign"></i> إعدادات التسعير</h4>
                            <div class="settings-grid">
                                <div class="setting-item">
                                    <label for="basePrice">السعر الأساسي (لكل كم)</label>
                                    <input type="number" id="basePrice" value="2.5" step="0.1" placeholder="السعر الأساسي">
                                </div>
                                <div class="setting-item">
                                    <label for="taxRate">معدل الضريبة (%)</label>
                                    <input type="number" id="taxRate" value="15" step="0.1" placeholder="معدل الضريبة">
                                </div>
                                <div class="setting-item">
                                    <label for="serviceFee">رسوم الخدمة</label>
                                    <input type="number" id="serviceFee" value="10" step="0.1" placeholder="رسوم الخدمة">
                                </div>
                                <div class="setting-item">
                                    <label for="cancellationFee">رسوم الإلغاء</label>
                                    <input type="number" id="cancellationFee" value="20" step="0.1" placeholder="رسوم الإلغاء">
                                </div>
                                <div class="setting-item">
                                    <label for="discountRate">معدل الخصم (%)</label>
                                    <input type="number" id="discountRate" value="5" step="0.1" placeholder="معدل الخصم">
                                </div>
                                <div class="setting-item">
                                    <label for="minimumBooking">الحد الأدنى للحجز</label>
                                    <input type="number" id="minimumBooking" value="50" step="0.1" placeholder="الحد الأدنى">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Notifications Settings -->
                    <div class="settings-tab-content" id="notificationsSettings" style="display: none;">
                        <div class="settings-section">
                            <h4><i class="fas fa-bell"></i> إعدادات الإشعارات</h4>
                            <div class="settings-grid">
                                <div class="setting-item">
                                    <label for="emailNotifications">الإشعارات بالبريد الإلكتروني</label>
                                    <input type="checkbox" id="emailNotifications" checked>
                                </div>
                                <div class="setting-item">
                                    <label for="smsNotifications">الإشعارات بالرسائل النصية</label>
                                    <input type="checkbox" id="smsNotifications" checked>
                                </div>
                                <div class="setting-item">
                                    <label for="pushNotifications">الإشعارات الفورية</label>
                                    <input type="checkbox" id="pushNotifications" checked>
                                </div>
                                <div class="setting-item">
                                    <label for="bookingNotifications">إشعارات الحجوزات الجديدة</label>
                                    <input type="checkbox" id="bookingNotifications" checked>
                                </div>
                                <div class="setting-item">
                                    <label for="paymentNotifications">إشعارات المدفوعات</label>
                                    <input type="checkbox" id="paymentNotifications" checked>
                                </div>
                                <div class="setting-item">
                                    <label for="maintenanceNotifications">إشعارات الصيانة</label>
                                    <input type="checkbox" id="maintenanceNotifications" checked>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Security Settings -->
                    <div class="settings-tab-content" id="securitySettings" style="display: none;">
                        <div class="settings-section">
                            <h4><i class="fas fa-shield-alt"></i> إعدادات الأمان</h4>
                            <div class="settings-grid">
                                <div class="setting-item">
                                    <label for="sessionTimeout">مهلة الجلسة (دقيقة)</label>
                                    <input type="number" id="sessionTimeout" value="30" min="5" max="480" placeholder="مهلة الجلسة">
                                </div>
                                <div class="setting-item">
                                    <label for="maxLoginAttempts">عدد محاولات تسجيل الدخول</label>
                                    <input type="number" id="maxLoginAttempts" value="5" min="3" max="10" placeholder="عدد المحاولات">
                                </div>
                                <div class="setting-item">
                                    <label for="passwordExpiry">انتهاء صلاحية كلمة المرور (أيام)</label>
                                    <input type="number" id="passwordExpiry" value="90" min="30" max="365" placeholder="انتهاء الصلاحية">
                                </div>
                                <div class="setting-item">
                                    <label for="twoFactorAuth">المصادقة الثنائية</label>
                                    <input type="checkbox" id="twoFactorAuth">
                                </div>
                                <div class="setting-item">
                                    <label for="ipWhitelist">قائمة IP المسموحة</label>
                                    <textarea id="ipWhitelist" rows="3" placeholder="192.168.1.1&#10;10.0.0.1"></textarea>
                                </div>
                                <div class="setting-item">
                                    <label for="auditLog">سجل التدقيق</label>
                                    <input type="checkbox" id="auditLog" checked>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Backup Settings -->
                    <div class="settings-tab-content" id="backupSettings" style="display: none;">
                        <div class="settings-section">
                            <h4><i class="fas fa-database"></i> النسخ الاحتياطي</h4>
                            <div class="settings-grid">
                                <div class="setting-item">
                                    <label for="autoBackup">النسخ الاحتياطي التلقائي</label>
                                    <input type="checkbox" id="autoBackup" checked>
                                </div>
                                <div class="setting-item">
                                    <label for="backupFrequency">تكرار النسخ الاحتياطي</label>
                                    <select id="backupFrequency">
                                        <option value="daily" selected>يومي</option>
                                        <option value="weekly">أسبوعي</option>
                                        <option value="monthly">شهري</option>
                                    </select>
                                </div>
                                <div class="setting-item">
                                    <label for="backupRetention">فترة الاحتفاظ (أيام)</label>
                                    <input type="number" id="backupRetention" value="30" min="7" max="365" placeholder="فترة الاحتفاظ">
                                </div>
                                <div class="setting-item">
                                    <label for="backupLocation">موقع النسخ الاحتياطي</label>
                                    <input type="text" id="backupLocation" value="/backups/" placeholder="موقع النسخ الاحتياطي">
                                </div>
                                <div class="setting-item">
                                    <label for="encryptBackup">تشفير النسخ الاحتياطي</label>
                                    <input type="checkbox" id="encryptBackup" checked>
                                </div>
                                <div class="setting-item">
                                    <label for="cloudBackup">النسخ الاحتياطي السحابي</label>
                                    <input type="checkbox" id="cloudBackup">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Trip Modal -->
    <div id="addTripModal" class="modal" style="display: none;">
        <div class="modal-content large">
            <div class="modal-header">
                <h3>إضافة رحلة جديدة</h3>
                <span class="close" onclick="closeAddTripModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="addTripForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>رقم الرحلة</label>
                            <input type="text" name="tripNumber" required>
                        </div>
                        <div class="form-group">
                            <label>نوع الرحلة</label>
                            <select name="tripType" required>
                                <option value="">اختر نوع الرحلة</option>
                                <option value="regular">عادية</option>
                                <option value="vip">VIP</option>
                                <option value="premium">فاخرة</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>المدينة من</label>
                            <select name="fromCity" required>
                                <option value="">اختر المدينة</option>
                                <option value="riyadh">الرياض</option>
                                <option value="jeddah">جدة</option>
                                <option value="makkah">مكة المكرمة</option>
                                <option value="madinah">المدينة المنورة</option>
                                <option value="taif">الطائف</option>
                                <option value="tabuk">تبوك</option>
                                <option value="yanbu">ينبع</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>المدينة إلى</label>
                            <select name="toCity" required>
                                <option value="">اختر المدينة</option>
                                <option value="riyadh">الرياض</option>
                                <option value="jeddah">جدة</option>
                                <option value="makkah">مكة المكرمة</option>
                                <option value="madinah">المدينة المنورة</option>
                                <option value="taif">الطائف</option>
                                <option value="tabuk">تبوك</option>
                                <option value="yanbu">ينبع</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>تاريخ الرحلة</label>
                            <input type="date" name="tripDate" required>
                        </div>
                        <div class="form-group">
                            <label>وقت الانطلاق</label>
                            <input type="time" name="departureTime" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>السائق</label>
                            <select name="driver" required>
                                <option value="">اختر السائق</option>
                                <option value="ahmed">أحمد محمد</option>
                                <option value="mohammed">محمد علي</option>
                                <option value="saad">سعد أحمد</option>
                                <option value="omar">عمر حسن</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>الباص</label>
                            <select name="bus" required>
                                <option value="">اختر الباص</option>
                                <option value="bus001">باص 001</option>
                                <option value="bus002">باص 002</option>
                                <option value="bus003">باص 003</option>
                                <option value="bus004">باص 004</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>عدد المقاعد</label>
                            <input type="number" name="totalSeats" min="1" max="60" required>
                        </div>
                        <div class="form-group">
                            <label>السعر (ريال)</label>
                            <input type="number" name="price" min="0" step="0.01" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>ملاحظات</label>
                        <textarea name="notes" rows="3" placeholder="أي ملاحظات خاصة بالرحلة..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeAddTripModal()">إلغاء</button>
                <button class="btn btn-primary" onclick="saveTrip()">حفظ الرحلة</button>
            </div>
        </div>
    </div>

    <!-- Edit Trip Modal -->
    <div id="editTripModal" class="modal" style="display: none;">
        <div class="modal-content large">
            <div class="modal-header">
                <h3>تعديل الرحلة</h3>
                <span class="close" onclick="closeEditTripModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="editTripForm">
                    <!-- Same form fields as add trip -->
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeEditTripModal()">إلغاء</button>
                <button class="btn btn-primary" onclick="updateTrip()">تحديث الرحلة</button>
            </div>
        </div>
    </div>

    <!-- View Trip Modal -->
    <div id="viewTripModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>تفاصيل الرحلة</h3>
                <span class="close" onclick="closeViewTripModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="tripDetails">
                    <!-- Trip details will be loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeViewTripModal()">إغلاق</button>
                <button class="btn btn-primary" onclick="editTripFromView()">تعديل</button>
            </div>
        </div>
    </div>

    <script>
        // Check if user is logged in and is admin
        document.addEventListener('DOMContentLoaded', function() {
            const user = localStorage.getItem('user');
            if (!user) {
                window.location.href = 'login.html';
                return;
            }
            
            const userData = JSON.parse(user);
            if (userData.role !== 'admin') {
                alert('ليس لديك صلاحية للوصول إلى هذه الصفحة');
                window.location.href = 'customer-dashboard.html';
                return;
            }
        });
        
        // Mobile sidebar toggle
        function toggleSidebar() {
            console.log('toggleSidebar called');
            const sidebar = document.getElementById('sidebar');
            console.log('Sidebar element:', sidebar);
            if (sidebar) {
                sidebar.classList.toggle('open');
                console.log('Sidebar classes:', sidebar.classList.toString());
            } else {
                console.error('Sidebar element not found');
            }
        }
        
        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', function(e) {
            const sidebar = document.getElementById('sidebar');
            const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
            
            if (window.innerWidth <= 768) {
                if (!sidebar.contains(e.target) && !mobileMenuBtn.contains(e.target)) {
                    sidebar.classList.remove('open');
                }
            }
        });

        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.style.display = 'none';
            });
            
            // Show selected section
            document.getElementById(sectionId).style.display = 'block';
            
            // Update active menu item
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        function logout() {
            if (confirm('هل أنت متأكد من تسجيل الخروج؟')) {
                localStorage.removeItem('user');
                window.location.href = 'login.html';
            }
        }

        function viewBooking(bookingId) {
            alert(`عرض تفاصيل الحجز ${bookingId}`);
        }

        function editBooking(bookingId) {
            alert(`تعديل الحجز ${bookingId}`);
        }

        // Trip Management Functions
        function showAddTripModal() {
            // Remove any existing modals first
            const existingModals = document.querySelectorAll('.modal');
            existingModals.forEach(modal => modal.remove());
            
            // Create add trip modal
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.style.position = 'fixed';
            modal.style.top = '0';
            modal.style.left = '0';
            modal.style.width = '100%';
            modal.style.height = '100%';
            modal.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
            modal.style.zIndex = '9999';
            modal.style.display = 'flex';
            modal.style.alignItems = 'center';
            modal.style.justifyContent = 'center';
            
            modal.innerHTML = `
                <div class="modal-content add-trip-modal">
                    <div class="modal-header">
                        <h3><i class="fas fa-plus"></i> إضافة رحلة جديدة</h3>
                        <span class="close" onclick="this.closest('.modal').remove()">&times;</span>
                    </div>
                    <div class="modal-body">
                        <form id="addTripForm" class="add-trip-form">
                            <!-- Trip Basic Information -->
                            <div class="form-section">
                                <h4><i class="fas fa-bus"></i> معلومات الرحلة الأساسية</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="tripNumber">رقم الرحلة</label>
                                        <input type="text" id="tripNumber" placeholder="مثال: TR001" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="tripType">نوع الرحلة</label>
                                        <select id="tripType" required>
                                            <option value="">اختر نوع الرحلة</option>
                                            <option value="عادي">عادي</option>
                                            <option value="VIP">VIP</option>
                                            <option value="فاخر">فاخر</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="fromCity">من</label>
                                        <select id="fromCity" required>
                                            <option value="">اختر المدينة</option>
                                            <option value="جدة">جدة</option>
                                            <option value="الرياض">الرياض</option>
                                            <option value="الدمام">الدمام</option>
                                            <option value="المدينة">المدينة</option>
                                            <option value="الطائف">الطائف</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="toCity">إلى</label>
                                        <select id="toCity" required>
                                            <option value="">اختر المدينة</option>
                                            <option value="جدة">جدة</option>
                                            <option value="الرياض">الرياض</option>
                                            <option value="الدمام">الدمام</option>
                                            <option value="المدينة">المدينة</option>
                                            <option value="الطائف">الطائف</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Trip Schedule -->
                            <div class="form-section">
                                <h4><i class="fas fa-calendar-alt"></i> جدولة الرحلة</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="tripDate">تاريخ الرحلة</label>
                                        <input type="date" id="tripDate" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="departureTime">وقت المغادرة</label>
                                        <input type="time" id="departureTime" required>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="arrivalTime">وقت الوصول المتوقع</label>
                                        <input type="time" id="arrivalTime" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="duration">مدة الرحلة (ساعات)</label>
                                        <input type="number" id="duration" min="1" max="24" step="0.5" placeholder="مثال: 4.5" required>
                                    </div>
                                </div>
                            </div>

                            <!-- Bus and Driver Information -->
                            <div class="form-section">
                                <h4><i class="fas fa-user-tie"></i> معلومات السائق والحافلة</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="driverName">اسم السائق</label>
                                        <input type="text" id="driverName" placeholder="مثال: أحمد محمد" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="driverPhone">رقم هاتف السائق</label>
                                        <input type="tel" id="driverPhone" placeholder="مثال: +966501234567" required>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="busNumber">رقم الحافلة</label>
                                        <input type="text" id="busNumber" placeholder="مثال: BUS001" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="busCapacity">سعة الحافلة</label>
                                        <input type="number" id="busCapacity" min="10" max="100" placeholder="مثال: 50" required>
                                    </div>
                                </div>
                            </div>

                            <!-- Pricing Information -->
                            <div class="form-section">
                                <h4><i class="fas fa-money-bill-wave"></i> معلومات التسعير</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="basePrice">السعر الأساسي</label>
                                        <input type="number" id="basePrice" min="0" step="0.01" placeholder="مثال: 120" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="vipPrice">سعر VIP</label>
                                        <input type="number" id="vipPrice" min="0" step="0.01" placeholder="مثال: 200">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="premiumPrice">سعر الفاخر</label>
                                        <input type="number" id="premiumPrice" min="0" step="0.01" placeholder="مثال: 300">
                                    </div>
                                    <div class="form-group">
                                        <label for="currency">العملة</label>
                                        <select id="currency" required>
                                            <option value="ريال">ريال سعودي</option>
                                            <option value="دولار">دولار أمريكي</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Additional Information -->
                            <div class="form-section">
                                <h4><i class="fas fa-info-circle"></i> معلومات إضافية</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="departureStation">محطة المغادرة</label>
                                        <input type="text" id="departureStation" placeholder="مثال: محطة الحجاز" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="arrivalStation">محطة الوصول</label>
                                        <input type="text" id="arrivalStation" placeholder="مثال: محطة النقل الجماعي" required>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="route">مسار الرحلة</label>
                                        <input type="text" id="route" placeholder="مثال: طريق الملك فهد">
                                    </div>
                                    <div class="form-group">
                                        <label for="status">حالة الرحلة</label>
                                        <select id="status" required>
                                            <option value="مجدولة">مجدولة</option>
                                            <option value="قيد التشغيل">قيد التشغيل</option>
                                            <option value="مكتملة">مكتملة</option>
                                            <option value="ملغية">ملغية</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="notes">ملاحظات إضافية</label>
                                    <textarea id="notes" rows="3" placeholder="أي ملاحظات إضافية حول الرحلة..."></textarea>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">
                            <i class="fas fa-times"></i> إلغاء
                        </button>
                        <button class="btn btn-primary" onclick="saveNewTrip()">
                            <i class="fas fa-plus"></i> إضافة الرحلة
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Set today's date as default
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('tripDate').value = today;
            
            // Auto-calculate duration when times change
            document.getElementById('departureTime').addEventListener('change', calculateDuration);
            document.getElementById('arrivalTime').addEventListener('change', calculateDuration);
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
            
            // Close modal with Escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    modal.remove();
                }
            });
        }

        function calculateDuration() {
            const departureTime = document.getElementById('departureTime').value;
            const arrivalTime = document.getElementById('arrivalTime').value;
            
            if (departureTime && arrivalTime) {
                const departure = new Date(`2000-01-01T${departureTime}`);
                const arrival = new Date(`2000-01-01T${arrivalTime}`);
                
                // Handle overnight trips
                if (arrival < departure) {
                    arrival.setDate(arrival.getDate() + 1);
                }
                
                const duration = (arrival - departure) / (1000 * 60 * 60); // Convert to hours
                document.getElementById('duration').value = duration.toFixed(1);
            }
        }

        function saveNewTrip() {
            // Get form data
            const formData = {
                tripNumber: document.getElementById('tripNumber').value,
                tripType: document.getElementById('tripType').value,
                fromCity: document.getElementById('fromCity').value,
                toCity: document.getElementById('toCity').value,
                tripDate: document.getElementById('tripDate').value,
                departureTime: document.getElementById('departureTime').value,
                arrivalTime: document.getElementById('arrivalTime').value,
                duration: document.getElementById('duration').value,
                driverName: document.getElementById('driverName').value,
                driverPhone: document.getElementById('driverPhone').value,
                busNumber: document.getElementById('busNumber').value,
                busCapacity: document.getElementById('busCapacity').value,
                basePrice: document.getElementById('basePrice').value,
                vipPrice: document.getElementById('vipPrice').value,
                premiumPrice: document.getElementById('premiumPrice').value,
                currency: document.getElementById('currency').value,
                departureStation: document.getElementById('departureStation').value,
                arrivalStation: document.getElementById('arrivalStation').value,
                route: document.getElementById('route').value,
                status: document.getElementById('status').value,
                notes: document.getElementById('notes').value
            };

            // Validate form
            if (!formData.tripNumber || !formData.tripType || !formData.fromCity || !formData.toCity || 
                !formData.tripDate || !formData.departureTime || !formData.arrivalTime || 
                !formData.driverName || !formData.driverPhone || !formData.busNumber || 
                !formData.busCapacity || !formData.basePrice) {
                alert('يرجى ملء جميع الحقول المطلوبة');
                return;
            }

            // Check if from and to cities are different
            if (formData.fromCity === formData.toCity) {
                alert('مدينة المغادرة ومدينة الوصول يجب أن تكونا مختلفتين');
                return;
            }

            // Show loading
            const saveBtn = document.querySelector('.btn-primary');
            const originalText = saveBtn.innerHTML;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري الإضافة...';
            saveBtn.disabled = true;

            // Simulate API call
            setTimeout(() => {
                // Show success message
                alert(`تم إضافة الرحلة ${formData.tripNumber} بنجاح!`);
                
                // Close modal
                document.querySelector('.modal').remove();
                
                // Refresh trips table (in real app, this would reload data)
                // Trip added successfully
                
                // Add to trips table (simulation)
                addTripToTable(formData);
            }, 1500);
        }

        function addTripToTable(tripData) {
            const table = document.getElementById('tripsTable');
            if (table) {
                const tbody = table.getElementsByTagName('tbody')[0];
                const newRow = tbody.insertRow(0);
                
                newRow.innerHTML = `
                    <td>${tripData.tripNumber}</td>
                    <td>${tripData.tripType}</td>
                    <td>${tripData.fromCity} - ${tripData.toCity}</td>
                    <td>${tripData.tripDate}</td>
                    <td>${tripData.departureTime}</td>
                    <td>${tripData.driverName}</td>
                    <td>${tripData.busNumber}</td>
                    <td>${tripData.busCapacity}</td>
                    <td>${tripData.basePrice} ${tripData.currency}</td>
                    <td><span class="status-badge status-scheduled">${tripData.status}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-action btn-view" onclick="viewTrip('${tripData.tripNumber}')" title="عرض">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-action btn-edit" onclick="editTrip('${tripData.tripNumber}')" title="تعديل">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-action btn-delete" onclick="deleteTrip('${tripData.tripNumber}')" title="حذف">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
            }
        }

        function showEditTripModal() {
            document.getElementById('editTripModal').style.display = 'block';
        }

        function closeEditTripModal() {
            document.getElementById('editTripModal').style.display = 'none';
        }

        function closeViewTripModal() {
            document.getElementById('viewTripModal').style.display = 'none';
        }

        function saveTrip() {
            const form = document.getElementById('addTripForm');
            const formData = new FormData(form);
            
            // Validate form
            if (!form.checkValidity()) {
                alert('يرجى ملء جميع الحقول المطلوبة');
                return;
            }
            
            // Simulate saving trip
            alert('تم حفظ الرحلة بنجاح!');
            closeAddTripModal();
            
            // Refresh trips table
            loadTrips();
        }

        function updateTrip() {
            const form = document.getElementById('editTripForm');
            const formData = new FormData(form);
            
            // Validate form
            if (!form.checkValidity()) {
                alert('يرجى ملء جميع الحقول المطلوبة');
                return;
            }
            
            // Simulate updating trip
            alert('تم تحديث الرحلة بنجاح!');
            closeEditTripModal();
            
            // Refresh trips table
            loadTrips();
        }

        function viewTrip(tripId) {
            // Remove any existing modals
            const existingModals = document.querySelectorAll('.modal');
            existingModals.forEach(modal => modal.remove());
            
            // Create trip details modal
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.style.position = 'fixed';
            modal.style.top = '0';
            modal.style.left = '0';
            modal.style.width = '100%';
            modal.style.height = '100%';
            modal.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
            modal.style.zIndex = '9999';
            modal.style.display = 'flex';
            modal.style.alignItems = 'center';
            modal.style.justifyContent = 'center';
            
            modal.innerHTML = `
                <div class="modal-content trip-details-modal" style="background: white; border-radius: 16px; padding: 2rem; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: 0 20px 40px rgba(0,0,0,0.2);">
                    <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid #f1f5f9;">
                        <h3 style="margin: 0; color: #264673; font-size: 1.5rem; display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-route" style="color: #22c55e;"></i>
                            تفاصيل الرحلة ${tripId}
                        </h3>
                        <span class="close" onclick="this.closest('.modal').remove()" style="font-size: 1.5rem; cursor: pointer; color: #64748b;">&times;</span>
                    </div>
                    <div class="modal-body">
                        <div class="trip-details-container" style="display: grid; gap: 1.5rem;">
                            <!-- Trip Header -->
                            <div class="trip-header-section" style="background: linear-gradient(135deg, #f8fafc, #ffffff); padding: 1.5rem; border-radius: 12px; border: 1px solid #e2e8f0;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                    <div>
                                        <h4 style="margin: 0; color: #264673; font-size: 1.2rem;">الرياض - جدة</h4>
                                        <p style="margin: 0.5rem 0 0 0; color: #64748b; font-size: 0.9rem;">رقم الرحلة: ${tripId}</p>
                                    </div>
                                    <div style="text-align: left;">
                                        <span class="status-badge status-scheduled" style="background: #22c55e; color: white; padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.8rem; font-weight: 600;">مجدولة</span>
                                    </div>
                                </div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                    <div style="text-align: center; padding: 1rem; background: white; border-radius: 8px; border: 1px solid #e2e8f0;">
                                        <div style="font-size: 1.5rem; font-weight: bold; color: #264673;">25 ديسمبر</div>
                                        <div style="color: #64748b; font-size: 0.9rem;">التاريخ</div>
                                    </div>
                                    <div style="text-align: center; padding: 1rem; background: white; border-radius: 8px; border: 1px solid #e2e8f0;">
                                        <div style="font-size: 1.5rem; font-weight: bold; color: #264673;">08:00</div>
                                        <div style="color: #64748b; font-size: 0.9rem;">وقت المغادرة</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Trip Details -->
                            <div class="trip-details-section" style="background: #f8fafc; padding: 1.5rem; border-radius: 12px;">
                                <h5 style="margin: 0 0 1rem 0; color: #264673; font-size: 1.1rem;">تفاصيل الرحلة</h5>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                    <div class="detail-item" style="display: flex; justify-content: space-between; padding: 0.75rem; background: white; border-radius: 8px; border: 1px solid #e2e8f0;">
                                        <span style="color: #64748b; font-weight: 600;">المدة:</span>
                                        <span style="color: #264673; font-weight: bold;">4 ساعات</span>
                                    </div>
                                    <div class="detail-item" style="display: flex; justify-content: space-between; padding: 0.75rem; background: white; border-radius: 8px; border: 1px solid #e2e8f0;">
                                        <span style="color: #64748b; font-weight: 600;">المقاعد:</span>
                                        <span style="color: #264673; font-weight: bold;">45/50</span>
                                    </div>
                                    <div class="detail-item" style="display: flex; justify-content: space-between; padding: 0.75rem; background: white; border-radius: 8px; border: 1px solid #e2e8f0;">
                                        <span style="color: #64748b; font-weight: 600;">السائق:</span>
                                        <span style="color: #264673; font-weight: bold;">أحمد محمد</span>
                                    </div>
                                    <div class="detail-item" style="display: flex; justify-content: space-between; padding: 0.75rem; background: white; border-radius: 8px; border: 1px solid #e2e8f0;">
                                        <span style="color: #64748b; font-weight: 600;">الباص:</span>
                                        <span style="color: #264673; font-weight: bold;">باص 001</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Pricing -->
                            <div class="pricing-section" style="background: linear-gradient(135deg, #22c55e, #16a34a); color: white; padding: 1.5rem; border-radius: 12px;">
                                <h5 style="margin: 0 0 1rem 0; font-size: 1.1rem;">الأسعار</h5>
                                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                                    <div style="text-align: center; padding: 1rem; background: rgba(255,255,255,0.2); border-radius: 8px;">
                                        <div style="font-size: 1.2rem; font-weight: bold;">120 ريال</div>
                                        <div style="font-size: 0.9rem; opacity: 0.9;">عادي</div>
                                    </div>
                                    <div style="text-align: center; padding: 1rem; background: rgba(255,255,255,0.2); border-radius: 8px;">
                                        <div style="font-size: 1.2rem; font-weight: bold;">180 ريال</div>
                                        <div style="font-size: 0.9rem; opacity: 0.9;">VIP</div>
                                    </div>
                                    <div style="text-align: center; padding: 1rem; background: rgba(255,255,255,0.2); border-radius: 8px;">
                                        <div style="font-size: 1.2rem; font-weight: bold;">250 ريال</div>
                                        <div style="font-size: 0.9rem; opacity: 0.9;">بريميوم</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer" style="display: flex; gap: 1rem; margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid #e2e8f0;">
                        <button onclick="editTrip('${tripId}'); this.closest('.modal').remove();" style="flex: 1; padding: 0.75rem; background: #264673; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">
                            <i class="fas fa-edit" style="margin-left: 0.5rem;"></i>
                            تعديل الرحلة
                        </button>
                        <button onclick="this.closest('.modal').remove();" style="flex: 1; padding: 0.75rem; background: #64748b; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">
                            <i class="fas fa-times" style="margin-left: 0.5rem;"></i>
                            إغلاق
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        function editTrip(tripId) {
            // Remove any existing modals
            const existingModals = document.querySelectorAll('.modal');
            existingModals.forEach(modal => modal.remove());
            
            // Create edit trip modal
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.style.position = 'fixed';
            modal.style.top = '0';
            modal.style.left = '0';
            modal.style.width = '100%';
            modal.style.height = '100%';
            modal.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
            modal.style.zIndex = '9999';
            modal.style.display = 'flex';
            modal.style.alignItems = 'center';
            modal.style.justifyContent = 'center';
            
            modal.innerHTML = `
                <div class="modal-content edit-trip-modal" style="background: white; border-radius: 16px; padding: 2rem; max-width: 700px; width: 90%; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 40px rgba(0,0,0,0.2);">
                    <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid #f1f5f9;">
                        <h3 style="margin: 0; color: #264673; font-size: 1.5rem; display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-edit" style="color: #f59e0b;"></i>
                            تعديل الرحلة ${tripId}
                        </h3>
                        <span class="close" onclick="this.closest('.modal').remove()" style="font-size: 1.5rem; cursor: pointer; color: #64748b;">&times;</span>
                    </div>
                    <div class="modal-body">
                        <form id="editTripForm" style="display: grid; gap: 1.5rem;">
                            <!-- Basic Trip Info -->
                            <div class="form-section" style="background: #f8fafc; padding: 1.5rem; border-radius: 12px; border: 1px solid #e2e8f0;">
                                <h5 style="margin: 0 0 1rem 0; color: #264673; font-size: 1.1rem;">معلومات الرحلة الأساسية</h5>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                    <div class="form-group">
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">رقم الرحلة</label>
                                        <input type="text" id="editTripNumber" value="${tripId}" style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem;" readonly>
                                    </div>
                                    <div class="form-group">
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">نوع الرحلة</label>
                                        <select id="editTripType" style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem;">
                                            <option value="regular">عادية</option>
                                            <option value="express">سريعة</option>
                                            <option value="vip">VIP</option>
                                            <option value="premium">بريميوم</option>
                                        </select>
                                    </div>
                                </div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                    <div class="form-group">
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">من</label>
                                        <select id="editFromCity" style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem;">
                                            <option value="riyadh">الرياض</option>
                                            <option value="jeddah" selected>جدة</option>
                                            <option value="dammam">الدمام</option>
                                            <option value="mecca">مكة</option>
                                            <option value="medina">المدينة</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">إلى</label>
                                        <select id="editToCity" style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem;">
                                            <option value="riyadh" selected>الرياض</option>
                                            <option value="jeddah">جدة</option>
                                            <option value="dammam">الدمام</option>
                                            <option value="mecca">مكة</option>
                                            <option value="medina">المدينة</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Schedule -->
                            <div class="form-section" style="background: #f8fafc; padding: 1.5rem; border-radius: 12px; border: 1px solid #e2e8f0;">
                                <h5 style="margin: 0 0 1rem 0; color: #264673; font-size: 1.1rem;">الجدولة</h5>
                                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                                    <div class="form-group">
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">التاريخ</label>
                                        <input type="date" id="editTripDate" value="2024-12-25" style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem;">
                                    </div>
                                    <div class="form-group">
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">وقت المغادرة</label>
                                        <input type="time" id="editDepartureTime" value="08:00" style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem;">
                                    </div>
                                    <div class="form-group">
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">وقت الوصول</label>
                                        <input type="time" id="editArrivalTime" value="12:00" style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem;">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Driver & Bus Info -->
                            <div class="form-section" style="background: #f8fafc; padding: 1.5rem; border-radius: 12px; border: 1px solid #e2e8f0;">
                                <h5 style="margin: 0 0 1rem 0; color: #264673; font-size: 1.1rem;">السائق والباص</h5>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                    <div class="form-group">
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">اسم السائق</label>
                                        <input type="text" id="editDriverName" value="أحمد محمد" style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem;">
                                    </div>
                                    <div class="form-group">
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">هاتف السائق</label>
                                        <input type="tel" id="editDriverPhone" value="+966501234567" style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem;">
                                    </div>
                                </div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                    <div class="form-group">
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">رقم الباص</label>
                                        <input type="text" id="editBusNumber" value="باص 001" style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem;">
                                    </div>
                                    <div class="form-group">
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">سعة الباص</label>
                                        <input type="number" id="editBusCapacity" value="50" style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem;">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Pricing -->
                            <div class="form-section" style="background: #f8fafc; padding: 1.5rem; border-radius: 12px; border: 1px solid #e2e8f0;">
                                <h5 style="margin: 0 0 1rem 0; color: #264673; font-size: 1.1rem;">الأسعار</h5>
                                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                                    <div class="form-group">
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">السعر العادي</label>
                                        <input type="number" id="editBasePrice" value="120" style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem;">
                                    </div>
                                    <div class="form-group">
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">سعر VIP</label>
                                        <input type="number" id="editVipPrice" value="180" style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem;">
                                    </div>
                                    <div class="form-group">
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">سعر بريميوم</label>
                                        <input type="number" id="editPremiumPrice" value="250" style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem;">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Status & Notes -->
                            <div class="form-section" style="background: #f8fafc; padding: 1.5rem; border-radius: 12px; border: 1px solid #e2e8f0;">
                                <h5 style="margin: 0 0 1rem 0; color: #264673; font-size: 1.1rem;">الحالة والملاحظات</h5>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                    <div class="form-group">
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">حالة الرحلة</label>
                                        <select id="editStatus" style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem;">
                                            <option value="scheduled" selected>مجدولة</option>
                                            <option value="active">جارية</option>
                                            <option value="completed">مكتملة</option>
                                            <option value="cancelled">ملغية</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">العملة</label>
                                        <select id="editCurrency" style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem;">
                                            <option value="SAR" selected>ريال سعودي</option>
                                            <option value="USD">دولار أمريكي</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">ملاحظات إضافية</label>
                                    <textarea id="editNotes" rows="3" style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem; resize: vertical;" placeholder="أي ملاحظات إضافية...">رحلة عادية من جدة إلى الرياض</textarea>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer" style="display: flex; gap: 1rem; margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid #e2e8f0;">
                        <button onclick="saveTripChanges('${tripId}'); this.closest('.modal').remove();" style="flex: 1; padding: 0.75rem; background: #22c55e; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">
                            <i class="fas fa-save" style="margin-left: 0.5rem;"></i>
                            حفظ التغييرات
                        </button>
                        <button onclick="this.closest('.modal').remove();" style="flex: 1; padding: 0.75rem; background: #64748b; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">
                            <i class="fas fa-times" style="margin-left: 0.5rem;"></i>
                            إلغاء
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        function saveTripChanges(tripId) {
            // Get form data
            const formData = {
                tripNumber: document.getElementById('editTripNumber').value,
                tripType: document.getElementById('editTripType').value,
                fromCity: document.getElementById('editFromCity').value,
                toCity: document.getElementById('editToCity').value,
                tripDate: document.getElementById('editTripDate').value,
                departureTime: document.getElementById('editDepartureTime').value,
                arrivalTime: document.getElementById('editArrivalTime').value,
                driverName: document.getElementById('editDriverName').value,
                driverPhone: document.getElementById('editDriverPhone').value,
                busNumber: document.getElementById('editBusNumber').value,
                busCapacity: document.getElementById('editBusCapacity').value,
                basePrice: document.getElementById('editBasePrice').value,
                vipPrice: document.getElementById('editVipPrice').value,
                premiumPrice: document.getElementById('editPremiumPrice').value,
                status: document.getElementById('editStatus').value,
                currency: document.getElementById('editCurrency').value,
                notes: document.getElementById('editNotes').value
            };

            // Validate form
            if (!formData.tripNumber || !formData.tripType || !formData.fromCity || !formData.toCity || 
                !formData.tripDate || !formData.departureTime || !formData.arrivalTime) {
                alert('يرجى ملء جميع الحقول المطلوبة');
                return;
            }

            // Show loading
            const saveBtn = event.target;
            const originalText = saveBtn.innerHTML;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري الحفظ...';
            saveBtn.disabled = true;

            // Simulate API call
            setTimeout(() => {
                // Update trip in table
                updateTripInTable(tripId, formData);
                
                // Show success message
                alert(`تم تحديث الرحلة ${tripId} بنجاح!`);
                
                // Reset button
                saveBtn.innerHTML = originalText;
                saveBtn.disabled = false;
            }, 1500);
        }

        function updateTripInTable(tripId, tripData) {
            const table = document.getElementById('tripsTable');
            if (table) {
                const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
                
                for (let i = 0; i < rows.length; i++) {
                    const row = rows[i];
                    if (row.cells[0].textContent === tripId) {
                        // Update row data
                        row.cells[1].textContent = tripData.tripType;
                        row.cells[2].textContent = `${tripData.fromCity} - ${tripData.toCity}`;
                        row.cells[3].textContent = tripData.tripDate;
                        row.cells[4].textContent = tripData.departureTime;
                        row.cells[5].textContent = tripData.driverName;
                        row.cells[6].textContent = tripData.busNumber;
                        row.cells[7].textContent = tripData.busCapacity;
                        row.cells[8].textContent = `${tripData.basePrice} ${tripData.currency}`;
                        
                        // Update status badge
                        const statusCell = row.cells[9];
                        statusCell.innerHTML = `<span class="status-badge status-${tripData.status}">${tripData.status}</span>`;
                        break;
                    }
                }
            }
        }

        function deleteTrip(tripId) {
            if (confirm(`هل أنت متأكد من حذف الرحلة ${tripId}؟`)) {
                // Show loading
                const deleteBtn = event.target;
                const originalText = deleteBtn.innerHTML;
                deleteBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري الحذف...';
                deleteBtn.disabled = true;

                // Simulate API call
                setTimeout(() => {
                    // Remove trip from table
                    removeTripFromTable(tripId);
                    
                    // Show success message
                    alert(`تم حذف الرحلة ${tripId} بنجاح`);
                    
                    // Reset button
                    deleteBtn.innerHTML = originalText;
                    deleteBtn.disabled = false;
                }, 1000);
            }
        }

        function removeTripFromTable(tripId) {
            const table = document.getElementById('tripsTable');
            if (table) {
                const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
                
                for (let i = 0; i < rows.length; i++) {
                    const row = rows[i];
                    if (row.cells[0].textContent === tripId) {
                        row.remove();
                        break;
                    }
                }
            }
        }

        function editTripFromView() {
            closeViewTripModal();
            editTrip('current');
        }

        function filterTrips() {
            const searchTerm = document.getElementById('tripSearch').value.toLowerCase();
            const statusFilter = document.getElementById('tripStatus').value;
            const dateFilter = document.getElementById('tripDate').value;
            
            const table = document.getElementById('tripsTable');
            const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
            
            for (let i = 0; i < rows.length; i++) {
                const row = rows[i];
                const tripNumber = row.cells[0].textContent.toLowerCase();
                const route = row.cells[1].textContent.toLowerCase();
                const date = row.cells[2].textContent;
                const status = row.cells[7].textContent.toLowerCase();
                
                let show = true;
                
                // Search filter
                if (searchTerm && !tripNumber.includes(searchTerm) && !route.includes(searchTerm)) {
                    show = false;
                }
                
                // Status filter
                if (statusFilter && !status.includes(statusFilter)) {
                    show = false;
                }
                
                // Date filter
                if (dateFilter && !date.includes(dateFilter)) {
                    show = false;
                }
                
                row.style.display = show ? '' : 'none';
            }
        }

        function resetFilters() {
            document.getElementById('tripSearch').value = '';
            document.getElementById('tripStatus').value = '';
            document.getElementById('tripDate').value = '';
            filterTrips();
        }

        function loadTrips() {
            // This would normally load trips from a database
            // Loading trips...
        }

        // Customer Management Functions
        function showAddCustomerModal() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3><i class="fas fa-user-plus"></i> إضافة عميل جديد</h3>
                        <button class="close-btn" onclick="closeModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="addCustomerForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>الاسم الكامل *</label>
                                    <input type="text" id="customerName" required>
                                </div>
                                <div class="form-group">
                                    <label>البريد الإلكتروني *</label>
                                    <input type="email" id="customerEmail" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>رقم الهاتف *</label>
                                    <input type="tel" id="customerPhone" required>
                                </div>
                                <div class="form-group">
                                    <label>رقم الهوية الوطنية *</label>
                                    <input type="text" id="customerNationalId" required maxlength="10">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>المدينة *</label>
                                    <select id="customerCity" required>
                                        <option value="">اختر المدينة</option>
                                        <option value="riyadh">الرياض</option>
                                        <option value="jeddah">جدة</option>
                                        <option value="makkah">مكة المكرمة</option>
                                        <option value="madinah">المدينة المنورة</option>
                                        <option value="dammam">الدمام</option>
                                        <option value="taif">الطائف</option>
                                        <option value="tabuk">تبوك</option>
                                        <option value="yanbu">ينبع</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>الحالة</label>
                                    <select id="customerStatus">
                                        <option value="active">نشط</option>
                                        <option value="inactive">غير نشط</option>
                                        <option value="VIP">VIP</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>العنوان التفصيلي</label>
                                <textarea id="customerAddress" rows="3" placeholder="شارع، رقم المبنى، رقم الشقة"></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeModal()">إلغاء</button>
                        <button class="btn btn-primary" onclick="addCustomer()">إضافة العميل</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function closeModal() {
            const modal = document.querySelector('.modal-overlay');
            if (modal) {
                modal.remove();
            }
        }
        
        function addCustomer() {
            const form = document.getElementById('addCustomerForm');
            const formData = new FormData(form);
            
            const customerData = {
                id: 'NW' + Date.now().toString(36).toUpperCase(),
                name: document.getElementById('customerName').value,
                email: document.getElementById('customerEmail').value,
                phone: document.getElementById('customerPhone').value,
                nationalId: document.getElementById('customerNationalId').value,
                city: document.getElementById('customerCity').value,
                address: document.getElementById('customerAddress').value,
                status: document.getElementById('customerStatus').value,
                registrationDate: new Date().toISOString(),
                totalBookings: 0,
                totalSpent: 0
            };
            
            // Save to localStorage
            const existingCustomers = JSON.parse(localStorage.getItem('customers') || '[]');
            existingCustomers.push(customerData);
            localStorage.setItem('customers', JSON.stringify(existingCustomers));
            
            // Close modal and refresh table
            closeModal();
            
            // Reload customers table
            const customers = JSON.parse(localStorage.getItem('customers') || '[]');
            renderCustomersTable(customers);
            updateCustomerStatistics(customers);
        }

        function viewCustomer(customerId) {
            const customers = JSON.parse(localStorage.getItem('customers') || '[]');
            const customer = customers.find(c => c.id === customerId);
            
            if (!customer) {
                alert('العميل غير موجود');
                return;
            }
            
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3><i class="fas fa-user"></i> تفاصيل العميل</h3>
                        <button class="close-btn" onclick="closeModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="customer-details-view">
                            <div class="detail-section">
                                <h4>المعلومات الشخصية</h4>
                                <div class="detail-row">
                                    <span class="label">الاسم:</span>
                                    <span class="value">${customer.name}</span>
                                </div>
                                <div class="detail-row">
                                    <span class="label">رقم الهوية:</span>
                                    <span class="value">${customer.nationalId}</span>
                                </div>
                                <div class="detail-row">
                                    <span class="label">البريد الإلكتروني:</span>
                                    <span class="value">${customer.email}</span>
                                </div>
                                <div class="detail-row">
                                    <span class="label">رقم الهاتف:</span>
                                    <span class="value">${customer.phone}</span>
                                </div>
                            </div>
                            <div class="detail-section">
                                <h4>العنوان</h4>
                                <div class="detail-row">
                                    <span class="label">المدينة:</span>
                                    <span class="value">${customer.city}</span>
                                </div>
                                <div class="detail-row">
                                    <span class="label">العنوان:</span>
                                    <span class="value">${customer.address || 'غير محدد'}</span>
                                </div>
                            </div>
                            <div class="detail-section">
                                <h4>الإحصائيات</h4>
                                <div class="detail-row">
                                    <span class="label">عدد الحجوزات:</span>
                                    <span class="value">${customer.totalBookings || 0}</span>
                                </div>
                                <div class="detail-row">
                                    <span class="label">إجمالي المدفوعات:</span>
                                    <span class="value">${customer.totalSpent || 0} ريال</span>
                                </div>
                                <div class="detail-row">
                                    <span class="label">تاريخ التسجيل:</span>
                                    <span class="value">${new Date(customer.registrationDate).toLocaleDateString('ar-SA')}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeModal()">إغلاق</button>
                        <button class="btn btn-primary" onclick="editCustomer('${customerId}')">تعديل</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function editCustomer(customerId) {
            const customers = JSON.parse(localStorage.getItem('customers') || '[]');
            const customer = customers.find(c => c.id === customerId);
            
            if (!customer) {
                alert('العميل غير موجود');
                return;
            }
            
            closeModal(); // Close any existing modal
            
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3><i class="fas fa-edit"></i> تعديل بيانات العميل</h3>
                        <button class="close-btn" onclick="closeModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="editCustomerForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>الاسم الكامل *</label>
                                    <input type="text" id="editCustomerName" value="${customer.name}" required>
                                </div>
                                <div class="form-group">
                                    <label>البريد الإلكتروني *</label>
                                    <input type="email" id="editCustomerEmail" value="${customer.email}" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>رقم الهاتف *</label>
                                    <input type="tel" id="editCustomerPhone" value="${customer.phone}" required>
                                </div>
                                <div class="form-group">
                                    <label>رقم الهوية الوطنية *</label>
                                    <input type="text" id="editCustomerNationalId" value="${customer.nationalId}" required maxlength="10">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>المدينة *</label>
                                    <select id="editCustomerCity" required>
                                        <option value="riyadh" ${customer.city === 'riyadh' ? 'selected' : ''}>الرياض</option>
                                        <option value="jeddah" ${customer.city === 'jeddah' ? 'selected' : ''}>جدة</option>
                                        <option value="makkah" ${customer.city === 'makkah' ? 'selected' : ''}>مكة المكرمة</option>
                                        <option value="madinah" ${customer.city === 'madinah' ? 'selected' : ''}>المدينة المنورة</option>
                                        <option value="dammam" ${customer.city === 'dammam' ? 'selected' : ''}>الدمام</option>
                                        <option value="taif" ${customer.city === 'taif' ? 'selected' : ''}>الطائف</option>
                                        <option value="tabuk" ${customer.city === 'tabuk' ? 'selected' : ''}>تبوك</option>
                                        <option value="yanbu" ${customer.city === 'yanbu' ? 'selected' : ''}>ينبع</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>الحالة</label>
                                    <select id="editCustomerStatus">
                                        <option value="active" ${customer.status === 'active' ? 'selected' : ''}>نشط</option>
                                        <option value="inactive" ${customer.status === 'inactive' ? 'selected' : ''}>غير نشط</option>
                                        <option value="VIP" ${customer.status === 'VIP' ? 'selected' : ''}>VIP</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>العنوان التفصيلي</label>
                                <textarea id="editCustomerAddress" rows="3">${customer.address || ''}</textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeModal()">إلغاء</button>
                        <button class="btn btn-primary" onclick="updateCustomer('${customerId}')">حفظ التغييرات</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function updateCustomer(customerId) {
            const customers = JSON.parse(localStorage.getItem('customers') || '[]');
            const customerIndex = customers.findIndex(c => c.id === customerId);
            
            if (customerIndex === -1) {
                alert('العميل غير موجود');
                return;
            }
            
            // Update customer data
            customers[customerIndex].name = document.getElementById('editCustomerName').value;
            customers[customerIndex].email = document.getElementById('editCustomerEmail').value;
            customers[customerIndex].phone = document.getElementById('editCustomerPhone').value;
            customers[customerIndex].nationalId = document.getElementById('editCustomerNationalId').value;
            customers[customerIndex].city = document.getElementById('editCustomerCity').value;
            customers[customerIndex].address = document.getElementById('editCustomerAddress').value;
            customers[customerIndex].status = document.getElementById('editCustomerStatus').value;
            
            // Save to localStorage
            localStorage.setItem('customers', JSON.stringify(customers));
            
            // Close modal and refresh table
            closeModal();
            
            // Reload customers table
            renderCustomersTable(customers);
            updateCustomerStatistics(customers);
        }

        function messageCustomer(customerId) {
            const customers = JSON.parse(localStorage.getItem('customers') || '[]');
            const customer = customers.find(c => c.id === customerId);
            
            if (!customer) {
                alert('العميل غير موجود');
                return;
            }
            
            const message = prompt(`إرسال رسالة إلى ${customer.name} (${customer.phone}):`);
            if (message && message.trim()) {
                alert(`تم إرسال الرسالة: "${message}" إلى ${customer.name}`);
                // هنا يمكن إضافة منطق إرسال الرسالة الفعلي
            }
        }
        
        function deleteCustomer(customerId) {
            if (confirm('هل أنت متأكد من حذف هذا العميل؟ لا يمكن التراجع عن هذا الإجراء.')) {
                const customers = JSON.parse(localStorage.getItem('customers') || '[]');
                const filteredCustomers = customers.filter(c => c.id !== customerId);
                localStorage.setItem('customers', JSON.stringify(filteredCustomers));
                
                // Reload customers table
                renderCustomersTable(filteredCustomers);
                updateCustomerStatistics(filteredCustomers);
            }
        }

        function filterCustomers() {
            const searchTerm = document.getElementById('customerSearch').value.toLowerCase();
            const statusFilter = document.getElementById('customerStatusFilter').value;
            const dateFilter = document.getElementById('customerDateFilter').value;
            
            // Get customers from localStorage
            const customers = JSON.parse(localStorage.getItem('customers') || '[]');
            
            // Filter customers
            const filteredCustomers = customers.filter(customer => {
                const matchesSearch = !searchTerm || 
                    customer.name.toLowerCase().includes(searchTerm) ||
                    customer.email.toLowerCase().includes(searchTerm) ||
                    customer.phone.includes(searchTerm);
                
                const matchesStatus = !statusFilter || customer.status === statusFilter;
                
                const matchesDate = !dateFilter || 
                    new Date(customer.registrationDate).toISOString().split('T')[0] === dateFilter;
                
                return matchesSearch && matchesStatus && matchesDate;
            });
            
            // Re-render table with filtered data
            renderCustomersTable(filteredCustomers);
        }

        function resetCustomerFilters() {
            try {
                // Clear all filter inputs
                const searchInput = document.getElementById('customerSearch');
                const statusFilter = document.getElementById('customerStatusFilter');
                const dateFilter = document.getElementById('customerDateFilter');
                
                if (searchInput) searchInput.value = '';
                if (statusFilter) statusFilter.value = '';
                if (dateFilter) dateFilter.value = '';
                
                // Reload all customers
                const customers = JSON.parse(localStorage.getItem('customers') || '[]');
                renderCustomersTable(customers);
                
                // Show success message
                showNotification('تم إعادة تعيين المرشحات بنجاح', 'success');
                
                // Update customer count
                updateCustomerStats();
                
            } catch (error) {
                console.error('Error resetting filters:', error);
                alert('حدث خطأ أثناء إعادة تعيين المرشحات');
            }
        }
        
        // Show notification function
        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            // Add styles
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6'};
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                z-index: 10000;
                animation: slideIn 0.3s ease;
            `;
            
            // Add animation styles
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                .notification-content {
                    display: flex;
                    align-items: center;
                    gap: 0.5rem;
                }
            `;
            document.head.appendChild(style);
            
            // Add to page
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.animation = 'slideIn 0.3s ease reverse';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
        
        // Update customer statistics
        function updateCustomerStats() {
            try {
                const customers = JSON.parse(localStorage.getItem('customers') || '[]');
                const totalCustomers = customers.length;
                const activeCustomers = customers.filter(c => c.status === 'active').length;
                const inactiveCustomers = customers.filter(c => c.status === 'inactive').length;
                
                // Update stats display if elements exist
                const totalElement = document.getElementById('totalCustomers');
                const activeElement = document.getElementById('activeCustomers');
                const inactiveElement = document.getElementById('inactiveCustomers');
                
                if (totalElement) totalElement.textContent = totalCustomers;
                if (activeElement) activeElement.textContent = activeCustomers;
                if (inactiveElement) inactiveElement.textContent = inactiveCustomers;
                
            } catch (error) {
                console.error('Error updating customer stats:', error);
            }
        }
        
        function clearAllDummyCustomers() {
            if (confirm('هل أنت متأكد من حذف جميع العملاء الوهميين؟')) {
                const customers = JSON.parse(localStorage.getItem('customers') || '[]');
                
                // Filter out dummy customers
                const realCustomers = customers.filter(customer => {
                    return !customer.email.includes('@email.com') && 
                           !customer.id.startsWith('NW20241220');
                });
                
                // Update localStorage
                localStorage.setItem('customers', JSON.stringify(realCustomers));
                
                // Reload table
                renderCustomersTable(realCustomers);
                updateCustomerStatistics(realCustomers);
                
                alert('تم حذف العملاء الوهميين بنجاح');
            }
        }

        // Driver Management Functions
        function showAddDriverModal() {
            // Remove any existing modals first
            const existingModals = document.querySelectorAll('.modal');
            existingModals.forEach(modal => modal.remove());
            
            // Create add driver modal
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.style.position = 'fixed';
            modal.style.top = '0';
            modal.style.left = '0';
            modal.style.width = '100%';
            modal.style.height = '100%';
            modal.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
            modal.style.zIndex = '9999';
            modal.style.display = 'flex';
            modal.style.alignItems = 'center';
            modal.style.justifyContent = 'center';
            
            modal.innerHTML = `
                <div class="modal-content add-driver-modal">
                    <div class="modal-header">
                        <h3><i class="fas fa-user-plus"></i> إضافة سائق جديد</h3>
                        <span class="close" onclick="this.closest('.modal').remove()">&times;</span>
                    </div>
                    <div class="modal-body">
                        <form id="addDriverForm" class="add-driver-form">
                            <!-- Personal Information -->
                            <div class="form-section">
                                <h4><i class="fas fa-user"></i> المعلومات الشخصية</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="driverName">الاسم الكامل</label>
                                        <input type="text" id="driverName" placeholder="مثال: أحمد محمد" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="driverId">رقم الهوية</label>
                                        <input type="text" id="driverId" placeholder="مثال: 1234567890" required>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="driverPhone">رقم الهاتف</label>
                                        <input type="tel" id="driverPhone" placeholder="مثال: +966501234567" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="driverEmail">البريد الإلكتروني</label>
                                        <input type="email" id="driverEmail" placeholder="مثال: ahmed@email.com">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="driverAddress">العنوان</label>
                                        <input type="text" id="driverAddress" placeholder="مثال: الرياض، حي النرجس">
                                    </div>
                                    <div class="form-group">
                                        <label for="driverBirthDate">تاريخ الميلاد</label>
                                        <input type="date" id="driverBirthDate" required>
                                    </div>
                                </div>
                            </div>

                            <!-- License Information -->
                            <div class="form-section">
                                <h4><i class="fas fa-id-card"></i> معلومات رخصة القيادة</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="licenseNumber">رقم رخصة القيادة</label>
                                        <input type="text" id="licenseNumber" placeholder="مثال: 1234567890" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="licenseType">نوع الرخصة</label>
                                        <select id="licenseType" required>
                                            <option value="">اختر نوع الرخصة</option>
                                            <option value="خاص">خاص</option>
                                            <option value="نقل عام">نقل عام</option>
                                            <option value="نقل ثقيل">نقل ثقيل</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="licenseIssueDate">تاريخ الإصدار</label>
                                        <input type="date" id="licenseIssueDate" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="licenseExpiryDate">تاريخ الانتهاء</label>
                                        <input type="date" id="licenseExpiryDate" required>
                                    </div>
                                </div>
                            </div>

                            <!-- Employment Information -->
                            <div class="form-section">
                                <h4><i class="fas fa-briefcase"></i> معلومات التوظيف</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="hireDate">تاريخ التوظيف</label>
                                        <input type="date" id="hireDate" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="driverStatus">الحالة</label>
                                        <select id="driverStatus" required>
                                            <option value="نشط">نشط</option>
                                            <option value="غير نشط">غير نشط</option>
                                            <option value="في إجازة">في إجازة</option>
                                            <option value="معلق">معلق</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="salary">الراتب الشهري</label>
                                        <input type="number" id="salary" min="0" step="0.01" placeholder="مثال: 5000">
                                    </div>
                                    <div class="form-group">
                                        <label for="emergencyContact">جهة الاتصال في الطوارئ</label>
                                        <input type="tel" id="emergencyContact" placeholder="مثال: +966501234567">
                                    </div>
                                </div>
                            </div>

                            <!-- Additional Information -->
                            <div class="form-section">
                                <h4><i class="fas fa-info-circle"></i> معلومات إضافية</h4>
                                <div class="form-group">
                                    <label for="driverNotes">ملاحظات</label>
                                    <textarea id="driverNotes" rows="3" placeholder="أي ملاحظات إضافية حول السائق..."></textarea>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">
                            <i class="fas fa-times"></i> إلغاء
                        </button>
                        <button class="btn btn-primary" onclick="saveNewDriver()">
                            <i class="fas fa-plus"></i> إضافة السائق
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Set today's date as default for hire date
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('hireDate').value = today;
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
            
            // Close modal with Escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    modal.remove();
                }
            });
        }

        function viewDriver(driverId) {
            // Remove any existing modals first
            const existingModals = document.querySelectorAll('.modal');
            existingModals.forEach(modal => modal.remove());
            
            // Create driver details modal
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.style.position = 'fixed';
            modal.style.top = '0';
            modal.style.left = '0';
            modal.style.width = '100%';
            modal.style.height = '100%';
            modal.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
            modal.style.zIndex = '9999';
            modal.style.display = 'flex';
            modal.style.alignItems = 'center';
            modal.style.justifyContent = 'center';
            
            modal.innerHTML = `
                <div class="modal-content driver-details-modal">
                    <div class="modal-header">
                        <h3><i class="fas fa-user-tie"></i> تفاصيل السائق ${driverId}</h3>
                        <span class="close" onclick="this.closest('.modal').remove()">&times;</span>
                    </div>
                    <div class="modal-body">
                        <div class="driver-details-container">
                            <!-- Driver Header -->
                            <div class="driver-header-section">
                                <div class="driver-avatar-large">أ</div>
                                <div class="driver-info">
                                    <h2>أحمد محمد</h2>
                                    <p class="driver-id">ID: ${driverId}</p>
                                    <div class="driver-status">
                                        <span class="status-badge status-active">نشط</span>
                                    </div>
                                </div>
                                <div class="driver-stats">
                                    <div class="stat-item">
                                        <div class="stat-number">245</div>
                                        <div class="stat-label">رحلات مكتملة</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-number">4.8</div>
                                        <div class="stat-label">التقييم</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-number">2</div>
                                        <div class="stat-label">سنوات الخبرة</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Personal Information -->
                            <div class="info-section">
                                <h4><i class="fas fa-user"></i> المعلومات الشخصية</h4>
                                <div class="info-grid">
                                    <div class="info-item">
                                        <div class="info-label">رقم الهوية</div>
                                        <div class="info-value">1234567890</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">رقم الهاتف</div>
                                        <div class="info-value">+966501234567</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">البريد الإلكتروني</div>
                                        <div class="info-value">ahmed@email.com</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">تاريخ الميلاد</div>
                                        <div class="info-value">15 مارس 1985</div>
                                    </div>
                                </div>
                            </div>

                            <!-- License Information -->
                            <div class="info-section">
                                <h4><i class="fas fa-id-card"></i> معلومات رخصة القيادة</h4>
                                <div class="info-grid">
                                    <div class="info-item">
                                        <div class="info-label">رقم الرخصة</div>
                                        <div class="info-value">1234567890</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">نوع الرخصة</div>
                                        <div class="info-value">نقل عام</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">تاريخ الإصدار</div>
                                        <div class="info-value">15 يناير 2020</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">تاريخ الانتهاء</div>
                                        <div class="info-value">15 يناير 2025</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Employment Information -->
                            <div class="info-section">
                                <h4><i class="fas fa-briefcase"></i> معلومات التوظيف</h4>
                                <div class="info-grid">
                                    <div class="info-item">
                                        <div class="info-label">تاريخ التوظيف</div>
                                        <div class="info-value">15 يناير 2023</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">الراتب الشهري</div>
                                        <div class="info-value">5,000 ريال</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">جهة الاتصال في الطوارئ</div>
                                        <div class="info-value">+966501234567</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">سنوات الخبرة</div>
                                        <div class="info-value">2 سنة</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Recent Trips -->
                            <div class="info-section">
                                <h4><i class="fas fa-route"></i> الرحلات الأخيرة</h4>
                                <div class="trips-list">
                                    <div class="trip-item">
                                        <div class="trip-route">جدة - الرياض</div>
                                        <div class="trip-date">25 ديسمبر 2024</div>
                                        <div class="trip-status completed">مكتملة</div>
                                    </div>
                                    <div class="trip-item">
                                        <div class="trip-route">الرياض - الدمام</div>
                                        <div class="trip-date">24 ديسمبر 2024</div>
                                        <div class="trip-status completed">مكتملة</div>
                                    </div>
                                    <div class="trip-item">
                                        <div class="trip-route">الدمام - جدة</div>
                                        <div class="trip-date">23 ديسمبر 2024</div>
                                        <div class="trip-status completed">مكتملة</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">
                            <i class="fas fa-times"></i> إغلاق
                        </button>
                        <button class="btn btn-primary" onclick="editDriver('${driverId}')">
                            <i class="fas fa-edit"></i> تعديل السائق
                        </button>
                        <button class="btn btn-success" onclick="scheduleDriver('${driverId}')">
                            <i class="fas fa-calendar"></i> جدولة المناوبات
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
            
            // Close modal with Escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    modal.remove();
                }
            });
        }

        function editDriver(driverId) {
            // Remove any existing modals first
            const existingModals = document.querySelectorAll('.modal');
            existingModals.forEach(modal => modal.remove());
            
            // Create edit driver modal
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.style.position = 'fixed';
            modal.style.top = '0';
            modal.style.left = '0';
            modal.style.width = '100%';
            modal.style.height = '100%';
            modal.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
            modal.style.zIndex = '9999';
            modal.style.display = 'flex';
            modal.style.alignItems = 'center';
            modal.style.justifyContent = 'center';
            
            modal.innerHTML = `
                <div class="modal-content edit-driver-modal">
                    <div class="modal-header">
                        <h3><i class="fas fa-user-edit"></i> تعديل بيانات السائق ${driverId}</h3>
                        <span class="close" onclick="this.closest('.modal').remove()">&times;</span>
                    </div>
                    <div class="modal-body">
                        <form id="editDriverForm" class="edit-driver-form">
                            <!-- Personal Information -->
                            <div class="form-section">
                                <h4><i class="fas fa-user"></i> المعلومات الشخصية</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="editDriverName">الاسم الكامل</label>
                                        <input type="text" id="editDriverName" value="أحمد محمد" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="editDriverId">رقم الهوية</label>
                                        <input type="text" id="editDriverId" value="1234567890" required>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="editDriverPhone">رقم الهاتف</label>
                                        <input type="tel" id="editDriverPhone" value="+966501234567" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="editDriverEmail">البريد الإلكتروني</label>
                                        <input type="email" id="editDriverEmail" value="ahmed@email.com">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="editDriverAddress">العنوان</label>
                                        <input type="text" id="editDriverAddress" value="الرياض، حي النرجس">
                                    </div>
                                    <div class="form-group">
                                        <label for="editDriverBirthDate">تاريخ الميلاد</label>
                                        <input type="date" id="editDriverBirthDate" value="1985-03-15" required>
                                    </div>
                                </div>
                            </div>

                            <!-- License Information -->
                            <div class="form-section">
                                <h4><i class="fas fa-id-card"></i> معلومات رخصة القيادة</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="editLicenseNumber">رقم رخصة القيادة</label>
                                        <input type="text" id="editLicenseNumber" value="1234567890" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="editLicenseType">نوع الرخصة</label>
                                        <select id="editLicenseType" required>
                                            <option value="">اختر نوع الرخصة</option>
                                            <option value="خاص" selected>خاص</option>
                                            <option value="نقل عام">نقل عام</option>
                                            <option value="نقل ثقيل">نقل ثقيل</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="editLicenseIssueDate">تاريخ الإصدار</label>
                                        <input type="date" id="editLicenseIssueDate" value="2020-01-15" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="editLicenseExpiryDate">تاريخ الانتهاء</label>
                                        <input type="date" id="editLicenseExpiryDate" value="2025-01-15" required>
                                    </div>
                                </div>
                            </div>

                            <!-- Employment Information -->
                            <div class="form-section">
                                <h4><i class="fas fa-briefcase"></i> معلومات التوظيف</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="editHireDate">تاريخ التوظيف</label>
                                        <input type="date" id="editHireDate" value="2023-01-15" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="editDriverStatus">الحالة</label>
                                        <select id="editDriverStatus" required>
                                            <option value="نشط" selected>نشط</option>
                                            <option value="غير نشط">غير نشط</option>
                                            <option value="في إجازة">في إجازة</option>
                                            <option value="معلق">معلق</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="editSalary">الراتب الشهري</label>
                                        <input type="number" id="editSalary" min="0" step="0.01" value="5000" placeholder="مثال: 5000">
                                    </div>
                                    <div class="form-group">
                                        <label for="editEmergencyContact">جهة الاتصال في الطوارئ</label>
                                        <input type="tel" id="editEmergencyContact" value="+966501234567" placeholder="مثال: +966501234567">
                                    </div>
                                </div>
                            </div>

                            <!-- Performance Information -->
                            <div class="form-section">
                                <h4><i class="fas fa-chart-line"></i> معلومات الأداء</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="editCompletedTrips">عدد الرحلات المكتملة</label>
                                        <input type="number" id="editCompletedTrips" min="0" value="245" placeholder="مثال: 245">
                                    </div>
                                    <div class="form-group">
                                        <label for="editDriverRating">التقييم (من 5)</label>
                                        <input type="number" id="editDriverRating" min="0" max="5" step="0.1" value="4.8" placeholder="مثال: 4.8">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="editExperienceYears">سنوات الخبرة</label>
                                        <input type="number" id="editExperienceYears" min="0" step="0.1" value="2" placeholder="مثال: 2">
                                    </div>
                                    <div class="form-group">
                                        <label for="editLastTripDate">تاريخ آخر رحلة</label>
                                        <input type="date" id="editLastTripDate" value="2024-12-25">
                                    </div>
                                </div>
                            </div>

                            <!-- Additional Information -->
                            <div class="form-section">
                                <h4><i class="fas fa-info-circle"></i> معلومات إضافية</h4>
                                <div class="form-group">
                                    <label for="editDriverNotes">ملاحظات</label>
                                    <textarea id="editDriverNotes" rows="3" placeholder="أي ملاحظات إضافية حول السائق...">سائق ممتاز، موثوق، ومحترف في التعامل مع العملاء</textarea>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">
                            <i class="fas fa-times"></i> إلغاء
                        </button>
                        <button class="btn btn-primary" onclick="saveDriverChanges('${driverId}')">
                            <i class="fas fa-save"></i> حفظ التغييرات
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
            
            // Close modal with Escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    modal.remove();
                }
            });
        }

        function saveDriverChanges(driverId) {
            // Get form data
            const formData = {
                driverName: document.getElementById('editDriverName').value,
                driverId: document.getElementById('editDriverId').value,
                driverPhone: document.getElementById('editDriverPhone').value,
                driverEmail: document.getElementById('editDriverEmail').value,
                driverAddress: document.getElementById('editDriverAddress').value,
                driverBirthDate: document.getElementById('editDriverBirthDate').value,
                licenseNumber: document.getElementById('editLicenseNumber').value,
                licenseType: document.getElementById('editLicenseType').value,
                licenseIssueDate: document.getElementById('editLicenseIssueDate').value,
                licenseExpiryDate: document.getElementById('editLicenseExpiryDate').value,
                hireDate: document.getElementById('editHireDate').value,
                driverStatus: document.getElementById('editDriverStatus').value,
                salary: document.getElementById('editSalary').value,
                emergencyContact: document.getElementById('editEmergencyContact').value,
                completedTrips: document.getElementById('editCompletedTrips').value,
                driverRating: document.getElementById('editDriverRating').value,
                experienceYears: document.getElementById('editExperienceYears').value,
                lastTripDate: document.getElementById('editLastTripDate').value,
                driverNotes: document.getElementById('editDriverNotes').value
            };

            // Validate form
            if (!formData.driverName || !formData.driverId || !formData.driverPhone || 
                !formData.licenseNumber || !formData.licenseType || !formData.hireDate) {
                alert('يرجى ملء جميع الحقول المطلوبة');
                return;
            }

            // Show loading
            const saveBtn = document.querySelector('.btn-primary');
            const originalText = saveBtn.innerHTML;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري الحفظ...';
            saveBtn.disabled = true;

            // Simulate API call
            setTimeout(() => {
                // Show success message
                alert(`تم تحديث بيانات السائق ${formData.driverName} بنجاح!`);
                
                // Close modal
                document.querySelector('.modal').remove();
                
                // Update driver in table (in real app, this would reload data)
                // Driver updated successfully
                
                // Update table row (simulation)
                updateDriverInTable(driverId, formData);
            }, 1500);
        }

        function updateDriverInTable(driverId, driverData) {
            const table = document.getElementById('driversTable');
            if (table) {
                const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
                
                for (let row of rows) {
                    const cells = row.getElementsByTagName('td');
                    if (cells.length > 0) {
                        const driverInfoCell = cells[0];
                        const driverNameElement = driverInfoCell.querySelector('strong');
                        if (driverNameElement && driverNameElement.textContent.includes(driverData.driverName)) {
                            // Update driver name and ID
                            driverNameElement.textContent = driverData.driverName;
                            const driverIdElement = driverInfoCell.querySelector('small');
                            if (driverIdElement) {
                                driverIdElement.textContent = `ID: ${driverData.driverId}`;
                            }
                            
                            // Update contact info
                            if (cells[1]) {
                                const contactInfo = cells[1].querySelector('.contact-info');
                                if (contactInfo) {
                                    contactInfo.innerHTML = `
                                        <div><i class="fas fa-phone"></i> ${driverData.driverPhone}</div>
                                        <div><i class="fas fa-envelope"></i> ${driverData.driverEmail || 'غير محدد'}</div>
                                    `;
                                }
                            }
                            
                            // Update license info
                            if (cells[2]) {
                                const licenseInfo = cells[2].querySelector('.license-info');
                                if (licenseInfo) {
                                    licenseInfo.innerHTML = `
                                        <div class="license-number">${driverData.licenseNumber}</div>
                                        <div class="license-type">${driverData.licenseType}</div>
                                        <div class="license-expiry">${driverData.licenseExpiryDate}</div>
                                    `;
                                }
                            }
                            
                            // Update hire date
                            if (cells[3]) {
                                cells[3].textContent = driverData.hireDate;
                            }
                            
                            // Update completed trips
                            if (cells[4]) {
                                const badge = cells[4].querySelector('.badge');
                                if (badge) {
                                    badge.textContent = `${driverData.completedTrips} رحلة`;
                                }
                            }
                            
                            // Update rating
                            if (cells[5]) {
                                const rating = cells[5].querySelector('.rating');
                                if (rating) {
                                    const stars = '★'.repeat(Math.floor(driverData.driverRating)) + '☆'.repeat(5 - Math.floor(driverData.driverRating));
                                    rating.innerHTML = `
                                        <div class="stars">${stars}</div>
                                        <div class="rating-text">${driverData.driverRating}/5</div>
                                    `;
                                }
                            }
                            
                            // Update status
                            if (cells[6]) {
                                const statusBadge = cells[6].querySelector('.status-badge');
                                if (statusBadge) {
                                    statusBadge.textContent = driverData.driverStatus;
                                    statusBadge.className = `status-badge status-${driverData.driverStatus === 'نشط' ? 'active' : 'inactive'}`;
                                }
                            }
                            
                            break;
                        }
                    }
                }
            }
        }

        function scheduleDriver(driverId) {
            alert(`جدولة المناوبات للسائق ${driverId} - سيتم فتح جدول المناوبات`);
        }

        function messageDriver(driverId) {
            alert(`إرسال رسالة للسائق ${driverId} - سيتم فتح نموذج الرسالة`);
        }

        function saveNewDriver() {
            // Get form data
            const formData = {
                driverName: document.getElementById('driverName').value,
                driverId: document.getElementById('driverId').value,
                driverPhone: document.getElementById('driverPhone').value,
                driverEmail: document.getElementById('driverEmail').value,
                driverAddress: document.getElementById('driverAddress').value,
                driverBirthDate: document.getElementById('driverBirthDate').value,
                licenseNumber: document.getElementById('licenseNumber').value,
                licenseType: document.getElementById('licenseType').value,
                licenseIssueDate: document.getElementById('licenseIssueDate').value,
                licenseExpiryDate: document.getElementById('licenseExpiryDate').value,
                hireDate: document.getElementById('hireDate').value,
                driverStatus: document.getElementById('driverStatus').value,
                salary: document.getElementById('salary').value,
                emergencyContact: document.getElementById('emergencyContact').value,
                driverNotes: document.getElementById('driverNotes').value
            };

            // Validate form
            if (!formData.driverName || !formData.driverId || !formData.driverPhone || 
                !formData.licenseNumber || !formData.licenseType || !formData.hireDate) {
                alert('يرجى ملء جميع الحقول المطلوبة');
                return;
            }

            // Show loading
            const saveBtn = document.querySelector('.btn-primary');
            const originalText = saveBtn.innerHTML;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري الإضافة...';
            saveBtn.disabled = true;

            // Simulate API call
            setTimeout(() => {
                // Show success message
                alert(`تم إضافة السائق ${formData.driverName} بنجاح!`);
                
                // Close modal
                document.querySelector('.modal').remove();
                
                // Refresh drivers table (in real app, this would reload data)
                // New driver added successfully
                
                // Add to drivers table (simulation)
                addDriverToTable(formData);
            }, 1500);
        }

        function addDriverToTable(driverData) {
            const table = document.getElementById('driversTable');
            if (table) {
                const tbody = table.getElementsByTagName('tbody')[0];
                const newRow = tbody.insertRow(0);
                
                const driverInitial = driverData.driverName.charAt(0);
                
                newRow.innerHTML = `
                    <td>
                        <div class="driver-info-cell">
                            <div class="driver-avatar">${driverInitial}</div>
                            <div class="driver-details">
                                <strong>${driverData.driverName}</strong>
                                <small>ID: ${driverData.driverId}</small>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="contact-info">
                            <div><i class="fas fa-phone"></i> ${driverData.driverPhone}</div>
                            <div><i class="fas fa-envelope"></i> ${driverData.driverEmail || 'غير محدد'}</div>
                        </div>
                    </td>
                    <td>
                        <div class="license-info">
                            <div class="license-number">${driverData.licenseNumber}</div>
                            <div class="license-type">${driverData.licenseType}</div>
                            <div class="license-expiry">${driverData.licenseExpiryDate}</div>
                        </div>
                    </td>
                    <td>${driverData.hireDate}</td>
                    <td><span class="badge badge-info">0 رحلة</span></td>
                    <td>
                        <div class="rating">
                            <div class="stars">☆☆☆☆☆</div>
                            <div class="rating-text">0.0/5</div>
                        </div>
                    </td>
                    <td><span class="status-badge status-active">${driverData.driverStatus}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-action btn-view" onclick="viewDriver('${driverData.driverId}')" title="عرض التفاصيل">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-action btn-edit" onclick="editDriver('${driverData.driverId}')" title="تعديل السائق">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-action btn-schedule" onclick="scheduleDriver('${driverData.driverId}')" title="جدولة المناوبات">
                                <i class="fas fa-calendar"></i>
                            </button>
                            <button class="btn-action btn-message" onclick="messageDriver('${driverData.driverId}')" title="إرسال رسالة">
                                <i class="fas fa-envelope"></i>
                            </button>
                        </div>
                    </td>
                `;
            }
        }

        function filterDrivers() {
            const searchTerm = document.getElementById('driverSearch').value.toLowerCase();
            const statusFilter = document.getElementById('driverStatusFilter').value;
            const licenseFilter = document.getElementById('licenseTypeFilter').value;
            const table = document.getElementById('driversTable');
            const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');

            for (let i = 0; i < rows.length; i++) {
                const row = rows[i];
                const driverName = row.cells[0].textContent.toLowerCase();
                const contactInfo = row.cells[1].textContent.toLowerCase();
                const licenseInfo = row.cells[2].textContent.toLowerCase();
                const status = row.cells[6].textContent.toLowerCase();

                const matchesSearch = driverName.includes(searchTerm) || contactInfo.includes(searchTerm) || licenseInfo.includes(searchTerm);
                const matchesStatus = !statusFilter || status.includes(statusFilter);
                const matchesLicense = !licenseFilter || licenseInfo.includes(licenseFilter);

                if (matchesSearch && matchesStatus && matchesLicense) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            }
        }

        function resetDriverFilters() {
            document.getElementById('driverSearch').value = '';
            document.getElementById('driverStatusFilter').value = '';
            document.getElementById('licenseTypeFilter').value = '';
            filterDrivers();
        }

        // Fleet Management Functions
        function showAddFleetModal() {
            // Remove any existing modals first
            const existingModals = document.querySelectorAll('.modal');
            existingModals.forEach(modal => modal.remove());
            
            // Create add fleet modal
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.style.position = 'fixed';
            modal.style.top = '0';
            modal.style.left = '0';
            modal.style.width = '100%';
            modal.style.height = '100%';
            modal.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
            modal.style.zIndex = '9999';
            modal.style.display = 'flex';
            modal.style.alignItems = 'center';
            modal.style.justifyContent = 'center';
            
            modal.innerHTML = `
                <div class="modal-content add-fleet-modal">
                    <div class="modal-header">
                        <h3><i class="fas fa-bus"></i> إضافة مركبة جديدة</h3>
                        <span class="close" onclick="this.closest('.modal').remove()">&times;</span>
                    </div>
                    <div class="modal-body">
                        <form id="addFleetForm" class="add-fleet-form">
                            <!-- Basic Information -->
                            <div class="form-section">
                                <h4><i class="fas fa-info-circle"></i> المعلومات الأساسية</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="fleetName">اسم المركبة</label>
                                        <input type="text" id="fleetName" placeholder="مثال: حافلة فاخرة #001" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="fleetPlateNumber">رقم اللوحة</label>
                                        <input type="text" id="fleetPlateNumber" placeholder="مثال: ABC-1234" required>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="fleetType">نوع المركبة</label>
                                        <select id="fleetType" required>
                                            <option value="">اختر نوع المركبة</option>
                                            <option value="حافلة صغيرة">حافلة صغيرة</option>
                                            <option value="حافلة متوسطة">حافلة متوسطة</option>
                                            <option value="حافلة كبيرة">حافلة كبيرة</option>
                                            <option value="حافلة فاخرة">حافلة فاخرة</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="fleetCapacity">عدد المقاعد</label>
                                        <input type="number" id="fleetCapacity" min="1" max="100" placeholder="مثال: 50" required>
                                    </div>
                                </div>
                            </div>

                            <!-- Technical Information -->
                            <div class="form-section">
                                <h4><i class="fas fa-cogs"></i> المعلومات التقنية</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="fleetManufacturer">الشركة المصنعة</label>
                                        <input type="text" id="fleetManufacturer" placeholder="مثال: مرسيدس" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="fleetModel">الموديل</label>
                                        <input type="text" id="fleetModel" placeholder="مثال: Sprinter" required>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="fleetYear">سنة الصنع</label>
                                        <input type="number" id="fleetYear" min="2000" max="2025" placeholder="مثال: 2023" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="fleetEngine">نوع المحرك</label>
                                        <input type="text" id="fleetEngine" placeholder="مثال: ديزل" required>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="fleetColor">اللون</label>
                                        <input type="text" id="fleetColor" placeholder="مثال: أبيض" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="fleetVin">رقم الهيكل (VIN)</label>
                                        <input type="text" id="fleetVin" placeholder="مثال: 1HGBH41JXMN109186" required>
                                    </div>
                                </div>
                            </div>

                            <!-- Service Information -->
                            <div class="form-section">
                                <h4><i class="fas fa-wrench"></i> معلومات الخدمة</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="fleetStatus">الحالة</label>
                                        <select id="fleetStatus" required>
                                            <option value="نشط">نشط</option>
                                            <option value="في الصيانة">في الصيانة</option>
                                            <option value="خارج الخدمة">خارج الخدمة</option>
                                            <option value="محجوز">محجوز</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="fleetLocation">الموقع الحالي</label>
                                        <input type="text" id="fleetLocation" placeholder="مثال: محطة الرياض" required>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="fleetPurchaseDate">تاريخ الشراء</label>
                                        <input type="date" id="fleetPurchaseDate" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="fleetWarrantyExpiry">انتهاء الضمان</label>
                                        <input type="date" id="fleetWarrantyExpiry">
                                    </div>
                                </div>
                            </div>

                            <!-- Additional Information -->
                            <div class="form-section">
                                <h4><i class="fas fa-info-circle"></i> معلومات إضافية</h4>
                                <div class="form-group">
                                    <label for="fleetNotes">ملاحظات</label>
                                    <textarea id="fleetNotes" rows="3" placeholder="أي ملاحظات إضافية حول المركبة..."></textarea>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">
                            <i class="fas fa-times"></i> إلغاء
                        </button>
                        <button class="btn btn-primary" onclick="saveNewFleet()">
                            <i class="fas fa-plus"></i> إضافة المركبة
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Set today's date as default for purchase date
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('fleetPurchaseDate').value = today;
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
            
            // Close modal with Escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    modal.remove();
                }
            });
        }

        function viewFleet(fleetId) {
            // Remove any existing modals first
            const existingModals = document.querySelectorAll('.modal');
            existingModals.forEach(modal => modal.remove());
            
            // Create fleet details modal
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.style.position = 'fixed';
            modal.style.top = '0';
            modal.style.left = '0';
            modal.style.width = '100%';
            modal.style.height = '100%';
            modal.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
            modal.style.zIndex = '9999';
            modal.style.display = 'flex';
            modal.style.alignItems = 'center';
            modal.style.justifyContent = 'center';
            
            modal.innerHTML = `
                <div class="modal-content fleet-details-modal">
                    <div class="modal-header">
                        <h3><i class="fas fa-bus"></i> تفاصيل المركبة ${fleetId}</h3>
                        <span class="close" onclick="this.closest('.modal').remove()">&times;</span>
                    </div>
                    <div class="modal-body">
                        <div class="fleet-details-container">
                            <!-- Fleet Header -->
                            <div class="fleet-header-section">
                                <div class="fleet-avatar-large">🚌</div>
                                <div class="fleet-info">
                                    <h2>حافلة فاخرة #001</h2>
                                    <p class="fleet-id">ID: ${fleetId}</p>
                                    <div class="fleet-status">
                                        <span class="status-badge status-active">نشط</span>
                                    </div>
                                </div>
                                <div class="fleet-stats">
                                    <div class="stat-item">
                                        <div class="stat-number">45,000</div>
                                        <div class="stat-label">كم مقطوع</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-number">50</div>
                                        <div class="stat-label">مقعد</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-number">2023</div>
                                        <div class="stat-label">سنة الصنع</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Basic Information -->
                            <div class="info-section">
                                <h4><i class="fas fa-info-circle"></i> المعلومات الأساسية</h4>
                                <div class="info-grid">
                                    <div class="info-item">
                                        <div class="info-label">رقم اللوحة</div>
                                        <div class="info-value">ABC-1234</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">نوع المركبة</div>
                                        <div class="info-value">حافلة فاخرة</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">عدد المقاعد</div>
                                        <div class="info-value">50 مقعد</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">الموقع الحالي</div>
                                        <div class="info-value">محطة الرياض</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Technical Information -->
                            <div class="info-section">
                                <h4><i class="fas fa-cogs"></i> المعلومات التقنية</h4>
                                <div class="info-grid">
                                    <div class="info-item">
                                        <div class="info-label">الشركة المصنعة</div>
                                        <div class="info-value">مرسيدس</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">الموديل</div>
                                        <div class="info-value">Sprinter</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">سنة الصنع</div>
                                        <div class="info-value">2023</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">نوع المحرك</div>
                                        <div class="info-value">ديزل</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Service Information -->
                            <div class="info-section">
                                <h4><i class="fas fa-wrench"></i> معلومات الخدمة</h4>
                                <div class="info-grid">
                                    <div class="info-item">
                                        <div class="info-label">تاريخ الشراء</div>
                                        <div class="info-value">15 يناير 2023</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">آخر صيانة</div>
                                        <div class="info-value">15 ديسمبر 2024</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">انتهاء الضمان</div>
                                        <div class="info-value">15 يناير 2026</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">المسافة المقطوعة</div>
                                        <div class="info-value">45,000 كم</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Recent Trips -->
                            <div class="info-section">
                                <h4><i class="fas fa-route"></i> الرحلات الأخيرة</h4>
                                <div class="trips-list">
                                    <div class="trip-item">
                                        <div class="trip-route">جدة - الرياض</div>
                                        <div class="trip-date">25 ديسمبر 2024</div>
                                        <div class="trip-status completed">مكتملة</div>
                                    </div>
                                    <div class="trip-item">
                                        <div class="trip-route">الرياض - الدمام</div>
                                        <div class="trip-date">24 ديسمبر 2024</div>
                                        <div class="trip-status completed">مكتملة</div>
                                    </div>
                                    <div class="trip-item">
                                        <div class="trip-route">الدمام - جدة</div>
                                        <div class="trip-date">23 ديسمبر 2024</div>
                                        <div class="trip-status completed">مكتملة</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">
                            <i class="fas fa-times"></i> إغلاق
                        </button>
                        <button class="btn btn-primary" onclick="editFleet('${fleetId}')">
                            <i class="fas fa-edit"></i> تعديل المركبة
                        </button>
                        <button class="btn btn-warning" onclick="scheduleMaintenance('${fleetId}')">
                            <i class="fas fa-wrench"></i> جدولة الصيانة
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
            
            // Close modal with Escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    modal.remove();
                }
            });
        }

        function editFleet(fleetId) {
            // Remove any existing modals first
            const existingModals = document.querySelectorAll('.modal');
            existingModals.forEach(modal => modal.remove());
            
            // Create edit fleet modal
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.style.position = 'fixed';
            modal.style.top = '0';
            modal.style.left = '0';
            modal.style.width = '100%';
            modal.style.height = '100%';
            modal.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
            modal.style.zIndex = '9999';
            modal.style.display = 'flex';
            modal.style.alignItems = 'center';
            modal.style.justifyContent = 'center';
            
            modal.innerHTML = `
                <div class="modal-content edit-fleet-modal">
                    <div class="modal-header">
                        <h3><i class="fas fa-bus"></i> تعديل بيانات المركبة ${fleetId}</h3>
                        <span class="close" onclick="this.closest('.modal').remove()">&times;</span>
                    </div>
                    <div class="modal-body">
                        <form id="editFleetForm" class="edit-fleet-form">
                            <!-- Basic Information -->
                            <div class="form-section">
                                <h4><i class="fas fa-info-circle"></i> المعلومات الأساسية</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="editFleetName">اسم المركبة</label>
                                        <input type="text" id="editFleetName" value="حافلة فاخرة #001" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="editFleetPlateNumber">رقم اللوحة</label>
                                        <input type="text" id="editFleetPlateNumber" value="ABC-1234" required>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="editFleetType">نوع المركبة</label>
                                        <select id="editFleetType" required>
                                            <option value="">اختر نوع المركبة</option>
                                            <option value="حافلة صغيرة">حافلة صغيرة</option>
                                            <option value="حافلة متوسطة">حافلة متوسطة</option>
                                            <option value="حافلة كبيرة">حافلة كبيرة</option>
                                            <option value="حافلة فاخرة" selected>حافلة فاخرة</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="editFleetCapacity">عدد المقاعد</label>
                                        <input type="number" id="editFleetCapacity" min="1" max="100" value="50" required>
                                    </div>
                                </div>
                            </div>

                            <!-- Technical Information -->
                            <div class="form-section">
                                <h4><i class="fas fa-cogs"></i> المعلومات التقنية</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="editFleetManufacturer">الشركة المصنعة</label>
                                        <input type="text" id="editFleetManufacturer" value="مرسيدس" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="editFleetModel">الموديل</label>
                                        <input type="text" id="editFleetModel" value="Sprinter" required>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="editFleetYear">سنة الصنع</label>
                                        <input type="number" id="editFleetYear" min="2000" max="2025" value="2023" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="editFleetEngine">نوع المحرك</label>
                                        <input type="text" id="editFleetEngine" value="ديزل" required>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="editFleetColor">اللون</label>
                                        <input type="text" id="editFleetColor" value="أبيض" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="editFleetVin">رقم الهيكل (VIN)</label>
                                        <input type="text" id="editFleetVin" value="1HGBH41JXMN109186" required>
                                    </div>
                                </div>
                            </div>

                            <!-- Service Information -->
                            <div class="form-section">
                                <h4><i class="fas fa-wrench"></i> معلومات الخدمة</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="editFleetStatus">الحالة</label>
                                        <select id="editFleetStatus" required>
                                            <option value="نشط" selected>نشط</option>
                                            <option value="في الصيانة">في الصيانة</option>
                                            <option value="خارج الخدمة">خارج الخدمة</option>
                                            <option value="محجوز">محجوز</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="editFleetLocation">الموقع الحالي</label>
                                        <input type="text" id="editFleetLocation" value="محطة الرياض" required>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="editFleetPurchaseDate">تاريخ الشراء</label>
                                        <input type="date" id="editFleetPurchaseDate" value="2023-01-15" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="editFleetWarrantyExpiry">انتهاء الضمان</label>
                                        <input type="date" id="editFleetWarrantyExpiry" value="2026-01-15">
                                    </div>
                                </div>
                            </div>

                            <!-- Performance Information -->
                            <div class="form-section">
                                <h4><i class="fas fa-chart-line"></i> معلومات الأداء</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="editFleetMileage">المسافة المقطوعة (كم)</label>
                                        <input type="number" id="editFleetMileage" min="0" value="45000" placeholder="مثال: 45000">
                                    </div>
                                    <div class="form-group">
                                        <label for="editFleetLastMaintenance">آخر صيانة</label>
                                        <input type="date" id="editFleetLastMaintenance" value="2024-12-15">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="editFleetNextMaintenance">الصيانة القادمة</label>
                                        <input type="date" id="editFleetNextMaintenance" value="2025-03-15">
                                    </div>
                                    <div class="form-group">
                                        <label for="editFleetFuelType">نوع الوقود</label>
                                        <select id="editFleetFuelType">
                                            <option value="ديزل" selected>ديزل</option>
                                            <option value="بنزين">بنزين</option>
                                            <option value="كهربائي">كهربائي</option>
                                            <option value="هجين">هجين</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Additional Information -->
                            <div class="form-section">
                                <h4><i class="fas fa-info-circle"></i> معلومات إضافية</h4>
                                <div class="form-group">
                                    <label for="editFleetNotes">ملاحظات</label>
                                    <textarea id="editFleetNotes" rows="3" placeholder="أي ملاحظات إضافية حول المركبة...">مركبة في حالة ممتازة، تحتاج صيانة دورية كل 3 أشهر</textarea>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">
                            <i class="fas fa-times"></i> إلغاء
                        </button>
                        <button class="btn btn-primary" onclick="saveFleetChanges('${fleetId}')">
                            <i class="fas fa-save"></i> حفظ التغييرات
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
            
            // Close modal with Escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    modal.remove();
                }
            });
        }

        function saveFleetChanges(fleetId) {
            // Get form data
            const formData = {
                fleetName: document.getElementById('editFleetName').value,
                fleetPlateNumber: document.getElementById('editFleetPlateNumber').value,
                fleetType: document.getElementById('editFleetType').value,
                fleetCapacity: document.getElementById('editFleetCapacity').value,
                fleetManufacturer: document.getElementById('editFleetManufacturer').value,
                fleetModel: document.getElementById('editFleetModel').value,
                fleetYear: document.getElementById('editFleetYear').value,
                fleetEngine: document.getElementById('editFleetEngine').value,
                fleetColor: document.getElementById('editFleetColor').value,
                fleetVin: document.getElementById('editFleetVin').value,
                fleetStatus: document.getElementById('editFleetStatus').value,
                fleetLocation: document.getElementById('editFleetLocation').value,
                fleetPurchaseDate: document.getElementById('editFleetPurchaseDate').value,
                fleetWarrantyExpiry: document.getElementById('editFleetWarrantyExpiry').value,
                fleetMileage: document.getElementById('editFleetMileage').value,
                fleetLastMaintenance: document.getElementById('editFleetLastMaintenance').value,
                fleetNextMaintenance: document.getElementById('editFleetNextMaintenance').value,
                fleetFuelType: document.getElementById('editFleetFuelType').value,
                fleetNotes: document.getElementById('editFleetNotes').value
            };

            // Validate form
            if (!formData.fleetName || !formData.fleetPlateNumber || !formData.fleetType || 
                !formData.fleetCapacity || !formData.fleetManufacturer || !formData.fleetModel || 
                !formData.fleetYear || !formData.fleetEngine || !formData.fleetColor || 
                !formData.fleetVin || !formData.fleetStatus || !formData.fleetLocation || 
                !formData.fleetPurchaseDate) {
                alert('يرجى ملء جميع الحقول المطلوبة');
                return;
            }

            // Show loading
            const saveBtn = document.querySelector('.btn-primary');
            const originalText = saveBtn.innerHTML;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري الحفظ...';
            saveBtn.disabled = true;

            // Simulate API call
            setTimeout(() => {
                // Show success message
                alert(`تم تحديث بيانات المركبة ${formData.fleetName} بنجاح!`);
                
                // Close modal
                document.querySelector('.modal').remove();
                
                // Update fleet in table (in real app, this would reload data)
                // Fleet updated successfully
                
                // Update table row (simulation)
                updateFleetInTable(fleetId, formData);
            }, 1500);
        }

        function updateFleetInTable(fleetId, fleetData) {
            const table = document.getElementById('fleetTable');
            if (table) {
                const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
                
                for (let row of rows) {
                    const cells = row.getElementsByTagName('td');
                    if (cells.length > 0) {
                        const fleetInfoCell = cells[0];
                        const fleetNameElement = fleetInfoCell.querySelector('strong');
                        if (fleetNameElement && fleetNameElement.textContent.includes(fleetData.fleetName)) {
                            // Update fleet name and plate number
                            fleetNameElement.textContent = fleetData.fleetName;
                            const fleetPlateElement = fleetInfoCell.querySelector('small');
                            if (fleetPlateElement) {
                                fleetPlateElement.textContent = `رقم اللوحة: ${fleetData.fleetPlateNumber}`;
                            }
                            
                            // Update technical info
                            if (cells[1]) {
                                const technicalInfo = cells[1].querySelector('.technical-info');
                                if (technicalInfo) {
                                    technicalInfo.innerHTML = `
                                        <div class="fleet-type">${fleetData.fleetType}</div>
                                        <div class="fleet-capacity">${fleetData.fleetCapacity} مقعد</div>
                                        <div class="fleet-year">${fleetData.fleetYear}</div>
                                    `;
                                }
                            }
                            
                            // Update status
                            if (cells[2]) {
                                const statusBadge = cells[2].querySelector('.status-badge');
                                if (statusBadge) {
                                    statusBadge.textContent = fleetData.fleetStatus;
                                    statusBadge.className = `status-badge status-${fleetData.fleetStatus === 'نشط' ? 'active' : 
                                        fleetData.fleetStatus === 'في الصيانة' ? 'maintenance' : 
                                        fleetData.fleetStatus === 'محجوز' ? 'reserved' : 'inactive'}`;
                                }
                            }
                            
                            // Update location
                            if (cells[3]) {
                                const locationInfo = cells[3].querySelector('.location-info');
                                if (locationInfo) {
                                    locationInfo.innerHTML = `
                                        <div class="location-name">${fleetData.fleetLocation}</div>
                                        <div class="location-time">الآن</div>
                                    `;
                                }
                            }
                            
                            // Update last maintenance
                            if (cells[4]) {
                                cells[4].textContent = fleetData.fleetLastMaintenance || 'لم يتم بعد';
                            }
                            
                            // Update mileage
                            if (cells[5]) {
                                const badge = cells[5].querySelector('.badge');
                                if (badge) {
                                    badge.textContent = `${fleetData.fleetMileage} كم`;
                                }
                            }
                            
                            break;
                        }
                    }
                }
            }
        }

        function scheduleMaintenance(fleetId) {
            alert(`جدولة الصيانة للمركبة ${fleetId} - سيتم فتح جدول الصيانة`);
        }

        function trackFleet(fleetId) {
            alert(`تتبع الموقع للمركبة ${fleetId} - سيتم فتح خريطة التتبع`);
        }

        function saveNewFleet() {
            // Get form data
            const formData = {
                fleetName: document.getElementById('fleetName').value,
                fleetPlateNumber: document.getElementById('fleetPlateNumber').value,
                fleetType: document.getElementById('fleetType').value,
                fleetCapacity: document.getElementById('fleetCapacity').value,
                fleetManufacturer: document.getElementById('fleetManufacturer').value,
                fleetModel: document.getElementById('fleetModel').value,
                fleetYear: document.getElementById('fleetYear').value,
                fleetEngine: document.getElementById('fleetEngine').value,
                fleetColor: document.getElementById('fleetColor').value,
                fleetVin: document.getElementById('fleetVin').value,
                fleetStatus: document.getElementById('fleetStatus').value,
                fleetLocation: document.getElementById('fleetLocation').value,
                fleetPurchaseDate: document.getElementById('fleetPurchaseDate').value,
                fleetWarrantyExpiry: document.getElementById('fleetWarrantyExpiry').value,
                fleetNotes: document.getElementById('fleetNotes').value
            };

            // Validate form
            if (!formData.fleetName || !formData.fleetPlateNumber || !formData.fleetType || 
                !formData.fleetCapacity || !formData.fleetManufacturer || !formData.fleetModel || 
                !formData.fleetYear || !formData.fleetEngine || !formData.fleetColor || 
                !formData.fleetVin || !formData.fleetStatus || !formData.fleetLocation || 
                !formData.fleetPurchaseDate) {
                alert('يرجى ملء جميع الحقول المطلوبة');
                return;
            }

            // Show loading
            const saveBtn = document.querySelector('.btn-primary');
            const originalText = saveBtn.innerHTML;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري الإضافة...';
            saveBtn.disabled = true;

            // Simulate API call
            setTimeout(() => {
                // Show success message
                alert(`تم إضافة المركبة ${formData.fleetName} بنجاح!`);
                
                // Close modal
                document.querySelector('.modal').remove();
                
                // Refresh fleet table (in real app, this would reload data)
                // New fleet added successfully
                
                // Add to fleet table (simulation)
                addFleetToTable(formData);
            }, 1500);
        }

        function addFleetToTable(fleetData) {
            const table = document.getElementById('fleetTable');
            if (table) {
                const tbody = table.getElementsByTagName('tbody')[0];
                const newRow = tbody.insertRow(0);
                
                newRow.innerHTML = `
                    <td>
                        <div class="fleet-info-cell">
                            <div class="fleet-avatar">🚌</div>
                            <div class="fleet-details">
                                <strong>${fleetData.fleetName}</strong>
                                <small>رقم اللوحة: ${fleetData.fleetPlateNumber}</small>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="technical-info">
                            <div class="fleet-type">${fleetData.fleetType}</div>
                            <div class="fleet-capacity">${fleetData.fleetCapacity} مقعد</div>
                            <div class="fleet-year">${fleetData.fleetYear}</div>
                        </div>
                    </td>
                    <td><span class="status-badge status-active">${fleetData.fleetStatus}</span></td>
                    <td>
                        <div class="location-info">
                            <div class="location-name">${fleetData.fleetLocation}</div>
                            <div class="location-time">الآن</div>
                        </div>
                    </td>
                    <td>لم يتم بعد</td>
                    <td><span class="badge badge-info">0 كم</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-action btn-view" onclick="viewFleet('F004')" title="عرض التفاصيل">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-action btn-edit" onclick="editFleet('F004')" title="تعديل المركبة">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-action btn-maintenance" onclick="scheduleMaintenance('F004')" title="جدولة الصيانة">
                                <i class="fas fa-wrench"></i>
                            </button>
                            <button class="btn-action btn-location" onclick="trackFleet('F004')" title="تتبع الموقع">
                                <i class="fas fa-map-marker-alt"></i>
                            </button>
                        </div>
                    </td>
                `;
            }
        }

        function filterFleet() {
            const searchTerm = document.getElementById('fleetSearch').value.toLowerCase();
            const statusFilter = document.getElementById('fleetStatusFilter').value;
            const typeFilter = document.getElementById('fleetTypeFilter').value;
            
            const table = document.getElementById('fleetTable');
            const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
            
            for (let row of rows) {
                const cells = row.getElementsByTagName('td');
                if (cells.length > 0) {
                    const fleetName = cells[0].textContent.toLowerCase();
                    const fleetStatus = cells[2].textContent;
                    const fleetType = cells[1].textContent;
                    
                    const matchesSearch = fleetName.includes(searchTerm);
                    const matchesStatus = !statusFilter || fleetStatus.includes(statusFilter);
                    const matchesType = !typeFilter || fleetType.includes(typeFilter);
                    
                    if (matchesSearch && matchesStatus && matchesType) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                }
            }
        }

        function resetFleetFilters() {
            document.getElementById('fleetSearch').value = '';
            document.getElementById('fleetStatusFilter').value = '';
            document.getElementById('fleetTypeFilter').value = '';
            filterFleet();
        }

        // Reports and Analytics Functions
        function updateReportFilters() {
            const reportType = document.getElementById('reportType').value;
            
            // Hide all reports
            const allReports = document.querySelectorAll('.reports-dashboard');
            allReports.forEach(report => {
                report.style.display = 'none';
            });
            
            // Show selected report
            const selectedReport = document.getElementById(reportType + 'Report');
            if (selectedReport) {
                selectedReport.style.display = 'block';
            }
            
            // Update custom date range visibility
            const dateRange = document.getElementById('dateRange').value;
            const customDateRange = document.getElementById('customDateRange');
            const customDateRange2 = document.getElementById('customDateRange2');
            
            if (dateRange === 'custom') {
                customDateRange.style.display = 'block';
                customDateRange2.style.display = 'block';
            } else {
                customDateRange.style.display = 'none';
                customDateRange2.style.display = 'none';
            }
        }

        function updateReportData() {
            const reportType = document.getElementById('reportType').value;
            const dateRange = document.getElementById('dateRange').value;
            
            // Show loading state
            const refreshBtn = document.querySelector('.btn-secondary');
            const originalText = refreshBtn.innerHTML;
            refreshBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري التحديث...';
            refreshBtn.disabled = true;
            
            // Simulate data loading
            setTimeout(() => {
                // Update report data based on type and date range
                updateReportContent(reportType, dateRange);
                
                // Reset button
                refreshBtn.innerHTML = originalText;
                refreshBtn.disabled = false;
                
                // Show success message
                // Report updated successfully
            }, 1500);
        }

        function updateReportContent(reportType, dateRange) {
            // This function would update the report content based on the selected type and date range
            // In a real application, this would make API calls to fetch data
            
            const reportData = {
                overview: {
                    totalBookings: Math.floor(Math.random() * 2000) + 1000,
                    completedTrips: Math.floor(Math.random() * 1500) + 500,
                    totalRevenue: Math.floor(Math.random() * 500000) + 200000,
                    newCustomers: Math.floor(Math.random() * 500) + 200
                },
                bookings: {
                    totalBookings: Math.floor(Math.random() * 2000) + 1000,
                    confirmedBookings: Math.floor(Math.random() * 1800) + 800,
                    pendingBookings: Math.floor(Math.random() * 200) + 50,
                    cancellationRate: (Math.random() * 10 + 5).toFixed(1)
                },
                revenue: {
                    ticketRevenue: Math.floor(Math.random() * 300000) + 150000,
                    additionalFees: Math.floor(Math.random() * 50000) + 20000,
                    otherServices: Math.floor(Math.random() * 30000) + 10000
                },
                fleet: {
                    totalVehicles: Math.floor(Math.random() * 30) + 20,
                    activeVehicles: Math.floor(Math.random() * 25) + 15,
                    maintenanceVehicles: Math.floor(Math.random() * 8) + 2,
                    outOfServiceVehicles: Math.floor(Math.random() * 5) + 1
                }
            };
            
            // Update the display based on report type
            if (reportType === 'overview') {
                updateOverviewStats(reportData.overview);
            } else if (reportType === 'bookings') {
                updateBookingsStats(reportData.bookings);
            } else if (reportType === 'revenue') {
                updateRevenueStats(reportData.revenue);
            } else if (reportType === 'fleet') {
                updateFleetStats(reportData.fleet);
            }
        }

        function updateOverviewStats(data) {
            // Update overview statistics
            const statCards = document.querySelectorAll('.stat-card');
            if (statCards.length >= 4) {
                statCards[0].querySelector('.stat-number').textContent = data.totalBookings.toLocaleString();
                statCards[1].querySelector('.stat-number').textContent = data.completedTrips.toLocaleString();
                statCards[2].querySelector('.stat-number').textContent = data.totalRevenue.toLocaleString() + ' ريال';
                statCards[3].querySelector('.stat-number').textContent = data.newCustomers.toLocaleString();
            }
        }

        function updateBookingsStats(data) {
            // Update bookings report statistics
            const reportStats = document.querySelectorAll('#bookingsReport .report-stat');
            if (reportStats.length >= 4) {
                reportStats[0].querySelector('.stat-value').textContent = data.totalBookings.toLocaleString();
                reportStats[1].querySelector('.stat-value').textContent = data.confirmedBookings.toLocaleString();
                reportStats[2].querySelector('.stat-value').textContent = data.pendingBookings.toLocaleString();
                reportStats[3].querySelector('.stat-value').textContent = data.cancellationRate + '%';
            }
        }

        function updateRevenueStats(data) {
            // Update revenue report statistics
            const revenueItems = document.querySelectorAll('#revenueReport .revenue-item');
            if (revenueItems.length >= 3) {
                revenueItems[0].querySelector('.revenue-amount').textContent = data.ticketRevenue.toLocaleString() + ' ريال';
                revenueItems[1].querySelector('.revenue-amount').textContent = data.additionalFees.toLocaleString() + ' ريال';
                revenueItems[2].querySelector('.revenue-amount').textContent = data.otherServices.toLocaleString() + ' ريال';
            }
        }

        function updateFleetStats(data) {
            // Update fleet report statistics
            const fleetStats = document.querySelectorAll('#fleetReport .fleet-stat');
            if (fleetStats.length >= 4) {
                fleetStats[0].querySelector('.stat-value').textContent = data.totalVehicles;
                fleetStats[1].querySelector('.stat-value').textContent = data.activeVehicles;
                fleetStats[2].querySelector('.stat-value').textContent = data.maintenanceVehicles;
                fleetStats[3].querySelector('.stat-value').textContent = data.outOfServiceVehicles;
            }
        }

        function refreshReportData() {
            const reportType = document.getElementById('reportType').value;
            const dateRange = document.getElementById('dateRange').value;
            updateReportData();
        }

        function generateReport() {
            const reportType = document.getElementById('reportType').value;
            const dateRange = document.getElementById('dateRange').value;
            
            // Show loading state
            const exportBtn = document.querySelector('.btn-primary');
            const originalText = exportBtn.innerHTML;
            exportBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري التصدير...';
            exportBtn.disabled = true;
            
            // Simulate report generation
            setTimeout(() => {
                // Reset button
                exportBtn.innerHTML = originalText;
                exportBtn.disabled = false;
                
                // Show success message
                alert(`تم تصدير تقرير ${reportType} بنجاح!`);
                
                // In a real application, this would download the report file
                // Report generated successfully
            }, 2000);
        }

        // Initialize reports when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Set default date range
            const today = new Date();
            const startOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
            const endOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);
            
            document.getElementById('startDate').value = startOfMonth.toISOString().split('T')[0];
            document.getElementById('endDate').value = endOfMonth.toISOString().split('T')[0];
            
            // Initialize report filters
            updateReportFilters();
        });

        // Settings Functions
        function showSettingsTab(tabName) {
            // Hide all tab contents
            const allTabs = document.querySelectorAll('.settings-tab-content');
            allTabs.forEach(tab => {
                tab.style.display = 'none';
            });
            
            // Remove active class from all tab buttons
            const allTabBtns = document.querySelectorAll('.tab-btn');
            allTabBtns.forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab content
            const selectedTab = document.getElementById(tabName + 'Settings');
            if (selectedTab) {
                selectedTab.style.display = 'block';
            }
            
            // Add active class to clicked tab button
            const clickedBtn = document.querySelector(`[onclick="showSettingsTab('${tabName}')"]`);
            if (clickedBtn) {
                clickedBtn.classList.add('active');
            }
        }

        function saveAllSettings() {
            // Show loading state
            const saveBtn = document.querySelector('.btn-primary');
            const originalText = saveBtn.innerHTML;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري الحفظ...';
            saveBtn.disabled = true;
            
            // Collect all settings
            const settings = {
                general: {
                    siteName: document.getElementById('siteName').value,
                    siteLanguage: document.getElementById('siteLanguage').value,
                    timezone: document.getElementById('timezone').value,
                    currency: document.getElementById('currency').value,
                    dateFormat: document.getElementById('dateFormat').value,
                    timeFormat: document.getElementById('timeFormat').value
                },
                company: {
                    companyName: document.getElementById('companyName').value,
                    companyEmail: document.getElementById('companyEmail').value,
                    companyPhone: document.getElementById('companyPhone').value,
                    companyAddress: document.getElementById('companyAddress').value,
                    companyWebsite: document.getElementById('companyWebsite').value,
                    companyLogo: document.getElementById('companyLogo').files[0]?.name || 'No file selected'
                },
                pricing: {
                    basePrice: document.getElementById('basePrice').value,
                    taxRate: document.getElementById('taxRate').value,
                    serviceFee: document.getElementById('serviceFee').value,
                    cancellationFee: document.getElementById('cancellationFee').value,
                    discountRate: document.getElementById('discountRate').value,
                    minimumBooking: document.getElementById('minimumBooking').value
                },
                notifications: {
                    emailNotifications: document.getElementById('emailNotifications').checked,
                    smsNotifications: document.getElementById('smsNotifications').checked,
                    pushNotifications: document.getElementById('pushNotifications').checked,
                    bookingNotifications: document.getElementById('bookingNotifications').checked,
                    paymentNotifications: document.getElementById('paymentNotifications').checked,
                    maintenanceNotifications: document.getElementById('maintenanceNotifications').checked
                },
                security: {
                    sessionTimeout: document.getElementById('sessionTimeout').value,
                    maxLoginAttempts: document.getElementById('maxLoginAttempts').value,
                    passwordExpiry: document.getElementById('passwordExpiry').value,
                    twoFactorAuth: document.getElementById('twoFactorAuth').checked,
                    ipWhitelist: document.getElementById('ipWhitelist').value,
                    auditLog: document.getElementById('auditLog').checked
                },
                backup: {
                    autoBackup: document.getElementById('autoBackup').checked,
                    backupFrequency: document.getElementById('backupFrequency').value,
                    backupRetention: document.getElementById('backupRetention').value,
                    backupLocation: document.getElementById('backupLocation').value,
                    encryptBackup: document.getElementById('encryptBackup').checked,
                    cloudBackup: document.getElementById('cloudBackup').checked
                }
            };
            
            // Simulate API call
            setTimeout(() => {
                // Reset button
                saveBtn.innerHTML = originalText;
                saveBtn.disabled = false;
                
                // Show success message
                alert('تم حفظ جميع الإعدادات بنجاح!');
                
                // Log settings (in real app, this would be sent to server)
                // Settings saved successfully
                
                // Show success animation
                saveBtn.style.background = 'linear-gradient(135deg, var(--success-color), #10b981)';
                setTimeout(() => {
                    saveBtn.style.background = '';
                }, 2000);
            }, 1500);
        }

        function resetSettings() {
            if (confirm('هل أنت متأكد من إعادة تعيين جميع الإعدادات إلى القيم الافتراضية؟')) {
                // Reset all form fields to default values
                document.getElementById('siteName').value = 'نورث وست باص';
                document.getElementById('siteLanguage').value = 'ar';
                document.getElementById('timezone').value = 'Asia/Riyadh';
                document.getElementById('currency').value = 'SAR';
                document.getElementById('dateFormat').value = 'dd/mm/yyyy';
                document.getElementById('timeFormat').value = '12';
                
                // Reset company settings
                document.getElementById('companyName').value = 'نورث وست باص';
                document.getElementById('companyEmail').value = 'info@northwestbus.com';
                document.getElementById('companyPhone').value = '+966501234567';
                document.getElementById('companyAddress').value = 'الرياض، المملكة العربية السعودية';
                document.getElementById('companyWebsite').value = 'https://northwestbus.com';
                
                // Reset pricing settings
                document.getElementById('basePrice').value = '2.5';
                document.getElementById('taxRate').value = '15';
                document.getElementById('serviceFee').value = '10';
                document.getElementById('cancellationFee').value = '20';
                document.getElementById('discountRate').value = '5';
                document.getElementById('minimumBooking').value = '50';
                
                // Reset notification settings
                document.getElementById('emailNotifications').checked = true;
                document.getElementById('smsNotifications').checked = true;
                document.getElementById('pushNotifications').checked = true;
                document.getElementById('bookingNotifications').checked = true;
                document.getElementById('paymentNotifications').checked = true;
                document.getElementById('maintenanceNotifications').checked = true;
                
                // Reset security settings
                document.getElementById('sessionTimeout').value = '30';
                document.getElementById('maxLoginAttempts').value = '5';
                document.getElementById('passwordExpiry').value = '90';
                document.getElementById('twoFactorAuth').checked = false;
                document.getElementById('ipWhitelist').value = '';
                document.getElementById('auditLog').checked = true;
                
                // Reset backup settings
                document.getElementById('autoBackup').checked = true;
                document.getElementById('backupFrequency').value = 'daily';
                document.getElementById('backupRetention').value = '30';
                document.getElementById('backupLocation').value = '/backups/';
                document.getElementById('encryptBackup').checked = true;
                document.getElementById('cloudBackup').checked = false;
                
                alert('تم إعادة تعيين جميع الإعدادات إلى القيم الافتراضية!');
            }
        }

        function exportSettings() {
            const settings = {
                general: {
                    siteName: document.getElementById('siteName').value,
                    siteLanguage: document.getElementById('siteLanguage').value,
                    timezone: document.getElementById('timezone').value,
                    currency: document.getElementById('currency').value,
                    dateFormat: document.getElementById('dateFormat').value,
                    timeFormat: document.getElementById('timeFormat').value
                },
                company: {
                    companyName: document.getElementById('companyName').value,
                    companyEmail: document.getElementById('companyEmail').value,
                    companyPhone: document.getElementById('companyPhone').value,
                    companyAddress: document.getElementById('companyAddress').value,
                    companyWebsite: document.getElementById('companyWebsite').value
                },
                pricing: {
                    basePrice: document.getElementById('basePrice').value,
                    taxRate: document.getElementById('taxRate').value,
                    serviceFee: document.getElementById('serviceFee').value,
                    cancellationFee: document.getElementById('cancellationFee').value,
                    discountRate: document.getElementById('discountRate').value,
                    minimumBooking: document.getElementById('minimumBooking').value
                }
            };
            
            // Create and download JSON file
            const dataStr = JSON.stringify(settings, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'northwest-bus-settings.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            alert('تم تصدير الإعدادات بنجاح!');
        }

        function importSettings() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const settings = JSON.parse(e.target.result);
                            
                            // Apply imported settings
                            if (settings.general) {
                                document.getElementById('siteName').value = settings.general.siteName || '';
                                document.getElementById('siteLanguage').value = settings.general.siteLanguage || 'ar';
                                document.getElementById('timezone').value = settings.general.timezone || 'Asia/Riyadh';
                                document.getElementById('currency').value = settings.general.currency || 'SAR';
                                document.getElementById('dateFormat').value = settings.general.dateFormat || 'dd/mm/yyyy';
                                document.getElementById('timeFormat').value = settings.general.timeFormat || '12';
                            }
                            
                            if (settings.company) {
                                document.getElementById('companyName').value = settings.company.companyName || '';
                                document.getElementById('companyEmail').value = settings.company.companyEmail || '';
                                document.getElementById('companyPhone').value = settings.company.companyPhone || '';
                                document.getElementById('companyAddress').value = settings.company.companyAddress || '';
                                document.getElementById('companyWebsite').value = settings.company.companyWebsite || '';
                            }
                            
                            if (settings.pricing) {
                                document.getElementById('basePrice').value = settings.pricing.basePrice || '2.5';
                                document.getElementById('taxRate').value = settings.pricing.taxRate || '15';
                                document.getElementById('serviceFee').value = settings.pricing.serviceFee || '10';
                                document.getElementById('cancellationFee').value = settings.pricing.cancellationFee || '20';
                                document.getElementById('discountRate').value = settings.pricing.discountRate || '5';
                                document.getElementById('minimumBooking').value = settings.pricing.minimumBooking || '50';
                            }
                            
                            alert('تم استيراد الإعدادات بنجاح!');
                        } catch (error) {
                            alert('خطأ في قراءة الملف. تأكد من أن الملف صحيح.');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        // Booking Management Functions
        function viewBooking(bookingId) {
            // Remove any existing modals first
            const existingModals = document.querySelectorAll('.modal');
            existingModals.forEach(modal => modal.remove());
            
            // Create booking details modal
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.style.position = 'fixed';
            modal.style.top = '0';
            modal.style.left = '0';
            modal.style.width = '100%';
            modal.style.height = '100%';
            modal.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
            modal.style.zIndex = '9999';
            modal.style.display = 'flex';
            modal.style.alignItems = 'center';
            modal.style.justifyContent = 'center';
            modal.innerHTML = `
                <div class="modal-content booking-details-modal">
                    <div class="modal-header">
                        <h3><i class="fas fa-ticket-alt"></i> تفاصيل الحجز ${bookingId}</h3>
                        <span class="close" onclick="this.closest('.modal').remove()">&times;</span>
                    </div>
                    <div class="modal-body">
                        <div class="booking-details-container">
                            <!-- Booking Header -->
                            <div class="booking-header-section">
                                <div class="booking-id-section">
                                    <div class="booking-id-badge">
                                        <i class="fas fa-hashtag"></i>
                                        ${bookingId}
                                    </div>
                                    <div class="booking-status-badge">
                                        <span class="status-badge status-confirmed">
                                            <i class="fas fa-check-circle"></i>
                                            مؤكد
                                        </span>
                                    </div>
                                </div>
                                <div class="booking-date-time">
                                    <div class="date-info">
                                        <i class="fas fa-calendar"></i>
                                        <span>25 ديسمبر 2024</span>
                                    </div>
                                    <div class="time-info">
                                        <i class="fas fa-clock"></i>
                                        <span>08:00 ص</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Route Information -->
                            <div class="route-section">
                                <h4><i class="fas fa-route"></i> معلومات الرحلة</h4>
                                <div class="route-card">
                                    <div class="route-from">
                                        <div class="city-info">
                                            <div class="city-name">جدة</div>
                                            <div class="city-details">محطة الحجاز</div>
                                        </div>
                                        <div class="route-icon">
                                            <i class="fas fa-arrow-left"></i>
                                        </div>
                                    </div>
                                    <div class="route-to">
                                        <div class="city-info">
                                            <div class="city-name">الرياض</div>
                                            <div class="city-details">محطة النقل الجماعي</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Customer Information -->
                            <div class="customer-section">
                                <h4><i class="fas fa-user"></i> معلومات العميل</h4>
                                <div class="customer-card">
                                    <div class="customer-avatar-large">
                                        <i class="fas fa-user"></i>
                                    </div>
                                    <div class="customer-details">
                                        <div class="customer-name">أحمد محمد</div>
                                        <div class="customer-contact">
                                            <div class="contact-item">
                                                <i class="fas fa-envelope"></i>
                                                <span>ahmed@email.com</span>
                                            </div>
                                            <div class="contact-item">
                                                <i class="fas fa-phone"></i>
                                                <span>+966501234567</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Booking Details -->
                            <div class="booking-info-section">
                                <h4><i class="fas fa-info-circle"></i> تفاصيل الحجز</h4>
                                <div class="info-grid">
                                    <div class="info-item">
                                        <div class="info-label">
                                            <i class="fas fa-users"></i>
                                            عدد المقاعد
                                        </div>
                                        <div class="info-value">2 مقعد</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">
                                            <i class="fas fa-money-bill-wave"></i>
                                            المبلغ الإجمالي
                                        </div>
                                        <div class="info-value price">240 ريال</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">
                                            <i class="fas fa-credit-card"></i>
                                            طريقة الدفع
                                        </div>
                                        <div class="info-value">بطاقة ائتمان</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">
                                            <i class="fas fa-bus"></i>
                                            نوع الباص
                                        </div>
                                        <div class="info-value">VIP</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Payment Summary -->
                            <div class="payment-summary">
                                <h4><i class="fas fa-receipt"></i> ملخص الدفع</h4>
                                <div class="payment-breakdown">
                                    <div class="payment-item">
                                        <span>سعر التذكرة (2 × 120 ريال)</span>
                                        <span>240 ريال</span>
                                    </div>
                                    <div class="payment-item">
                                        <span>رسوم الخدمة</span>
                                        <span>5 ريال</span>
                                    </div>
                                    <div class="payment-item">
                                        <span>ضريبة القيمة المضافة (15%)</span>
                                        <span>36 ريال</span>
                                    </div>
                                    <div class="payment-total">
                                        <span>المجموع</span>
                                        <span>281 ريال</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">
                            <i class="fas fa-times"></i> إغلاق
                        </button>
                        <button class="btn btn-warning" onclick="downloadBooking('${bookingId}')">
                            <i class="fas fa-download"></i> تحميل التذكرة
                        </button>
                        <button class="btn btn-primary" onclick="editBooking('${bookingId}')">
                            <i class="fas fa-edit"></i> تعديل الحجز
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
            
            // Close modal with Escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    modal.remove();
                }
            });
        }

        function editBooking(bookingId) {
            // Remove any existing modals first
            const existingModals = document.querySelectorAll('.modal');
            existingModals.forEach(modal => modal.remove());
            
            // Create edit booking modal
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.style.position = 'fixed';
            modal.style.top = '0';
            modal.style.left = '0';
            modal.style.width = '100%';
            modal.style.height = '100%';
            modal.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
            modal.style.zIndex = '9999';
            modal.style.display = 'flex';
            modal.style.alignItems = 'center';
            modal.style.justifyContent = 'center';
            
            modal.innerHTML = `
                <div class="modal-content edit-booking-modal">
                    <div class="modal-header">
                        <h3><i class="fas fa-edit"></i> تعديل الحجز ${bookingId}</h3>
                        <span class="close" onclick="this.closest('.modal').remove()">&times;</span>
                    </div>
                    <div class="modal-body">
                        <form id="editBookingForm" class="edit-booking-form">
                            <!-- Customer Information -->
                            <div class="form-section">
                                <h4><i class="fas fa-user"></i> معلومات العميل</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="editCustomerName">اسم العميل</label>
                                        <input type="text" id="editCustomerName" value="أحمد محمد" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="editCustomerEmail">البريد الإلكتروني</label>
                                        <input type="email" id="editCustomerEmail" value="ahmed@email.com" required>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="editCustomerPhone">رقم الهاتف</label>
                                        <input type="tel" id="editCustomerPhone" value="+966501234567" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="editCustomerId">رقم هوية العميل</label>
                                        <input type="text" id="editCustomerId" value="1234567890">
                                    </div>
                                </div>
                            </div>

                            <!-- Trip Information -->
                            <div class="form-section">
                                <h4><i class="fas fa-route"></i> معلومات الرحلة</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="editFromCity">من</label>
                                        <select id="editFromCity" required>
                                            <option value="جدة" selected>جدة</option>
                                            <option value="الرياض">الرياض</option>
                                            <option value="الدمام">الدمام</option>
                                            <option value="المدينة">المدينة</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="editToCity">إلى</label>
                                        <select id="editToCity" required>
                                            <option value="الرياض" selected>الرياض</option>
                                            <option value="جدة">جدة</option>
                                            <option value="الدمام">الدمام</option>
                                            <option value="المدينة">المدينة</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="editTripDate">تاريخ الرحلة</label>
                                        <input type="date" id="editTripDate" value="2024-12-25" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="editTripTime">وقت الرحلة</label>
                                        <input type="time" id="editTripTime" value="08:00" required>
                                    </div>
                                </div>
                            </div>

                            <!-- Booking Details -->
                            <div class="form-section">
                                <h4><i class="fas fa-ticket-alt"></i> تفاصيل الحجز</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="editSeats">عدد المقاعد</label>
                                        <input type="number" id="editSeats" value="2" min="1" max="10" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="editBusType">نوع الباص</label>
                                        <select id="editBusType" required>
                                            <option value="VIP" selected>VIP</option>
                                            <option value="عادي">عادي</option>
                                            <option value="فاخر">فاخر</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="editPrice">السعر لكل مقعد</label>
                                        <input type="number" id="editPrice" value="120" min="0" step="0.01" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="editTotalPrice">المبلغ الإجمالي</label>
                                        <input type="number" id="editTotalPrice" value="240" min="0" step="0.01" readonly>
                                    </div>
                                </div>
                            </div>

                            <!-- Payment Information -->
                            <div class="form-section">
                                <h4><i class="fas fa-credit-card"></i> معلومات الدفع</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="editPaymentMethod">طريقة الدفع</label>
                                        <select id="editPaymentMethod" required>
                                            <option value="بطاقة ائتمان" selected>بطاقة ائتمان</option>
                                            <option value="STC Pay">STC Pay</option>
                                            <option value="Apple Pay">Apple Pay</option>
                                            <option value="نقداً">نقداً</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="editBookingStatus">حالة الحجز</label>
                                        <select id="editBookingStatus" required>
                                            <option value="مؤكد" selected>مؤكد</option>
                                            <option value="في الانتظار">في الانتظار</option>
                                            <option value="ملغي">ملغي</option>
                                            <option value="مكتمل">مكتمل</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Notes -->
                            <div class="form-section">
                                <h4><i class="fas fa-sticky-note"></i> ملاحظات إضافية</h4>
                                <div class="form-group">
                                    <label for="editNotes">ملاحظات</label>
                                    <textarea id="editNotes" rows="3" placeholder="أي ملاحظات إضافية..."></textarea>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">
                            <i class="fas fa-times"></i> إلغاء
                        </button>
                        <button class="btn btn-primary" onclick="saveBookingChanges('${bookingId}')">
                            <i class="fas fa-save"></i> حفظ التغييرات
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Auto-calculate total price when seats or price changes
            document.getElementById('editSeats').addEventListener('input', calculateTotalPrice);
            document.getElementById('editPrice').addEventListener('input', calculateTotalPrice);
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
            
            // Close modal with Escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    modal.remove();
                }
            });
        }

        function calculateTotalPrice() {
            const seats = parseInt(document.getElementById('editSeats').value) || 0;
            const price = parseFloat(document.getElementById('editPrice').value) || 0;
            const total = seats * price;
            document.getElementById('editTotalPrice').value = total.toFixed(2);
        }

        function saveBookingChanges(bookingId) {
            // Get form data
            const formData = {
                customerName: document.getElementById('editCustomerName').value,
                customerEmail: document.getElementById('editCustomerEmail').value,
                customerPhone: document.getElementById('editCustomerPhone').value,
                customerId: document.getElementById('editCustomerId').value,
                fromCity: document.getElementById('editFromCity').value,
                toCity: document.getElementById('editToCity').value,
                tripDate: document.getElementById('editTripDate').value,
                tripTime: document.getElementById('editTripTime').value,
                seats: document.getElementById('editSeats').value,
                busType: document.getElementById('editBusType').value,
                price: document.getElementById('editPrice').value,
                totalPrice: document.getElementById('editTotalPrice').value,
                paymentMethod: document.getElementById('editPaymentMethod').value,
                status: document.getElementById('editBookingStatus').value,
                notes: document.getElementById('editNotes').value
            };

            // Validate form
            if (!formData.customerName || !formData.customerEmail || !formData.customerPhone) {
                alert('يرجى ملء جميع الحقول المطلوبة');
                return;
            }

            // Show loading
            const saveBtn = document.querySelector('.btn-primary');
            const originalText = saveBtn.innerHTML;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري الحفظ...';
            saveBtn.disabled = true;

            // Simulate API call
            setTimeout(() => {
                // Show success message
                alert(`تم تحديث الحجز ${bookingId} بنجاح!`);
                
                // Close modal
                document.querySelector('.modal').remove();
                
                // Refresh bookings table (in real app, this would reload data)
                // Booking updated successfully
            }, 1500);
        }

        function cancelBooking(bookingId) {
            if (confirm(`هل أنت متأكد من إلغاء الحجز ${bookingId}؟`)) {
                alert(`تم إلغاء الحجز ${bookingId} بنجاح`);
                // Update booking status in table
                updateBookingStatus(bookingId, 'cancelled');
            }
        }

        function confirmBooking(bookingId) {
            if (confirm(`هل تريد تأكيد الحجز ${bookingId}؟`)) {
                alert(`تم تأكيد الحجز ${bookingId} بنجاح`);
                // Update booking status in table
                updateBookingStatus(bookingId, 'confirmed');
            }
        }

        function downloadBooking(bookingId) {
            alert(`تحميل تذكرة الحجز ${bookingId}`);
        }

        function exportBookings() {
            alert('تصدير بيانات الحجوزات إلى Excel');
        }

        function refreshBookings() {
            alert('تحديث بيانات الحجوزات...');
            // Simulate refresh
            setTimeout(() => {
                alert('تم تحديث البيانات بنجاح');
            }, 1000);
        }

        function filterBookings() {
            const searchTerm = document.getElementById('bookingSearch').value.toLowerCase();
            const statusFilter = document.getElementById('bookingStatus').value;
            const dateFilter = document.getElementById('bookingDate').value;
            const tripTypeFilter = document.getElementById('tripTypeFilter').value;
            
            const table = document.getElementById('bookingsTable');
            const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
            
            for (let i = 0; i < rows.length; i++) {
                const row = rows[i];
                const bookingNumber = row.cells[0].textContent.toLowerCase();
                const customerName = row.cells[1].textContent.toLowerCase();
                const route = row.cells[2].textContent.toLowerCase();
                const date = row.cells[3].textContent;
                const status = row.cells[7].textContent.toLowerCase();
                
                let show = true;
                
                // Search filter
                if (searchTerm && !bookingNumber.includes(searchTerm) && !customerName.includes(searchTerm)) {
                    show = false;
                }
                
                // Status filter
                if (statusFilter && !status.includes(statusFilter)) {
                    show = false;
                }
                
                // Date filter
                if (dateFilter && !date.includes(dateFilter)) {
                    show = false;
                }
                
                row.style.display = show ? '' : 'none';
            }
        }

        function resetBookingFilters() {
            document.getElementById('bookingSearch').value = '';
            document.getElementById('bookingStatus').value = '';
            document.getElementById('bookingDate').value = '';
            document.getElementById('tripTypeFilter').value = '';
            filterBookings();
        }

        function updateBookingStatus(bookingId, newStatus) {
            // Find the booking row and update its status
            const table = document.getElementById('bookingsTable');
            const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
            
            for (let i = 0; i < rows.length; i++) {
                const row = rows[i];
                if (row.cells[0].textContent === bookingId) {
                    const statusCell = row.cells[7];
                    const statusBadge = statusCell.querySelector('.status-badge');
                    
                    // Update status badge
                    statusBadge.className = `status-badge status-${newStatus}`;
                    statusBadge.textContent = getStatusText(newStatus);
                    
                    // Update action buttons based on new status
                    updateActionButtons(row, newStatus);
                    break;
                }
            }
        }

        function getStatusText(status) {
            const statusTexts = {
                'confirmed': 'مؤكد',
                'pending': 'في الانتظار',
                'cancelled': 'ملغي',
                'completed': 'مكتمل'
            };
            return statusTexts[status] || status;
        }

        function updateActionButtons(row, status) {
            const actionsCell = row.cells[8];
            const actionButtons = actionsCell.querySelector('.action-buttons');
            
            // Clear existing buttons
            actionButtons.innerHTML = '';
            
            // Add view button
            const viewBtn = document.createElement('button');
            viewBtn.className = 'btn-action btn-view';
            viewBtn.title = 'عرض';
            viewBtn.innerHTML = '<i class="fas fa-eye"></i>';
            viewBtn.onclick = () => viewBooking(row.cells[0].textContent);
            actionButtons.appendChild(viewBtn);
            
            // Add buttons based on status
            if (status === 'pending') {
                const confirmBtn = document.createElement('button');
                confirmBtn.className = 'btn-action btn-confirm';
                confirmBtn.title = 'تأكيد';
                confirmBtn.innerHTML = '<i class="fas fa-check"></i>';
                confirmBtn.onclick = () => confirmBooking(row.cells[0].textContent);
                actionButtons.appendChild(confirmBtn);
            } else if (status === 'confirmed') {
                const cancelBtn = document.createElement('button');
                cancelBtn.className = 'btn-action btn-cancel';
                cancelBtn.title = 'إلغاء';
                cancelBtn.innerHTML = '<i class="fas fa-times"></i>';
                cancelBtn.onclick = () => cancelBooking(row.cells[0].textContent);
                actionButtons.appendChild(cancelBtn);
            } else if (status === 'completed') {
                const downloadBtn = document.createElement('button');
                downloadBtn.className = 'btn-action btn-download';
                downloadBtn.title = 'تحميل';
                downloadBtn.innerHTML = '<i class="fas fa-download"></i>';
                downloadBtn.onclick = () => downloadBooking(row.cells[0].textContent);
                actionButtons.appendChild(downloadBtn);
            }
        }

    </script>
    <script>
        // Simple Dashboard Functions
        function updateCharts() {
            console.log('Charts are already displayed - no update needed');
        }

        function exportChart(chartType) {
            alert(`تم تصدير رسم ${chartType} البياني بنجاح!`);
        }

        // Dashboard smooth operation
        function ensureSmoothOperation() {
            // Remove any loading states
            document.querySelectorAll('.loading').forEach(el => el.remove());
            
            // Ensure all sections are properly initialized
            const sections = ['dashboard', 'bookings', 'trips', 'customers', 'drivers', 'fleet', 'reports', 'settings'];
            sections.forEach(section => {
                const element = document.getElementById(section);
                if (element) {
                    element.style.display = section === 'dashboard' ? 'block' : 'none';
                }
            });
            
            console.log('Dashboard smooth operation ensured');
        }

        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Dashboard loaded successfully');
            ensureSmoothOperation();
        });

        // Also initialize when window loads
        window.addEventListener('load', function() {
            console.log('Dashboard fully loaded');
            ensureSmoothOperation();
        });

        // Advanced Search Functionality
        function performAdvancedSearch() {
            const searchTerm = document.getElementById('globalSearch')?.value || '';
            const searchType = document.getElementById('searchType')?.value || 'all';
            
            if (searchTerm.length < 2) return;
            
            // Show loading
            const searchResults = document.getElementById('searchResults');
            if (searchResults) {
                searchResults.innerHTML = '<div class="search-loading"><i class="fas fa-spinner fa-spin"></i> جاري البحث...</div>';
            }
            
            // Simulate search
            setTimeout(() => {
                const mockResults = [
                    { type: 'booking', id: 'B001', title: 'حجز #B001', description: 'جدة - الرياض' },
                    { type: 'customer', id: 'C001', title: 'أحمد محمد', description: 'عميل نشط' },
                    { type: 'trip', id: 'T001', title: 'رحلة #T001', description: 'الرياض - الدمام' },
                    { type: 'driver', id: 'D001', title: 'سائق #D001', description: 'محمد أحمد' }
                ];
                
                displaySearchResults(mockResults);
            }, 1000);
        }

        function displaySearchResults(results) {
            const searchResults = document.getElementById('searchResults');
            if (!searchResults) return;
            
            if (results.length === 0) {
                searchResults.innerHTML = '<div class="no-results">لا توجد نتائج</div>';
                return;
            }
            
            let html = '<div class="search-results-list">';
            results.forEach(result => {
                html += `
                    <div class="search-result-item" onclick="openResult('${result.type}', '${result.id}')">
                        <div class="result-icon">
                            <i class="fas fa-${getResultIcon(result.type)}"></i>
                        </div>
                        <div class="result-content">
                            <h4>${result.title}</h4>
                            <p>${result.description}</p>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            
            searchResults.innerHTML = html;
        }

        function getResultIcon(type) {
            const icons = {
                'booking': 'ticket-alt',
                'customer': 'user',
                'trip': 'route',
                'driver': 'user-tie',
                'fleet': 'bus'
            };
            return icons[type] || 'file';
        }

        function openResult(type, id) {
            // Navigate to appropriate section
            switch(type) {
                case 'booking':
                    showSection('bookings');
                    viewBooking(id);
                    break;
                case 'customer':
                    showSection('customers');
                    viewCustomer(id);
                    break;
                case 'trip':
                    showSection('trips');
                    viewTrip(id);
                    break;
                case 'driver':
                    showSection('drivers');
                    viewDriver(id);
                    break;
                case 'fleet':
                    showSection('fleet');
                    viewFleet(id);
                    break;
            }
        }

        // Dark Mode Toggle
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDark);
        }

        // Load dark mode preference
        if (localStorage.getItem('darkMode') === 'true') {
            document.body.classList.add('dark-mode');
        }

        // Keyboard Shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 'k':
                        e.preventDefault();
                        document.getElementById('globalSearch')?.focus();
                        break;
                    case 's':
                        e.preventDefault();
                        saveAllSettings();
                        break;
                    case 'n':
                        e.preventDefault();
                        // Add new item based on current section
                        break;
                }
            }
        });

        // Auto-save functionality
        function enableAutoSave() {
            const inputs = document.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                input.addEventListener('change', function() {
                    // Auto-save after 2 seconds of inactivity
                    clearTimeout(this.autoSaveTimeout);
                    this.autoSaveTimeout = setTimeout(() => {
                        // Auto-saving...
                        // Implement auto-save logic
                    }, 2000);
                });
            });
        }

        // Initialize auto-save
        document.addEventListener('DOMContentLoaded', function() {
            enableAutoSave();
        });

        // Advanced Notifications System
        class NotificationSystem {
            constructor() {
                this.notifications = [];
                this.init();
            }

            init() {
                // Create notification container
                this.createNotificationContainer();
                this.loadNotifications();
                this.startRealTimeUpdates();
            }

            createNotificationContainer() {
                const container = document.createElement('div');
                container.id = 'notificationContainer';
                container.className = 'notification-container';
                document.body.appendChild(container);
            }

            loadNotifications() {
                // Simulate loading notifications
                this.notifications = [
                    {
                        id: 1,
                        type: 'success',
                        title: 'حجز جديد',
                        message: 'تم إنشاء حجز جديد #B001',
                        time: new Date(),
                        read: false
                    },
                    {
                        id: 2,
                        type: 'warning',
                        title: 'رحلة متأخرة',
                        message: 'الرحلة #T001 متأخرة بـ 15 دقيقة',
                        time: new Date(Date.now() - 300000),
                        read: false
                    },
                    {
                        id: 3,
                        type: 'info',
                        title: 'تحديث النظام',
                        message: 'تم تحديث النظام بنجاح',
                        time: new Date(Date.now() - 600000),
                        read: true
                    }
                ];
                this.renderNotifications();
            }

            renderNotifications() {
                const container = document.getElementById('notificationContainer');
                if (!container) return;

                const unreadCount = this.notifications.filter(n => !n.read).length;
                this.updateNotificationBadge(unreadCount);

                let html = '<div class="notifications-dropdown">';
                html += '<div class="notifications-header">';
                html += '<h4>الإشعارات</h4>';
                html += '<button onclick="notificationSystem.markAllAsRead()">تحديد الكل كمقروء</button>';
                html += '</div>';

                this.notifications.forEach(notification => {
                    html += this.renderNotification(notification);
                });

                html += '</div>';
                container.innerHTML = html;
            }

            renderNotification(notification) {
                const timeAgo = this.getTimeAgo(notification.time);
                const iconClass = this.getNotificationIcon(notification.type);
                
                return `
                    <div class="notification-item ${notification.read ? 'read' : 'unread'}" 
                         onclick="notificationSystem.markAsRead(${notification.id})">
                        <div class="notification-icon ${notification.type}">
                            <i class="fas fa-${iconClass}"></i>
                        </div>
                        <div class="notification-content">
                            <h5>${notification.title}</h5>
                            <p>${notification.message}</p>
                            <span class="notification-time">${timeAgo}</span>
                        </div>
                        ${!notification.read ? '<div class="unread-dot"></div>' : ''}
                    </div>
                `;
            }

            getNotificationIcon(type) {
                const icons = {
                    'success': 'check-circle',
                    'warning': 'exclamation-triangle',
                    'info': 'info-circle',
                    'error': 'times-circle'
                };
                return icons[type] || 'bell';
            }

            getTimeAgo(date) {
                const now = new Date();
                const diff = now - date;
                const minutes = Math.floor(diff / 60000);
                const hours = Math.floor(diff / 3600000);
                const days = Math.floor(diff / 86400000);

                if (minutes < 1) return 'الآن';
                if (minutes < 60) return `منذ ${minutes} دقيقة`;
                if (hours < 24) return `منذ ${hours} ساعة`;
                return `منذ ${days} يوم`;
            }

            updateNotificationBadge(count) {
                const badge = document.querySelector('.notification-badge');
                if (badge) {
                    badge.textContent = count;
                    badge.style.display = count > 0 ? 'flex' : 'none';
                }
            }

            markAsRead(id) {
                const notification = this.notifications.find(n => n.id === id);
                if (notification) {
                    notification.read = true;
                    this.renderNotifications();
                }
            }

            markAllAsRead() {
                this.notifications.forEach(n => n.read = true);
                this.renderNotifications();
            }

            addNotification(type, title, message) {
                const notification = {
                    id: Date.now(),
                    type,
                    title,
                    message,
                    time: new Date(),
                    read: false
                };
                this.notifications.unshift(notification);
                this.renderNotifications();
            }

            startRealTimeUpdates() {
                // Simulate real-time notifications
                setInterval(() => {
                    if (Math.random() > 0.7) {
                        const types = ['success', 'warning', 'info'];
                        const titles = ['حجز جديد', 'رحلة متأخرة', 'تحديث النظام'];
                        const messages = [
                            'تم إنشاء حجز جديد',
                            'رحلة متأخرة',
                            'تم تحديث النظام'
                        ];
                        
                        const randomIndex = Math.floor(Math.random() * types.length);
                        this.addNotification(
                            types[randomIndex],
                            titles[randomIndex],
                            messages[randomIndex]
                        );
                    }
                }, 30000); // Every 30 seconds
            }
        }

        // Initialize notification system
        let notificationSystem;
        document.addEventListener('DOMContentLoaded', function() {
            notificationSystem = new NotificationSystem();
        });

        // Toggle notifications dropdown
        function toggleNotifications() {
            const container = document.getElementById('notificationContainer');
            if (container) {
                container.classList.toggle('show');
            }
        }

        // Close notifications when clicking outside
        document.addEventListener('click', function(e) {
            const container = document.getElementById('notificationContainer');
            const button = document.querySelector('.notifications button');
            
            if (container && !container.contains(e.target) && !button.contains(e.target)) {
                container.classList.remove('show');
            }
        });

        // Real-time Statistics Updates
        class RealTimeStats {
            constructor() {
                this.stats = {
                    totalBookings: 1156,
                    activeCustomers: 892,
                    totalFleet: 45,
                    totalRevenue: 245000
                };
                this.init();
            }

            init() {
                this.startRealTimeUpdates();
                this.animateStats();
            }

            startRealTimeUpdates() {
                // Update stats every 30 seconds
                setInterval(() => {
                    this.updateStats();
                }, 30000);
            }

            updateStats() {
                // Simulate real-time updates
                const changes = {
                    totalBookings: Math.floor(Math.random() * 10) - 5,
                    activeCustomers: Math.floor(Math.random() * 5) - 2,
                    totalFleet: 0, // Fleet doesn't change often
                    totalRevenue: Math.floor(Math.random() * 5000) - 2500
                };

                // Update stats
                Object.keys(changes).forEach(key => {
                    this.stats[key] += changes[key];
                    this.animateStatCard(key);
                    this.updateStatDisplay(key);
                });
            }

            animateStatCard(statKey) {
                const card = document.querySelector(`[data-stat="${statKey}"]`);
                if (card) {
                    card.classList.add('updating');
                    setTimeout(() => {
                        card.classList.remove('updating');
                    }, 1000);
                }
            }

            updateStatDisplay(statKey) {
                const element = document.getElementById(statKey);
                if (element) {
                    const currentValue = parseInt(element.textContent.replace(/,/g, ''));
                    const newValue = this.stats[statKey];
                    
                    // Animate number change
                    this.animateNumber(element, currentValue, newValue);
                }
            }

            animateNumber(element, start, end) {
                const duration = 1000;
                const startTime = performance.now();
                
                const animate = (currentTime) => {
                    const elapsed = currentTime - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    
                    const current = Math.floor(start + (end - start) * progress);
                    element.textContent = current.toLocaleString('ar-SA');
                    
                    if (progress < 1) {
                        requestAnimationFrame(animate);
                    }
                };
                
                requestAnimationFrame(animate);
            }

            animateStats() {
                // Initial animation on page load
                setTimeout(() => {
                    Object.keys(this.stats).forEach(key => {
                        const element = document.getElementById(key);
                        if (element) {
                            this.animateNumber(element, 0, this.stats[key]);
                        }
                    });
                }, 500);
            }
        }

        // Initialize real-time stats
        let realTimeStats;
        document.addEventListener('DOMContentLoaded', function() {
            realTimeStats = new RealTimeStats();
        });

        // Advanced Performance Monitoring
        class PerformanceMonitor {
            constructor() {
                this.metrics = {
                    pageLoadTime: 0,
                    apiResponseTime: 0,
                    userInteractions: 0,
                    errorCount: 0
                };
                this.init();
            }

            init() {
                this.measurePageLoad();
                this.trackUserInteractions();
                this.monitorErrors();
            }

            measurePageLoad() {
                window.addEventListener('load', () => {
                    this.metrics.pageLoadTime = performance.now();
                    // Page loaded successfully
                });
            }

            trackUserInteractions() {
                document.addEventListener('click', () => {
                    this.metrics.userInteractions++;
                });
            }

            monitorErrors() {
                window.addEventListener('error', () => {
                    this.metrics.errorCount++;
                });
            }

            getPerformanceReport() {
                return {
                    ...this.metrics,
                    timestamp: new Date().toISOString()
                };
            }
        }

        // Initialize performance monitoring
        let performanceMonitor;
        document.addEventListener('DOMContentLoaded', function() {
            performanceMonitor = new PerformanceMonitor();
        });
        // Load customers data
        function loadCustomers() {
            const customers = JSON.parse(localStorage.getItem('customers') || '[]');
            updateCustomerStatistics(customers);
            renderCustomersTable(customers);
        }
        
        // Render customers table with real data
        function renderCustomersTable(customers) {
            const tableBody = document.querySelector('#customersTable tbody');
            if (!tableBody) return;
            
            if (customers.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 2rem; color: #64748b;">
                            <i class="fas fa-users" style="font-size: 2rem; margin-bottom: 1rem; display: block;"></i>
                            <strong>لا توجد عملاء مسجلين حالياً</strong>
                            <br><small>سيتم عرض العملاء عند تسجيلهم</small>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tableBody.innerHTML = customers.map(customer => `
                <tr>
                    <td>
                        <div class="customer-info">
                            <div class="customer-avatar ${customer.status === 'VIP' ? 'vip' : ''}">
                                <i class="fas ${customer.status === 'VIP' ? 'fa-crown' : 'fa-user'}"></i>
                            </div>
                            <div class="customer-details">
                                <strong>${customer.name}</strong>
                                <small>${customer.id}</small>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="contact-info">
                            <div><i class="fas fa-envelope"></i> ${customer.email}</div>
                            <div><i class="fas fa-phone"></i> ${customer.phone}</div>
                            ${customer.whatsapp ? `<div><i class="fab fa-whatsapp"></i> ${customer.whatsapp}</div>` : ''}
                        </div>
                    </td>
                    <td>
                        <div class="address-info">
                            <div><i class="fas fa-map-marker-alt"></i> ${getCityName(customer.city)}</div>
                            ${customer.address ? `<div><i class="fas fa-home"></i> ${customer.address}</div>` : ''}
                        </div>
                    </td>
                    <td>${new Date(customer.registrationDate).toLocaleDateString('ar-SA')}</td>
                    <td><span class="badge">${customer.totalBookings || 0}</span></td>
                    <td><span class="amount">${customer.totalSpent || 0} ريال</span></td>
                    <td><span class="status-badge status-${customer.status === 'VIP' ? 'vip' : 'confirmed'}">${getStatusText(customer.status)}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-action btn-view" onclick="viewCustomer('${customer.id}')" title="عرض التفاصيل">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-action btn-edit" onclick="editCustomer('${customer.id}')" title="تعديل">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-action btn-message" onclick="messageCustomer('${customer.id}')" title="إرسال رسالة">
                                <i class="fas fa-envelope"></i>
                            </button>
                            <button class="btn-action btn-delete" onclick="deleteCustomer('${customer.id}')" title="حذف">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }
        
        function getCityName(cityCode) {
            const cities = {
                'riyadh': 'الرياض',
                'jeddah': 'جدة',
                'makkah': 'مكة المكرمة',
                'madinah': 'المدينة المنورة',
                'dammam': 'الدمام',
                'taif': 'الطائف',
                'tabuk': 'تبوك',
                'yanbu': 'ينبع'
            };
            return cities[cityCode] || cityCode;
        }
        
        function getStatusText(status) {
            const statuses = {
                'active': 'نشط',
                'inactive': 'غير نشط',
                'VIP': 'VIP'
            };
            return statuses[status] || status;
        }
        
        // Update customer statistics
        function updateCustomerStatistics(customers) {
            const totalCustomers = customers.length;
            const vipCustomers = customers.filter(c => c.status === 'VIP').length;
            const activeCustomers = customers.filter(c => c.status === 'active').length;
            const newCustomersThisMonth = customers.filter(c => {
                const registrationDate = new Date(c.registrationDate);
                const currentDate = new Date();
                return registrationDate.getMonth() === currentDate.getMonth() && 
                       registrationDate.getFullYear() === currentDate.getFullYear();
            }).length;
            
            // Update DOM elements
            const totalCustomersEl = document.getElementById('totalCustomers');
            const vipCustomersEl = document.getElementById('vipCustomers');
            const activeCustomersEl = document.getElementById('activeCustomers');
            
            if (totalCustomersEl) totalCustomersEl.textContent = totalCustomers;
            if (vipCustomersEl) vipCustomersEl.textContent = vipCustomers;
            if (activeCustomersEl) activeCustomersEl.textContent = activeCustomers;
        }

        // User Management Functions
        function showAddUserModal() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.style.alignItems = 'center';
            modal.style.justifyContent = 'center';
            
            modal.innerHTML = `
                <div class="modal-content add-user-modal">
                    <div class="modal-header">
                        <h3><i class="fas fa-user-plus"></i> إضافة مستخدم جديد</h3>
                        <button class="close" onclick="this.closest('.modal').remove()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="addUserForm" class="add-user-form">
                            <!-- Personal Information -->
                            <div class="form-section">
                                <div class="form-section-header">
                                    <i class="fas fa-user"></i>
                                    <h4>المعلومات الشخصية</h4>
                                </div>
                                <div class="form-section-content">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="userFullName">الاسم الكامل <span class="required">*</span></label>
                                            <input type="text" id="userFullName" name="fullName" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="userEmail">البريد الإلكتروني <span class="required">*</span></label>
                                            <input type="email" id="userEmail" name="email" required>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="userPhone">رقم الهاتف <span class="required">*</span></label>
                                            <input type="tel" id="userPhone" name="phone" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="userNationalId">رقم الهوية</label>
                                            <input type="text" id="userNationalId" name="nationalId">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- User Role and Permissions -->
                            <div class="form-section">
                                <div class="form-section-header">
                                    <i class="fas fa-user-shield"></i>
                                    <h4>الصلاحيات والمنطقة</h4>
                                </div>
                                <div class="form-section-content">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="userType">نوع المستخدم <span class="required">*</span></label>
                                            <select id="userType" name="userType" required onchange="updatePermissions()">
                                                <option value="">اختر نوع المستخدم</option>
                                                <option value="regional_manager">مدير إقليمي</option>
                                                <option value="station_manager">مدير محطة</option>
                                                <option value="customer_service">خدمة العملاء</option>
                                                <option value="driver_manager">مدير السائقين</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="userRegion">المنطقة المسؤول عنها <span class="required">*</span></label>
                                            <select id="userRegion" name="region" required>
                                                <option value="">اختر المنطقة</option>
                                                <option value="riyadh">الرياض</option>
                                                <option value="jeddah">جدة</option>
                                                <option value="dammam">الدمام</option>
                                                <option value="makkah">مكة المكرمة</option>
                                                <option value="medina">المدينة المنورة</option>
                                                <option value="taif">الطائف</option>
                                                <option value="abha">أبها</option>
                                                <option value="tabuk">تبوك</option>
                                                <option value="hail">حائل</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="userPassword">كلمة المرور <span class="required">*</span></label>
                                            <input type="password" id="userPassword" name="password" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="userConfirmPassword">تأكيد كلمة المرور <span class="required">*</span></label>
                                            <input type="password" id="userConfirmPassword" name="confirmPassword" required>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Permissions -->
                            <div class="form-section">
                                <div class="form-section-header">
                                    <i class="fas fa-key"></i>
                                    <h4>الصلاحيات</h4>
                                </div>
                                <div class="form-section-content">
                                    <div class="permissions-grid">
                                        <div class="permission-group">
                                            <h5>إدارة المستخدمين</h5>
                                            <label class="permission-item">
                                                <input type="checkbox" name="permissions" value="create_users">
                                                <span>إنشاء مستخدمين جدد</span>
                                            </label>
                                            <label class="permission-item">
                                                <input type="checkbox" name="permissions" value="edit_users">
                                                <span>تعديل المستخدمين</span>
                                            </label>
                                            <label class="permission-item">
                                                <input type="checkbox" name="permissions" value="delete_users">
                                                <span>حذف المستخدمين</span>
                                            </label>
                                        </div>
                                        <div class="permission-group">
                                            <h5>إدارة العملاء</h5>
                                            <label class="permission-item">
                                                <input type="checkbox" name="permissions" value="view_customers">
                                                <span>عرض العملاء</span>
                                            </label>
                                            <label class="permission-item">
                                                <input type="checkbox" name="permissions" value="edit_customers">
                                                <span>تعديل بيانات العملاء</span>
                                            </label>
                                        </div>
                                        <div class="permission-group">
                                            <h5>إدارة الرحلات</h5>
                                            <label class="permission-item">
                                                <input type="checkbox" name="permissions" value="view_trips">
                                                <span>عرض الرحلات</span>
                                            </label>
                                            <label class="permission-item">
                                                <input type="checkbox" name="permissions" value="create_trips">
                                                <span>إنشاء رحلات جديدة</span>
                                            </label>
                                            <label class="permission-item">
                                                <input type="checkbox" name="permissions" value="edit_trips">
                                                <span>تعديل الرحلات</span>
                                            </label>
                                        </div>
                                        <div class="permission-group">
                                            <h5>التقارير</h5>
                                            <label class="permission-item">
                                                <input type="checkbox" name="permissions" value="view_reports">
                                                <span>عرض التقارير</span>
                                            </label>
                                            <label class="permission-item">
                                                <input type="checkbox" name="permissions" value="export_reports">
                                                <span>تصدير التقارير</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">إلغاء</button>
                        <button class="btn btn-primary" onclick="addUser()">إضافة المستخدم</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function updatePermissions() {
            const userType = document.getElementById('userType').value;
            const permissions = document.querySelectorAll('input[name="permissions"]');
            
            // Clear all permissions first
            permissions.forEach(permission => {
                permission.checked = false;
            });
            
            // Set default permissions based on user type
            switch(userType) {
                case 'regional_manager':
                    // Regional managers get most permissions
                    permissions.forEach(permission => {
                        if (['view_customers', 'edit_customers', 'view_trips', 'create_trips', 'edit_trips', 'view_reports'].includes(permission.value)) {
                            permission.checked = true;
                        }
                    });
                    break;
                case 'station_manager':
                    // Station managers get limited permissions
                    permissions.forEach(permission => {
                        if (['view_customers', 'view_trips', 'create_trips', 'view_reports'].includes(permission.value)) {
                            permission.checked = true;
                        }
                    });
                    break;
                case 'customer_service':
                    // Customer service gets customer-related permissions
                    permissions.forEach(permission => {
                        if (['view_customers', 'edit_customers', 'view_trips'].includes(permission.value)) {
                            permission.checked = true;
                        }
                    });
                    break;
                case 'driver_manager':
                    // Driver managers get trip and driver permissions
                    permissions.forEach(permission => {
                        if (['view_trips', 'create_trips', 'edit_trips', 'view_reports'].includes(permission.value)) {
                            permission.checked = true;
                        }
                    });
                    break;
            }
        }

        function addUser() {
            try {
                const form = document.getElementById('addUserForm');
                if (!form) {
                    alert('خطأ: لم يتم العثور على النموذج');
                    return;
                }
                
                const formData = new FormData(form);
                
                // Validate form
                const fullName = formData.get('fullName');
                const email = formData.get('email');
                const phone = formData.get('phone');
                const userType = formData.get('userType');
                const region = formData.get('region');
                const password = formData.get('password');
                const confirmPassword = formData.get('confirmPassword');
                
                if (!fullName || !email || !phone || !userType || !region || !password) {
                    alert('يرجى ملء جميع الحقول المطلوبة');
                    return;
                }
                
                if (password !== confirmPassword) {
                    alert('كلمة المرور وتأكيد كلمة المرور غير متطابقين');
                    return;
                }
                
                // Check if email already exists
                const existingUsers = JSON.parse(localStorage.getItem('systemUsers') || '[]');
                const emailExists = existingUsers.some(user => user.email === email);
                if (emailExists) {
                    alert('البريد الإلكتروني مستخدم بالفعل');
                    return;
                }
                
                // Get selected permissions
                const selectedPermissions = [];
                document.querySelectorAll('input[name="permissions"]:checked').forEach(checkbox => {
                    selectedPermissions.push(checkbox.value);
                });
                
                // Get current user info
                const currentUser = JSON.parse(localStorage.getItem('user') || '{}');
                
                // Create new user
                const newUser = {
                    id: 'user_' + Date.now(),
                    fullName: fullName,
                    email: email,
                    phone: phone,
                    nationalId: formData.get('nationalId') || '',
                    userType: userType,
                    region: region,
                    password: password, // In real app, this should be hashed
                    permissions: selectedPermissions,
                    status: 'active',
                    createdAt: new Date().toISOString(),
                    lastLogin: null,
                    createdBy: currentUser.id || 'admin'
                };
                
                // Save user to localStorage
                existingUsers.push(newUser);
                localStorage.setItem('systemUsers', JSON.stringify(existingUsers));
                
                // Show success message
                alert('تم إضافة المستخدم بنجاح');
                
                // Close modal
                const modal = document.querySelector('.modal');
                if (modal) {
                    modal.remove();
                }
                
                // Refresh users table
                loadUsers();
                
            } catch (error) {
                console.error('خطأ في إضافة المستخدم:', error);
                alert('حدث خطأ في إضافة المستخدم. يرجى المحاولة مرة أخرى.');
            }
        }

        function loadUsers() {
            const users = JSON.parse(localStorage.getItem('systemUsers') || '[]');
            const tbody = document.getElementById('usersTableBody');
            
            if (users.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" style="text-align: center; padding: 2rem; color: #64748b;">
                            <i class="fas fa-user-cog" style="font-size: 2rem; margin-bottom: 1rem; display: block;"></i>
                            <strong>لا يوجد مستخدمين مسجلين حالياً</strong>
                            <br><small>سيتم عرض المستخدمين عند إضافتهم</small>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = users.map(user => `
                <tr>
                    <td>
                        <div class="user-info">
                            <div class="user-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="user-details">
                                <strong>${user.fullName}</strong>
                                <small>${user.email}</small>
                            </div>
                        </div>
                    </td>
                    <td>
                        <span class="user-type-badge ${user.userType}">
                            ${getUserTypeLabel(user.userType)}
                        </span>
                    </td>
                    <td>${getRegionLabel(user.region)}</td>
                    <td>${user.email}</td>
                    <td>${user.phone}</td>
                    <td>
                        <span class="status-badge ${user.status}">
                            ${getStatusLabel(user.status)}
                        </span>
                    </td>
                    <td>${formatDate(user.createdAt)}</td>
                    <td>${user.lastLogin ? formatDate(user.lastLogin) : 'لم يسجل دخول'}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm btn-primary" onclick="viewUser('${user.id}')" title="عرض">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-warning" onclick="editUser('${user.id}')" title="تعديل">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteUser('${user.id}')" title="حذف">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function getUserTypeLabel(userType) {
            const labels = {
                'regional_manager': 'مدير إقليمي',
                'station_manager': 'مدير محطة',
                'customer_service': 'خدمة العملاء',
                'driver_manager': 'مدير السائقين'
            };
            return labels[userType] || userType;
        }

        function getRegionLabel(region) {
            const labels = {
                'riyadh': 'الرياض',
                'jeddah': 'جدة',
                'dammam': 'الدمام',
                'makkah': 'مكة المكرمة',
                'medina': 'المدينة المنورة',
                'taif': 'الطائف',
                'abha': 'أبها',
                'tabuk': 'تبوك',
                'hail': 'حائل'
            };
            return labels[region] || region;
        }

        function getStatusLabel(status) {
            const labels = {
                'active': 'نشط',
                'inactive': 'غير نشط',
                'suspended': 'معلق'
            };
            return labels[status] || status;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ar-SA');
        }

        function filterUsers() {
            const searchTerm = document.getElementById('userSearch').value.toLowerCase();
            const regionFilter = document.getElementById('userRegionFilter').value;
            const typeFilter = document.getElementById('userTypeFilter').value;
            const statusFilter = document.getElementById('userStatusFilter').value;
            
            const users = JSON.parse(localStorage.getItem('systemUsers') || '[]');
            const filteredUsers = users.filter(user => {
                const matchesSearch = user.fullName.toLowerCase().includes(searchTerm) || 
                                    user.email.toLowerCase().includes(searchTerm);
                const matchesRegion = !regionFilter || user.region === regionFilter;
                const matchesType = !typeFilter || user.userType === typeFilter;
                const matchesStatus = !statusFilter || user.status === statusFilter;
                
                return matchesSearch && matchesRegion && matchesType && matchesStatus;
            });
            
            // Update table with filtered results
            const tbody = document.getElementById('usersTableBody');
            if (filteredUsers.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" style="text-align: center; padding: 2rem; color: #64748b;">
                            <i class="fas fa-search" style="font-size: 2rem; margin-bottom: 1rem; display: block;"></i>
                            <strong>لا توجد نتائج مطابقة للبحث</strong>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = filteredUsers.map(user => `
                <tr>
                    <td>
                        <div class="user-info">
                            <div class="user-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="user-details">
                                <strong>${user.fullName}</strong>
                                <small>${user.email}</small>
                            </div>
                        </div>
                    </td>
                    <td>
                        <span class="user-type-badge ${user.userType}">
                            ${getUserTypeLabel(user.userType)}
                        </span>
                    </td>
                    <td>${getRegionLabel(user.region)}</td>
                    <td>${user.email}</td>
                    <td>${user.phone}</td>
                    <td>
                        <span class="status-badge ${user.status}">
                            ${getStatusLabel(user.status)}
                        </span>
                    </td>
                    <td>${formatDate(user.createdAt)}</td>
                    <td>${user.lastLogin ? formatDate(user.lastLogin) : 'لم يسجل دخول'}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm btn-primary" onclick="viewUser('${user.id}')" title="عرض">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-warning" onclick="editUser('${user.id}')" title="تعديل">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteUser('${user.id}')" title="حذف">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function resetUserFilters() {
            document.getElementById('userSearch').value = '';
            document.getElementById('userRegionFilter').value = '';
            document.getElementById('userTypeFilter').value = '';
            document.getElementById('userStatusFilter').value = '';
            loadUsers();
        }

        function viewUser(userId) {
            try {
                const users = JSON.parse(localStorage.getItem('systemUsers') || '[]');
                const user = users.find(u => u.id === userId);
                
                if (!user) {
                    alert('المستخدم غير موجود');
                    return;
                }
                
                const modal = document.createElement('div');
                modal.className = 'modal';
                modal.style.display = 'flex';
                modal.style.alignItems = 'center';
                modal.style.justifyContent = 'center';
                
                modal.innerHTML = `
                    <div class="modal-content user-details-modal">
                        <div class="modal-header">
                            <h3><i class="fas fa-user"></i> تفاصيل المستخدم</h3>
                            <button class="close" onclick="this.closest('.modal').remove()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="user-profile">
                                <div class="user-avatar-large">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="user-info-large">
                                    <h2>${user.fullName}</h2>
                                    <p class="user-email">${user.email}</p>
                                    <p class="user-phone">${user.phone}</p>
                                </div>
                            </div>
                            
                            <div class="user-details-grid">
                                <div class="detail-item">
                                    <label>نوع المستخدم:</label>
                                    <span class="user-type-badge ${user.userType}">${getUserTypeLabel(user.userType)}</span>
                                </div>
                                <div class="detail-item">
                                    <label>المنطقة:</label>
                                    <span>${getRegionLabel(user.region)}</span>
                                </div>
                                <div class="detail-item">
                                    <label>الحالة:</label>
                                    <span class="status-badge ${user.status}">${getStatusLabel(user.status)}</span>
                                </div>
                                <div class="detail-item">
                                    <label>رقم الهوية:</label>
                                    <span>${user.nationalId || 'غير محدد'}</span>
                                </div>
                                <div class="detail-item">
                                    <label>تاريخ الإنشاء:</label>
                                    <span>${formatDate(user.createdAt)}</span>
                                </div>
                                <div class="detail-item">
                                    <label>آخر دخول:</label>
                                    <span>${user.lastLogin ? formatDate(user.lastLogin) : 'لم يسجل دخول'}</span>
                                </div>
                                <div class="detail-item">
                                    <label>تم الإنشاء بواسطة:</label>
                                    <span>${user.createdBy || 'غير محدد'}</span>
                                </div>
                                <div class="detail-item">
                                    <label>آخر تحديث:</label>
                                    <span>${user.updatedAt ? formatDate(user.updatedAt) : 'لم يتم التحديث'}</span>
                                </div>
                            </div>
                            
                            <div class="permissions-section">
                                <h4>الصلاحيات</h4>
                                <div class="permissions-list">
                                    ${user.permissions.map(permission => `
                                        <span class="permission-tag">${getPermissionLabel(permission)}</span>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">إغلاق</button>
                            <button class="btn btn-warning" onclick="editUser('${user.id}'); this.closest('.modal').remove();">تعديل</button>
                            <button class="btn btn-danger" onclick="deleteUser('${user.id}'); this.closest('.modal').remove();">حذف</button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
            } catch (error) {
                console.error('خطأ في فتح نافذة عرض المستخدم:', error);
                alert('حدث خطأ في فتح النافذة. يرجى المحاولة مرة أخرى.');
            }
        }

        function getPermissionLabel(permission) {
            const labels = {
                'create_users': 'إنشاء مستخدمين',
                'edit_users': 'تعديل المستخدمين',
                'delete_users': 'حذف المستخدمين',
                'view_customers': 'عرض العملاء',
                'edit_customers': 'تعديل العملاء',
                'view_trips': 'عرض الرحلات',
                'create_trips': 'إنشاء رحلات',
                'edit_trips': 'تعديل الرحلات',
                'view_reports': 'عرض التقارير',
                'export_reports': 'تصدير التقارير'
            };
            return labels[permission] || permission;
        }

        function editUser(userId) {
            try {
                const users = JSON.parse(localStorage.getItem('systemUsers') || '[]');
                const user = users.find(u => u.id === userId);
                
                if (!user) {
                    alert('المستخدم غير موجود');
                    return;
                }
                
                const modal = document.createElement('div');
                modal.className = 'modal';
                modal.style.display = 'flex';
                modal.style.alignItems = 'center';
                modal.style.justifyContent = 'center';
                
                modal.innerHTML = `
                    <div class="modal-content edit-user-modal">
                        <div class="modal-header">
                            <h3><i class="fas fa-user-edit"></i> تعديل المستخدم</h3>
                            <button class="close" onclick="this.closest('.modal').remove()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <form id="editUserForm" class="edit-user-form">
                                <input type="hidden" id="editUserId" value="${user.id}">
                                
                                <!-- Personal Information -->
                                <div class="form-section">
                                    <div class="form-section-header">
                                        <i class="fas fa-user"></i>
                                        <h4>المعلومات الشخصية</h4>
                                    </div>
                                    <div class="form-section-content">
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label for="editUserFullName">الاسم الكامل <span class="required">*</span></label>
                                                <input type="text" id="editUserFullName" name="fullName" value="${user.fullName}" required>
                                            </div>
                                            <div class="form-group">
                                                <label for="editUserEmail">البريد الإلكتروني <span class="required">*</span></label>
                                                <input type="email" id="editUserEmail" name="email" value="${user.email}" required>
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label for="editUserPhone">رقم الهاتف <span class="required">*</span></label>
                                                <input type="tel" id="editUserPhone" name="phone" value="${user.phone}" required>
                                            </div>
                                            <div class="form-group">
                                                <label for="editUserNationalId">رقم الهوية</label>
                                                <input type="text" id="editUserNationalId" name="nationalId" value="${user.nationalId || ''}">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- User Role and Permissions -->
                                <div class="form-section">
                                    <div class="form-section-header">
                                        <i class="fas fa-user-shield"></i>
                                        <h4>الصلاحيات والمنطقة</h4>
                                    </div>
                                    <div class="form-section-content">
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label for="editUserType">نوع المستخدم <span class="required">*</span></label>
                                                <select id="editUserType" name="userType" required onchange="updateEditPermissions()">
                                                    <option value="">اختر نوع المستخدم</option>
                                                    <option value="regional_manager" ${user.userType === 'regional_manager' ? 'selected' : ''}>مدير إقليمي</option>
                                                    <option value="station_manager" ${user.userType === 'station_manager' ? 'selected' : ''}>مدير محطة</option>
                                                    <option value="customer_service" ${user.userType === 'customer_service' ? 'selected' : ''}>خدمة العملاء</option>
                                                    <option value="driver_manager" ${user.userType === 'driver_manager' ? 'selected' : ''}>مدير السائقين</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label for="editUserRegion">المنطقة المسؤول عنها <span class="required">*</span></label>
                                                <select id="editUserRegion" name="region" required>
                                                    <option value="">اختر المنطقة</option>
                                                    <option value="riyadh" ${user.region === 'riyadh' ? 'selected' : ''}>الرياض</option>
                                                    <option value="jeddah" ${user.region === 'jeddah' ? 'selected' : ''}>جدة</option>
                                                    <option value="dammam" ${user.region === 'dammam' ? 'selected' : ''}>الدمام</option>
                                                    <option value="makkah" ${user.region === 'makkah' ? 'selected' : ''}>مكة المكرمة</option>
                                                    <option value="medina" ${user.region === 'medina' ? 'selected' : ''}>المدينة المنورة</option>
                                                    <option value="taif" ${user.region === 'taif' ? 'selected' : ''}>الطائف</option>
                                                    <option value="abha" ${user.region === 'abha' ? 'selected' : ''}>أبها</option>
                                                    <option value="tabuk" ${user.region === 'tabuk' ? 'selected' : ''}>تبوك</option>
                                                    <option value="hail" ${user.region === 'hail' ? 'selected' : ''}>حائل</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label for="editUserStatus">الحالة</label>
                                                <select id="editUserStatus" name="status">
                                                    <option value="active" ${user.status === 'active' ? 'selected' : ''}>نشط</option>
                                                    <option value="inactive" ${user.status === 'inactive' ? 'selected' : ''}>غير نشط</option>
                                                    <option value="suspended" ${user.status === 'suspended' ? 'selected' : ''}>معلق</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label for="editUserPassword">كلمة المرور الجديدة (اتركها فارغة للحفاظ على الكلمة الحالية)</label>
                                                <input type="password" id="editUserPassword" name="password">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Permissions -->
                                <div class="form-section">
                                    <div class="form-section-header">
                                        <i class="fas fa-key"></i>
                                        <h4>الصلاحيات</h4>
                                    </div>
                                    <div class="form-section-content">
                                        <div class="permissions-grid">
                                            <div class="permission-group">
                                                <h5>إدارة المستخدمين</h5>
                                                <label class="permission-item">
                                                    <input type="checkbox" name="editPermissions" value="create_users" ${user.permissions.includes('create_users') ? 'checked' : ''}>
                                                    <span>إنشاء مستخدمين جدد</span>
                                                </label>
                                                <label class="permission-item">
                                                    <input type="checkbox" name="editPermissions" value="edit_users" ${user.permissions.includes('edit_users') ? 'checked' : ''}>
                                                    <span>تعديل المستخدمين</span>
                                                </label>
                                                <label class="permission-item">
                                                    <input type="checkbox" name="editPermissions" value="delete_users" ${user.permissions.includes('delete_users') ? 'checked' : ''}>
                                                    <span>حذف المستخدمين</span>
                                                </label>
                                            </div>
                                            <div class="permission-group">
                                                <h5>إدارة العملاء</h5>
                                                <label class="permission-item">
                                                    <input type="checkbox" name="editPermissions" value="view_customers" ${user.permissions.includes('view_customers') ? 'checked' : ''}>
                                                    <span>عرض العملاء</span>
                                                </label>
                                                <label class="permission-item">
                                                    <input type="checkbox" name="editPermissions" value="edit_customers" ${user.permissions.includes('edit_customers') ? 'checked' : ''}>
                                                    <span>تعديل بيانات العملاء</span>
                                                </label>
                                            </div>
                                            <div class="permission-group">
                                                <h5>إدارة الرحلات</h5>
                                                <label class="permission-item">
                                                    <input type="checkbox" name="editPermissions" value="view_trips" ${user.permissions.includes('view_trips') ? 'checked' : ''}>
                                                    <span>عرض الرحلات</span>
                                                </label>
                                                <label class="permission-item">
                                                    <input type="checkbox" name="editPermissions" value="create_trips" ${user.permissions.includes('create_trips') ? 'checked' : ''}>
                                                    <span>إنشاء رحلات جديدة</span>
                                                </label>
                                                <label class="permission-item">
                                                    <input type="checkbox" name="editPermissions" value="edit_trips" ${user.permissions.includes('edit_trips') ? 'checked' : ''}>
                                                    <span>تعديل الرحلات</span>
                                                </label>
                                            </div>
                                            <div class="permission-group">
                                                <h5>التقارير</h5>
                                                <label class="permission-item">
                                                    <input type="checkbox" name="editPermissions" value="view_reports" ${user.permissions.includes('view_reports') ? 'checked' : ''}>
                                                    <span>عرض التقارير</span>
                                                </label>
                                                <label class="permission-item">
                                                    <input type="checkbox" name="editPermissions" value="export_reports" ${user.permissions.includes('export_reports') ? 'checked' : ''}>
                                                    <span>تصدير التقارير</span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">إلغاء</button>
                            <button class="btn btn-primary" onclick="updateUser()">حفظ التغييرات</button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
            } catch (error) {
                console.error('خطأ في فتح نافذة تعديل المستخدم:', error);
                alert('حدث خطأ في فتح النافذة. يرجى المحاولة مرة أخرى.');
            }
        }

        function updateEditPermissions() {
            const userType = document.getElementById('editUserType').value;
            const permissions = document.querySelectorAll('input[name="editPermissions"]');
            
            // Clear all permissions first
            permissions.forEach(permission => {
                permission.checked = false;
            });
            
            // Set default permissions based on user type
            switch(userType) {
                case 'regional_manager':
                    permissions.forEach(permission => {
                        if (['view_customers', 'edit_customers', 'view_trips', 'create_trips', 'edit_trips', 'view_reports'].includes(permission.value)) {
                            permission.checked = true;
                        }
                    });
                    break;
                case 'station_manager':
                    permissions.forEach(permission => {
                        if (['view_customers', 'view_trips', 'create_trips', 'view_reports'].includes(permission.value)) {
                            permission.checked = true;
                        }
                    });
                    break;
                case 'customer_service':
                    permissions.forEach(permission => {
                        if (['view_customers', 'edit_customers', 'view_trips'].includes(permission.value)) {
                            permission.checked = true;
                        }
                    });
                    break;
                case 'driver_manager':
                    permissions.forEach(permission => {
                        if (['view_trips', 'create_trips', 'edit_trips', 'view_reports'].includes(permission.value)) {
                            permission.checked = true;
                        }
                    });
                    break;
            }
        }

        function updateUser() {
            try {
                const form = document.getElementById('editUserForm');
                if (!form) {
                    alert('خطأ: لم يتم العثور على النموذج');
                    return;
                }
                
                const formData = new FormData(form);
                const userId = formData.get('userId') || document.getElementById('editUserId').value;
                
                // Validate form
                const fullName = formData.get('fullName');
                const email = formData.get('email');
                const phone = formData.get('phone');
                const userType = formData.get('userType');
                const region = formData.get('region');
                
                if (!fullName || !email || !phone || !userType || !region) {
                    alert('يرجى ملء جميع الحقول المطلوبة');
                    return;
                }
                
                // Check if email already exists (excluding current user)
                const existingUsers = JSON.parse(localStorage.getItem('systemUsers') || '[]');
                const emailExists = existingUsers.some(user => user.email === email && user.id !== userId);
                if (emailExists) {
                    alert('البريد الإلكتروني مستخدم بالفعل');
                    return;
                }
                
                // Get selected permissions
                const selectedPermissions = [];
                document.querySelectorAll('input[name="editPermissions"]:checked').forEach(checkbox => {
                    selectedPermissions.push(checkbox.value);
                });
                
                // Update user
                const updatedUsers = existingUsers.map(user => {
                    if (user.id === userId) {
                        const updatedUser = {
                            ...user,
                            fullName: fullName,
                            email: email,
                            phone: phone,
                            nationalId: formData.get('nationalId') || user.nationalId,
                            userType: userType,
                            region: region,
                            status: formData.get('status') || user.status,
                            permissions: selectedPermissions,
                            updatedAt: new Date().toISOString()
                        };
                        
                        // Update password if provided
                        const newPassword = formData.get('password');
                        if (newPassword && newPassword.trim() !== '') {
                            updatedUser.password = newPassword;
                        }
                        
                        return updatedUser;
                    }
                    return user;
                });
                
                localStorage.setItem('systemUsers', JSON.stringify(updatedUsers));
                
                // Show success message
                alert('تم تحديث المستخدم بنجاح');
                
                // Close modal
                const modal = document.querySelector('.modal');
                if (modal) {
                    modal.remove();
                }
                
                // Refresh users table
                loadUsers();
                
            } catch (error) {
                console.error('خطأ في تحديث المستخدم:', error);
                alert('حدث خطأ في تحديث المستخدم. يرجى المحاولة مرة أخرى.');
            }
        }

        function deleteUser(userId) {
            try {
                const users = JSON.parse(localStorage.getItem('systemUsers') || '[]');
                const userToDelete = users.find(user => user.id === userId);
                
                if (!userToDelete) {
                    alert('المستخدم غير موجود');
                    return;
                }
                
                if (confirm(`هل أنت متأكد من حذف المستخدم "${userToDelete.fullName}"؟\nهذا الإجراء لا يمكن التراجع عنه.`)) {
                    const updatedUsers = users.filter(user => user.id !== userId);
                    localStorage.setItem('systemUsers', JSON.stringify(updatedUsers));
                    loadUsers();
                    alert('تم حذف المستخدم بنجاح');
                }
            } catch (error) {
                console.error('خطأ في حذف المستخدم:', error);
                alert('حدث خطأ في حذف المستخدم. يرجى المحاولة مرة أخرى.');
            }
        }
        
        // Initialize customer data on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Clear any existing dummy data and load real customers
            const existingCustomers = JSON.parse(localStorage.getItem('customers') || '[]');
            
            // Remove any dummy customers if they exist
            const realCustomers = existingCustomers.filter(customer => {
                // Remove customers with dummy emails or IDs
                return !customer.email.includes('@email.com') && 
                       !customer.id.startsWith('NW20241220');
            });
            
            // Update localStorage with only real customers
            localStorage.setItem('customers', JSON.stringify(realCustomers));
            
            // Load customers
            loadCustomers();
            
            // Initialize users data
            loadUsers();
            
            // Add sample users if none exist
            addSampleUsers();
        });

        function addSampleUsers() {
            const existingUsers = JSON.parse(localStorage.getItem('systemUsers') || '[]');
            
            if (existingUsers.length === 0) {
                const sampleUsers = [
                    {
                        id: 'user_1703123456789',
                        fullName: 'أحمد محمد العلي',
                        email: 'ahmed.ali@nwbus.sa',
                        phone: '+966501234567',
                        nationalId: '1234567890',
                        userType: 'regional_manager',
                        region: 'riyadh',
                        password: 'admin123',
                        permissions: ['view_customers', 'edit_customers', 'view_trips', 'create_trips', 'edit_trips', 'view_reports'],
                        status: 'active',
                        createdAt: '2024-01-15T10:30:00.000Z',
                        lastLogin: null,
                        createdBy: 'admin'
                    },
                    {
                        id: 'user_1703123456790',
                        fullName: 'فاطمة أحمد السعد',
                        email: 'fatima.saad@nwbus.sa',
                        phone: '+966502345678',
                        nationalId: '0987654321',
                        userType: 'station_manager',
                        region: 'jeddah',
                        password: 'station123',
                        permissions: ['view_customers', 'view_trips', 'create_trips', 'view_reports'],
                        status: 'active',
                        createdAt: '2024-01-16T14:20:00.000Z',
                        lastLogin: null,
                        createdBy: 'admin'
                    },
                    {
                        id: 'user_1703123456791',
                        fullName: 'محمد عبدالله القحطاني',
                        email: 'mohammed.qhtani@nwbus.sa',
                        phone: '+966503456789',
                        nationalId: '1122334455',
                        userType: 'customer_service',
                        region: 'dammam',
                        password: 'service123',
                        permissions: ['view_customers', 'edit_customers', 'view_trips'],
                        status: 'active',
                        createdAt: '2024-01-17T09:15:00.000Z',
                        lastLogin: null,
                        createdBy: 'admin'
                    },
                    {
                        id: 'user_1703123456792',
                        fullName: 'سارة محمد الزهراني',
                        email: 'sara.zahrani@nwbus.sa',
                        phone: '+966504567890',
                        nationalId: '5566778899',
                        userType: 'driver_manager',
                        region: 'hail',
                        password: 'driver123',
                        permissions: ['view_trips', 'create_trips', 'edit_trips', 'view_reports'],
                        status: 'active',
                        createdAt: '2024-01-18T13:45:00.000Z',
                        lastLogin: null,
                        createdBy: 'admin'
                    }
                ];
                
                localStorage.setItem('systemUsers', JSON.stringify(sampleUsers));
                loadUsers();
            }
        }
        
        // Check admin login status
        function checkAdminLogin() {
            const user = localStorage.getItem('user');
            if (!user) {
                window.location.href = 'login.html';
                return;
            }
            
            try {
                const userData = JSON.parse(user);
                if (userData.role !== 'admin') {
                    alert('ليس لديك صلاحية للوصول إلى لوحة الإدارة');
                    window.location.href = 'index.html';
                    return;
                }
            } catch (error) {
                console.error('Error parsing user data:', error);
                window.location.href = 'login.html';
            }
        }
        
        // Logout admin function
        function logoutAdmin() {
            if (confirm('هل أنت متأكد من تسجيل الخروج من لوحة الإدارة؟')) {
                // Clear user data
                localStorage.removeItem('user');
                localStorage.removeItem('rememberUser');
                
                // Show success message
                alert('تم تسجيل الخروج بنجاح');
                
                // Redirect to login page
                window.location.href = 'login.html';
            }
        }
        
        // Initialize admin check on page load
        document.addEventListener('DOMContentLoaded', function() {
            checkAdminLogin();
            
            // Load customers data
            loadCustomers();
        });
    </script>
</body>
</html>
